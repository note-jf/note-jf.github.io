import{_ as p}from"./plugin-vue_export-helper.21dcd24c.js";import{o,c as l,b as n,e,d as s,a as t,r as i}from"./app.c37b87a5.js";var c="/assets/image-20220728113402423.366bf7b1.png",u="/assets/image-20220728113949497.1cde7be2.png",r="/assets/image-20220728130527266.42b41a7f.png",d="/assets/image-20220728125055375.ec07147f.png",k="/assets/1204916-20171208112235999-1825222840.8de1f9fa.png",m="/assets/image-20220729140706857.7d38e970.png",v="/assets/image-20220729141300986.471563a6.png",b="/assets/image-20220729141702897.e75a3f77.png",g="/assets/image-20220729141854324.b66e71c9.png",h="/assets/image-20220729142232724.c0b5a5a8.png",q="/assets/image-20220729143142605.034796e4.png",y="/assets/image-20220729143155466.7e913aa8.png",x="/assets/image-20220729145916358.1b4c2e29.png",f="/assets/image-20220729150326860.fa2b34df.png",_="/assets/image-20220729211246699.e2949de5.png",w="/assets/image-20220729211332978.8be4bb76.png",S="/assets/image-20220729212349643.94d4a837.png",A="/assets/image-20220729214251417.00226e81.png";const E={},N=n("h1",{id:"ansible-\u8FD0\u7EF4\u81EA\u52A8\u5316\u5DE5\u5177",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ansible-\u8FD0\u7EF4\u81EA\u52A8\u5316\u5DE5\u5177","aria-hidden":"true"},"#"),s(" ansible \u8FD0\u7EF4\u81EA\u52A8\u5316\u5DE5\u5177")],-1),C={href:"http://ansible.com.cn/docs/intro.html",target:"_blank",rel:"noopener noreferrer"},G=s("ansible \u4E2D\u6587\u6307\u5357"),H={href:"https://pan.baidu.com/s/1caV7Qv_ICAYxprFyEba7sg",target:"_blank",rel:"noopener noreferrer"},D=s("\u672C\u8282\u793A\u4F8B\u6587\u4EF6 \u63D0\u53D6\u7801\uFF1Ado11"),I=t(`<p>\u865A\u62DF\u673A\u4E3B\u673A\u5206\u914D</p><p>8+2+200G</p><p>\u63A7\u5236\u7AEF-admin\uFF1A192.168.0.118</p><p>\u88AB\u63A7\u5236\u7AEF-n1\uFF1A192.168.0.8</p><p>\u88AB\u63A7\u5236\u7AEF-n2\uFF1A192.168.0.9</p><p>\u88AB\u63A7\u5236\u7AEF-n3\uFF1A192.168.0.10</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vi /etc/selinux/config

\u628A SELINUX=enforce   \u6539\u6210 disabled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u4E00\u3001\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001\u5B89\u88C5" aria-hidden="true">#</a> \u4E00\u3001\u5B89\u88C5</h2><p>\u4F9D\u8D56</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>\u67E5\u770B epel-release \u7248\u672C\uFF1Ayum list <span class="token operator">|</span> <span class="token function">grep</span> epel-release

yum <span class="token function">install</span> -y epel-release.noarch
yum <span class="token function">install</span> -y python2
yum <span class="token function">install</span> -y python3

yum -y clean all <span class="token operator">&amp;&amp;</span> yum -y makecache <span class="token operator">&amp;&amp;</span> yum -y update <span class="token operator">&amp;&amp;</span> yum -y repolist all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EA\u9700\u8981\u5728\u4E3B\u63A7\u5236\u7AEF\u5B89\u88C5\uFF1A<code>yum install -y ansible</code> yum remove -y ansible</p><h3 id="\u76EE\u5F55\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u76EE\u5F55\u7ED3\u6784" aria-hidden="true">#</a> \u76EE\u5F55\u7ED3\u6784</h3><p>\u5B89\u88C5\u76EE\u5F55\u5982\u4E0B(yum\u5B89\u88C5)\uFF1A</p><p>\u914D\u7F6E\u6587\u4EF6\u76EE\u5F55\uFF1A/etc/ansible/\u3010hosts\u3001ansible\u3001roles\u3011</p><p>\u6267\u884C\u6587\u4EF6\u76EE\u5F55\uFF1A/usr/bin/ansible*</p><p>Lib\u5E93\u4F9D\u8D56\u76EE\u5F55\uFF1A/usr/lib/pythonX.X/site-packages/ansible/</p><p>Help\u6587\u6863\u76EE\u5F55\uFF1A/usr/share/doc/ansible-X.X.X/</p><p>Man\u6587\u6863\u76EE\u5F55\uFF1A/usr/share/man/man1/</p><h3 id="\u8D4B\u4E88\u666E\u901A\u7528\u6237\u6743\u9650" tabindex="-1"><a class="header-anchor" href="#\u8D4B\u4E88\u666E\u901A\u7528\u6237\u6743\u9650" aria-hidden="true">#</a> \u8D4B\u4E88\u666E\u901A\u7528\u6237\u6743\u9650</h3><p>\u5C06a\u7528\u6237\u6DFB\u52A0\u5230root\u7EC4\uFF1Ausermod -aG root a</p><p>\u8D4B\u4E88a\u7528\u6237\u5BF9ansible\u7684\u6743\u9650\u7BA1\u7406\uFF1Achmod -R 755 /etc/ansible</p><p>\u8D4B\u4E88a\u7528\u6237\u5BF9ansible\u7684\u6240\u5C5E\u7EC4\u7BA1\u7406\uFF1Achown -R root:a /etc/ansible</p><h2 id="\u4E8C\u3001\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001\u6982\u5FF5" aria-hidden="true">#</a> \u4E8C\u3001\u6982\u5FF5</h2><p>ansible\u662F\u65B0\u51FA\u73B0\u7684\u81EA\u52A8\u5316\u8FD0\u7EF4\u5DE5\u5177\uFF0C\u57FA\u4E8EPython\u5F00\u53D1\uFF0C\u96C6\u5408\u4E86\u4F17\u591A\u8FD0\u7EF4\u5DE5\u5177\uFF08puppet\u3001chef\u3001func\u3001fabric\uFF09\u7684\u4F18\u70B9\uFF0C\u5B9E\u73B0\u4E86\u6279\u91CF\u7CFB\u7EDF\u914D\u7F6E\u3001\u6279\u91CF\u7A0B\u5E8F\u90E8\u7F72\u3001\u6279\u91CF\u8FD0\u884C\u547D\u4EE4\u7B49\u529F\u80FD\u3002</p><h3 id="\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#\u7279\u70B9" aria-hidden="true">#</a> \u7279\u70B9</h3><ol><li>\u90E8\u7F72\u7B80\u5355\uFF0C\u53EA\u9700\u5728\u4E3B\u63A7\u7AEF\u90E8\u7F72Ansible\u73AF\u5883\uFF0C\u88AB\u63A7\u7AEF\u65E0\u9700\u505A\u4EFB\u4F55\u64CD\u4F5C\uFF1B</li><li>\u9ED8\u8BA4\u4F7F\u7528SSH\u534F\u8BAE\u5BF9\u8BBE\u5907\u8FDB\u884C\u7BA1\u7406\uFF1B</li><li>\u6709\u5927\u91CF\u5E38\u89C4\u8FD0\u7EF4\u64CD\u4F5C\u6A21\u5757\uFF0C\u53EF\u5B9E\u73B0\u65E5\u5E38\u7EDD\u5927\u90E8\u5206\u64CD\u4F5C\uFF1B</li><li>\u914D\u7F6E\u7B80\u5355\u3001\u529F\u80FD\u5F3A\u5927\u3001\u6269\u5C55\u6027\u5F3A\uFF1B</li><li>\u652F\u6301API\u53CA\u81EA\u5B9A\u4E49\u6A21\u5757\uFF0C\u53EF\u901A\u8FC7Python\u8F7B\u677E\u6269\u5C55\uFF1B</li><li>\u901A\u8FC7Playbooks\u6765\u5B9A\u5236\u5F3A\u5927\u7684\u914D\u7F6E\u3001\u72B6\u6001\u7BA1\u7406\uFF1B</li><li>\u8F7B\u91CF\u7EA7\uFF0C\u65E0\u9700\u5728\u5BA2\u6237\u7AEF\u5B89\u88C5agent\uFF0C\u66F4\u65B0\u65F6\uFF0C\u53EA\u9700\u5728\u64CD\u4F5C\u673A\u4E0A\u8FDB\u884C\u4E00\u6B21\u66F4\u65B0\u5373\u53EF\uFF1B</li><li>\u63D0\u4F9B\u4E00\u4E2A\u529F\u80FD\u5F3A\u5927\u3001\u64CD\u4F5C\u6027\u5F3A\u7684Web\u7BA1\u7406\u754C\u9762\u548CREST API\u63A5\u53E3\u2014\u2014AWX\u5E73\u53F0\u3002</li></ol><h3 id="\u67B6\u6784\u56FE" tabindex="-1"><a class="header-anchor" href="#\u67B6\u6784\u56FE" aria-hidden="true">#</a> \u67B6\u6784\u56FE</h3><p><img src="`+c+'" alt=""></p><h3 id="\u4E3B\u8981\u6A21\u5757" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u8981\u6A21\u5757" aria-hidden="true">#</a> \u4E3B\u8981\u6A21\u5757</h3><p><code>Ansible</code>\uFF1AAnsible\u6838\u5FC3\u7A0B\u5E8F\u3002</p><p><code>HostInventory</code>\uFF1A\u8BB0\u5F55\u7531Ansible\u7BA1\u7406\u7684\u4E3B\u673A\u4FE1\u606F\uFF0C\u5305\u62EC\u7AEF\u53E3\u3001\u5BC6\u7801\u3001ip\u7B49\u3002</p><p><code>Playbooks</code>\uFF1A\u201C\u5267\u672C\u201DYAML\u683C\u5F0F\u6587\u4EF6\uFF0C\u591A\u4E2A\u4EFB\u52A1\u5B9A\u4E49\u5728\u4E00\u4E2A\u6587\u4EF6\u4E2D\uFF0C\u5B9A\u4E49\u4E3B\u673A\u9700\u8981\u8C03\u7528\u54EA\u4E9B\u6A21\u5757\u6765\u5B8C\u6210\u7684\u529F\u80FD\u3002</p><p><code>CoreModules</code>\uFF1A<strong>\u6838\u5FC3\u6A21\u5757</strong>\uFF0C\u4E3B\u8981\u64CD\u4F5C\u662F\u901A\u8FC7\u8C03\u7528\u6838\u5FC3\u6A21\u5757\u6765\u5B8C\u6210\u7BA1\u7406\u4EFB\u52A1\u3002</p><p><code>CustomModules</code>\uFF1A\u81EA\u5B9A\u4E49\u6A21\u5757\uFF0C\u5B8C\u6210\u6838\u5FC3\u6A21\u5757\u65E0\u6CD5\u5B8C\u6210\u7684\u529F\u80FD\uFF0C\u652F\u6301\u591A\u79CD\u8BED\u8A00\u3002</p><p><code>ConnectionPlugins</code>\uFF1A\u8FDE\u63A5\u63D2\u4EF6\uFF0CAnsible\u548CHost\u901A\u4FE1\u4F7F\u7528</p><h3 id="\u4EFB\u52A1\u6267\u884C" tabindex="-1"><a class="header-anchor" href="#\u4EFB\u52A1\u6267\u884C" aria-hidden="true">#</a> \u4EFB\u52A1\u6267\u884C</h3><h4 id="ansible-\u4EFB\u52A1\u6267\u884C\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#ansible-\u4EFB\u52A1\u6267\u884C\u6A21\u5F0F" aria-hidden="true">#</a> ansible \u4EFB\u52A1\u6267\u884C\u6A21\u5F0F</h4><p>Ansible \u7CFB\u7EDF\u7531\u63A7\u5236\u4E3B\u673A\u5BF9\u88AB\u7BA1\u8282\u70B9\u7684\u64CD\u4F5C\u65B9\u5F0F\u53EF\u5206\u4E3A\u4E24\u7C7B\uFF0C\u5373<code>adhoc</code>\u548C<code>playbook</code>\uFF1A</p><ul><li>ad-hoc\u6A21\u5F0F(\u70B9\u5BF9\u70B9\u6A21\u5F0F) \u3000\u4F7F\u7528\u5355\u4E2A\u6A21\u5757\uFF0C\u652F\u6301\u6279\u91CF\u6267\u884C\u5355\u6761\u547D\u4EE4\u3002ad-hoc \u547D\u4EE4\u662F\u4E00\u79CD\u53EF\u4EE5\u5FEB\u901F\u8F93\u5165\u7684\u547D\u4EE4\uFF0C\u800C\u4E14\u4E0D\u9700\u8981\u4FDD\u5B58\u8D77\u6765\u7684\u547D\u4EE4\u3002<strong>\u5C31\u76F8\u5F53\u4E8Ebash\u4E2D\u7684\u4E00\u53E5\u8BDDshell\u3002</strong></li><li>playbook\u6A21\u5F0F(\u5267\u672C\u6A21\u5F0F) \u3000\u662FAnsible\u4E3B\u8981\u7BA1\u7406\u65B9\u5F0F\uFF0C\u4E5F\u662FAnsible\u529F\u80FD\u5F3A\u5927\u7684\u5173\u952E\u6240\u5728\u3002<strong>playbook\u901A\u8FC7\u591A\u4E2Atask\u96C6\u5408\u5B8C\u6210\u4E00\u7C7B\u529F\u80FD</strong>\uFF0C\u5982Web\u670D\u52A1\u7684\u5B89\u88C5\u90E8\u7F72\u3001\u6570\u636E\u5E93\u670D\u52A1\u5668\u7684\u6279\u91CF\u5907\u4EFD\u7B49\u3002\u53EF\u4EE5\u7B80\u5355\u5730\u628Aplaybook\u7406\u89E3\u4E3A\u901A\u8FC7\u7EC4\u5408\u591A\u6761ad-hoc\u64CD\u4F5C\u7684\u914D\u7F6E\u6587\u4EF6\u3002</li></ul><h4 id="\u4EFB\u52A1\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u4EFB\u52A1\u6D41\u7A0B" aria-hidden="true">#</a> \u4EFB\u52A1\u6D41\u7A0B</h4><p><img src="'+u+`" alt=""></p><p>\u7B80\u5355\u7406\u89E3\u5C31\u662FAnsible\u5728\u8FD0\u884C\u65F6\uFF0C \u9996\u5148\u8BFB\u53D6<code>ansible.cfg</code>\u4E2D\u7684\u914D\u7F6E\uFF0C \u6839\u636E\u89C4\u5219\u83B7\u53D6<code>Inventory</code>\u4E2D\u7684\u7BA1\u7406\u4E3B\u673A\u5217\u8868\uFF0C \u5E76\u884C\u7684\u5728\u8FD9\u4E9B\u4E3B\u673A\u4E2D\u6267\u884C\u914D\u7F6E\u7684\u4EFB\u52A1\uFF0C \u6700\u540E\u7B49\u5F85\u6267\u884C\u8FD4\u56DE\u7684\u7ED3\u679C\u3002</p><h4 id="\u547D\u4EE4\u6267\u884C\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u547D\u4EE4\u6267\u884C\u8FC7\u7A0B" aria-hidden="true">#</a> \u547D\u4EE4\u6267\u884C\u8FC7\u7A0B</h4><ol><li>\u52A0\u8F7D\u81EA\u5DF1\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u9ED8\u8BA4<code>/etc/ansible/ansible.cfg</code>\uFF1B</li><li>\u67E5\u627E\u5BF9\u5E94\u7684\u4E3B\u673A\u914D\u7F6E\u6587\u4EF6\uFF0C\u627E\u5230\u8981\u6267\u884C\u7684\u4E3B\u673A\u6216\u8005\u7EC4\uFF1B</li><li>\u52A0\u8F7D\u81EA\u5DF1\u5BF9\u5E94\u7684\u6A21\u5757\u6587\u4EF6\uFF0C\u5982 command\uFF1B</li><li>\u901A\u8FC7ansible\u5C06\u6A21\u5757\u6216\u547D\u4EE4\u751F\u6210\u5BF9\u5E94\u7684\u4E34\u65F6py\u6587\u4EF6(python\u811A\u672C)\uFF0C \u5E76\u5C06\u8BE5\u6587\u4EF6\u4F20\u8F93\u81F3\u8FDC\u7A0B\u670D\u52A1\u5668\uFF1B</li><li>\u5BF9\u5E94\u6267\u884C\u7528\u6237\u7684\u5BB6\u76EE\u5F55\u7684<code>.ansible/tmp/XXX/XXX.PY</code>\u6587\u4EF6\uFF1B</li><li>\u7ED9\u6587\u4EF6 +x \u6267\u884C\u6743\u9650\uFF1B</li><li>\u6267\u884C\u5E76\u8FD4\u56DE\u7ED3\u679C\uFF1B</li><li>\u5220\u9664\u4E34\u65F6py\u6587\u4EF6\uFF0C<code>sleep 0</code>\u9000\u51FA\uFF1B</li></ol><h2 id="\u4E09\u3001\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001\u914D\u7F6E" aria-hidden="true">#</a> \u4E09\u3001\u914D\u7F6E</h2><h3 id="\u914D\u7F6E\u6587\u4EF6\u67E5\u627E\u987A\u5E8F" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6\u67E5\u627E\u987A\u5E8F" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6\u67E5\u627E\u987A\u5E8F</h3><p>ansible\u4E0E\u6211\u4EEC\u5176\u4ED6\u7684\u670D\u52A1\u5728\u8FD9\u4E00\u70B9\u4E0A\u6709\u5F88\u5927\u4E0D\u540C\uFF0C\u8FD9\u91CC\u7684\u914D\u7F6E\u6587\u4EF6\u67E5\u627E\u662F\u4ECE\u591A\u4E2A\u5730\u65B9\u627E\u7684\uFF0C\u987A\u5E8F\u5982\u4E0B\uFF1A</p><ol><li>\u68C0\u67E5\u73AF\u5883\u53D8\u91CF<code>ANSIBLE_CONFIG</code>\u6307\u5411\u7684\u8DEF\u5F84\u6587\u4EF6(export ANSIBLE_CONFIG=/etc/ansible.cfg)\uFF1B</li><li><code>~/.ansible.cfg</code>\uFF0C\u68C0\u67E5\u5F53\u524D\u76EE\u5F55\u4E0B\u7684ansible.cfg\u914D\u7F6E\u6587\u4EF6\uFF1B</li><li><code>/etc/ansible.cfg</code>\u68C0\u67E5etc\u76EE\u5F55\u7684\u914D\u7F6E\u6587\u4EF6\u3002</li></ol><h3 id="ansible-\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#ansible-\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> ansible \u914D\u7F6E\u6587\u4EF6</h3><p>ansible \u7684\u914D\u7F6E\u6587\u4EF6\u4E3A<code>/etc/ansible/ansible.cfg</code>\uFF0Cansible \u6709\u8BB8\u591A\u53C2\u6570\uFF0C\u4E0B\u9762\u6211\u4EEC\u5217\u51FA\u4E00\u4E9B\u5E38\u89C1\u7684\u53C2\u6570\uFF1A</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">inventory</span> <span class="token punctuation">=</span> <span class="token value attr-value">/etc/ansible/hosts		#\u8FD9\u4E2A\u53C2\u6570\u8868\u793A\u8D44\u6E90\u6E05\u5355inventory\u6587\u4EF6\u7684\u4F4D\u7F6E</span>
<span class="token key attr-name">library</span> <span class="token punctuation">=</span> <span class="token value attr-value">/usr/share/ansible		#\u6307\u5411\u5B58\u653EAnsible\u6A21\u5757\u7684\u76EE\u5F55\uFF0C\u652F\u6301\u591A\u4E2A\u76EE\u5F55\u65B9\u5F0F\uFF0C\u53EA\u8981\u7528\u5192\u53F7\uFF08\uFF1A\uFF09\u9694\u5F00\u5C31\u53EF\u4EE5</span>
<span class="token key attr-name">forks</span> <span class="token punctuation">=</span> <span class="token value attr-value">5		#\u5E76\u53D1\u8FDE\u63A5\u6570\uFF0C\u9ED8\u8BA4\u4E3A5</span>
<span class="token key attr-name">sudo_user</span> <span class="token punctuation">=</span> <span class="token value attr-value">root		#\u8BBE\u7F6E\u9ED8\u8BA4\u6267\u884C\u547D\u4EE4\u7684\u7528\u6237</span>
<span class="token key attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">22		#\u6307\u5B9A\u8FDE\u63A5\u88AB\u7BA1\u8282\u70B9\u7684\u7BA1\u7406\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A22\u7AEF\u53E3\uFF0C\u5EFA\u8BAE\u4FEE\u6539\uFF0C\u80FD\u591F\u66F4\u52A0\u5B89\u5168</span>
<span class="token key attr-name">host_key_checking</span> <span class="token punctuation">=</span> <span class="token value attr-value">False		#\u8BBE\u7F6E\u662F\u5426\u68C0\u67E5SSH\u4E3B\u673A\u7684\u5BC6\u94A5\uFF0C\u503C\u4E3ATrue/False\u3002\u5173\u95ED\u540E\u7B2C\u4E00\u6B21\u8FDE\u63A5\u4E0D\u4F1A\u63D0\u793A\u914D\u7F6E\u5B9E\u4F8B</span>
<span class="token key attr-name">timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">60		#\u8BBE\u7F6ESSH\u8FDE\u63A5\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u5355\u4F4D\u4E3A\u79D2</span>
<span class="token key attr-name">log_path</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/log/ansible.log		#\u6307\u5B9A\u4E00\u4E2A\u5B58\u50A8ansible\u65E5\u5FD7\u7684\u6587\u4EF6\uFF08\u9ED8\u8BA4\u4E0D\u8BB0\u5F55\u65E5\u5FD7\uFF09</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ansuble-\u4E3B\u673A\u6E05\u5355-inventory" tabindex="-1"><a class="header-anchor" href="#ansuble-\u4E3B\u673A\u6E05\u5355-inventory" aria-hidden="true">#</a> ansuble \u4E3B\u673A\u6E05\u5355 inventory</h3><p>vim /etc/ansible/hosts</p><p>\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\uFF0C\u91CC\u9762\u4FDD\u5B58\u7684\u662F\u4E00\u4E9B ansible \u9700\u8981\u8FDE\u63A5\u7BA1\u7406\u7684\u4E3B\u673A\u5217\u8868\u3002\u6211\u4EEC\u53EF\u4EE5\u6765\u770B\u770B\u4ED6\u7684\u5B9A\u4E49\u65B9\u5F0F\uFF1A</p><p>[root@admin ~]# vim /etc/ansible/hosts</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mail.example.com
<span class="token number">192.168</span>.0.120

<span class="token comment"># \u81EA\u5B9A\u4E49\u4E3B\u673A\u4E0E\u7EC4</span>
<span class="token punctuation">[</span>web<span class="token punctuation">]</span>
foo.example.com
<span class="token number">192.168</span>.0.8
<span class="token number">192.168</span>.0.121
<span class="token comment">## \u7AEF\u53E3\u53F7\u4E0D\u662F\u9ED8\u8BA4\u8BBE\u7F6E\u65F6</span>
bar.example.com:2088
<span class="token comment">## \u4E00\u7EC4\u76F8\u4F3C\u7684 hostname</span>
www<span class="token punctuation">[</span>001:006<span class="token punctuation">]</span>.example.com


<span class="token punctuation">[</span>db<span class="token punctuation">]</span>
<span class="token number">192.168</span>.0.122
two.example.com
<span class="token comment">## \u4E3B\u673A\u8303\u56F4</span>
db-<span class="token punctuation">[</span>a:f<span class="token punctuation">]</span>.example.com


<span class="token comment"># \u9759\u6001IP\u5730\u5740,\u5E0C\u671B\u8BBE\u7F6E\u4E00\u4E9B\u522B\u540D,\u4F46\u4E0D\u662F\u5728\u7CFB\u7EDF\u7684 host \u6587\u4EF6\u4E2D\u8BBE\u7F6E,\u53C8\u6216\u8005\u4F60\u662F\u901A\u8FC7\u96A7\u9053\u5728\u8FDE\u63A5</span>
<span class="token comment"># \u901A\u8FC7 \u201Cjumper\u201D \u522B\u540D,\u4F1A\u8FDE\u63A5 192.168.1.50:5555</span>
jumper <span class="token assign-left variable">ansible_ssh_port</span><span class="token operator">=</span><span class="token number">5555</span> <span class="token assign-left variable">ansible_ssh_host</span><span class="token operator">=</span><span class="token number">192.168</span>.1.50
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u65B9\u62EC\u53F7 []</strong> \u662F\u7EC4\u540D,\u7528\u4E8E\u5BF9\u7CFB\u7EDF\u8FDB\u884C\u5206\u7C7B,\u4FBF\u4E8E\u5BF9\u4E0D\u540C\u7CFB\u7EDF\u8FDB\u884C\u4E2A\u522B\u7684\u7BA1\u7406.</p><p>\u4E00\u4E2A\u7CFB\u7EDF\u53EF\u4EE5\u5C5E\u4E8E\u4E0D\u540C\u7684\u7EC4,\u6BD4\u5982\u4E00\u53F0\u670D\u52A1\u5668\u53EF\u4EE5\u540C\u65F6\u5C5E\u4E8E webserver\u7EC4 \u548C dbserver\u7EC4.\u8FD9\u65F6\u5C5E\u4E8E\u4E24\u4E2A\u7EC4\u7684\u53D8\u91CF\u90FD\u53EF\u4EE5\u4E3A\u8FD9\u53F0\u4E3B\u673A\u6240\u7528</p><h2 id="\u56DB\u3001ansible-\u5E38\u7528\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001ansible-\u5E38\u7528\u547D\u4EE4" aria-hidden="true">#</a> \u56DB\u3001ansible \u5E38\u7528\u547D\u4EE4</h2><h3 id="ansible-\u547D\u4EE4\u96C6" tabindex="-1"><a class="header-anchor" href="#ansible-\u547D\u4EE4\u96C6" aria-hidden="true">#</a> ansible \u547D\u4EE4\u96C6</h3><p><code>/usr/bin/ansible</code>\u3000\u3000Ansibe AD-Hoc \u4E34\u65F6\u547D\u4EE4\u6267\u884C\u5DE5\u5177\uFF0C\u5E38\u7528\u4E8E\u4E34\u65F6\u547D\u4EE4\u7684\u6267\u884C</p><p><code>/usr/bin/ansible-doc</code> \u3000\u3000Ansible \u6A21\u5757\u529F\u80FD\u67E5\u770B\u5DE5\u5177</p><p><code>/usr/bin/ansible-galaxy</code>\u3000\u3000\u4E0B\u8F7D/\u4E0A\u4F20\u4F18\u79C0\u4EE3\u7801\u6216Roles\u6A21\u5757 \u7684\u5B98\u7F51\u5E73\u53F0\uFF0C\u57FA\u4E8E\u7F51\u7EDC\u7684</p><p><code>/usr/bin/ansible-playbook</code>\u3000\u3000Ansible \u5B9A\u5236\u81EA\u52A8\u5316\u7684\u4EFB\u52A1\u96C6\u7F16\u6392\u5DE5\u5177</p><p><code>/usr/bin/ansible-pull</code>\u3000\u3000Ansible\u8FDC\u7A0B\u6267\u884C\u547D\u4EE4\u7684\u5DE5\u5177\uFF0C\u62C9\u53D6\u914D\u7F6E\u800C\u975E\u63A8\u9001\u914D\u7F6E\uFF08\u4F7F\u7528\u8F83\u5C11\uFF0C\u6D77\u91CF\u673A\u5668\u65F6\u4F7F\u7528\uFF0C\u5BF9\u8FD0\u7EF4\u7684\u67B6\u6784\u80FD\u529B\u8981\u6C42\u8F83\u9AD8\uFF09</p><p><code>/usr/bin/ansible-vault</code>\u3000\u3000Ansible \u6587\u4EF6\u52A0\u5BC6\u5DE5\u5177</p><p><code>/usr/bin/ansible-console</code>\u3000\u3000Ansible\u57FA\u4E8ELinux Consoble\u754C\u9762\u53EF\u4E0E\u7528\u6237\u4EA4\u4E92\u7684\u547D\u4EE4\u6267\u884C\u5DE5\u5177</p><p>\u5176\u4E2D\uFF0C\u6211\u4EEC\u6BD4\u8F83\u5E38\u7528\u7684\u662F<code>/usr/bin/ansible</code>\u548C<code>/usr/bin/ansible-playbook</code>\u3002</p><h2 id="\u4E94\u3001ansible" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001ansible" aria-hidden="true">#</a> \u4E94\u3001ansible</h2><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code>ansible &lt;host-pattern&gt; [-f forks] [-m module_name] [-a args]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E5F\u53EF\u4EE5\u901A\u8FC7<code>ansible -h</code>\u6765\u67E5\u770B\u5E2E\u52A9\uFF0C\u4E0B\u9762\u6211\u4EEC\u5217\u51FA\u4E00\u4E9B\u6BD4\u8F83\u5E38\u7528\u7684\u9009\u9879\uFF0C\u5E76\u89E3\u91CA\u5176\u542B\u4E49\uFF1A</p><blockquote><p><code>-a MODULE_ARGS</code>\u3000\u3000\u3000#\u6A21\u5757\u7684\u53C2\u6570\uFF0C\u5982\u679C\u6267\u884C\u9ED8\u8BA4COMMAND\u7684\u6A21\u5757\uFF0C\u5373\u662F\u547D\u4EE4\u53C2\u6570\uFF0C\u5982\uFF1A \u201Cdate\u201D\uFF0C\u201Cpwd\u201D\u7B49\u7B49 <code>-k</code>\uFF0C<code>--ask-pass</code> #ask for SSH password\u3002\u767B\u5F55\u5BC6\u7801\uFF0C\u63D0\u793A\u8F93\u5165SSH\u5BC6\u7801\u800C\u4E0D\u662F\u5047\u8BBE\u57FA\u4E8E\u5BC6\u94A5\u7684\u9A8C\u8BC1 <code>--ask-su-pass</code> #ask for su password\u3002su\u5207\u6362\u5BC6\u7801 <code>-K</code>\uFF0C<code>--ask-sudo-pass</code> #ask for sudo password\u3002\u63D0\u793A\u5BC6\u7801\u4F7F\u7528sudo\uFF0Csudo\u8868\u793A\u63D0\u6743\u64CD\u4F5C <code>--ask-vault-pass</code> #ask for vault password\u3002\u5047\u8BBE\u6211\u4EEC\u8BBE\u5B9A\u4E86\u52A0\u5BC6\u7684\u5BC6\u7801\uFF0C\u5219\u7528\u8BE5\u9009\u9879\u8FDB\u884C\u8BBF\u95EE <code>-B SECONDS</code> #\u540E\u53F0\u8FD0\u884C\u8D85\u65F6\u65F6\u95F4 <code>-C</code> #\u6A21\u62DF\u8FD0\u884C\u73AF\u5883\u5E76\u8FDB\u884C\u9884\u8FD0\u884C\uFF0C\u53EF\u4EE5\u8FDB\u884C\u67E5\u9519\u6D4B\u8BD5 <code>-c CONNECTION</code> #\u8FDE\u63A5\u7C7B\u578B\u4F7F\u7528 <code>-f FORKS</code> #\u5E76\u884C\u4EFB\u52A1\u6570\uFF0C\u9ED8\u8BA4\u4E3A5 <code>-i INVENTORY</code> #\u6307\u5B9A\u4E3B\u673A\u6E05\u5355\u7684\u8DEF\u5F84\uFF0C\u9ED8\u8BA4\u4E3A<code>/etc/ansible/hosts</code><code>--list-hosts</code> #\u67E5\u770B\u6709\u54EA\u4E9B\u4E3B\u673A\u7EC4 <code>-m MODULE_NAME</code> #\u6267\u884C\u6A21\u5757\u7684\u540D\u5B57\uFF0C\u9ED8\u8BA4\u4F7F\u7528 command \u6A21\u5757\uFF0C\u6240\u4EE5\u5982\u679C\u662F\u53EA\u6267\u884C\u5355\u4E00\u547D\u4EE4\u53EF\u4EE5\u4E0D\u7528 -m\u53C2\u6570 <code>-o</code> #\u538B\u7F29\u8F93\u51FA\uFF0C\u5C1D\u8BD5\u5C06\u6240\u6709\u7ED3\u679C\u5728\u4E00\u884C\u8F93\u51FA\uFF0C\u4E00\u822C\u9488\u5BF9\u6536\u96C6\u5DE5\u5177\u4F7F\u7528 <code>-S</code> #\u7528 su \u547D\u4EE4 <code>-R SU_USER</code> #\u6307\u5B9A su \u7684\u7528\u6237\uFF0C\u9ED8\u8BA4\u4E3A root \u7528\u6237 <code>-s</code> #\u7528 sudo \u547D\u4EE4 <code>-U SUDO_USER</code> #\u6307\u5B9A sudo \u5230\u54EA\u4E2A\u7528\u6237\uFF0C\u9ED8\u8BA4\u4E3A root \u7528\u6237 <code>-T TIMEOUT</code> #\u6307\u5B9A ssh \u9ED8\u8BA4\u8D85\u65F6\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u4E3A10s\uFF0C\u4E5F\u53EF\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u4FEE\u6539 <code>-u REMOTE_USER</code> #\u8FDC\u7A0B\u7528\u6237\uFF0C\u9ED8\u8BA4\u4E3A root \u7528\u6237</p></blockquote><h3 id="\u81EA\u5DF1\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5DF1\u914D\u7F6E" aria-hidden="true">#</a> \u81EA\u5DF1\u914D\u7F6E</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># \u81EA\u5B9A\u4E49\u4E3B\u673A\u4E0E\u7EC4
[web]
192.168.0.[8:10]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3B\u673A\u8FDE\u901A\u6027\u6D4B\u8BD5\uFF1Aansible web -m ping</p><p>\u4F1A\u51FA\u73B0ping\u4E0D\u901A</p><p><img src="`+r+`" alt=""></p><h3 id="ssh\u514D\u5BC6\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#ssh\u514D\u5BC6\u767B\u5F55" aria-hidden="true">#</a> SSH\u514D\u5BC6\u767B\u5F55</h3><p>\u53C2\u8003\uFF1Ahttps://blog.csdn.net/qq_42476834/article/details/124766896</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#1.\u751F\u6210\u79C1\u94A5(\u4E3B-\u88AB\u63A7\u5236\u7AEF\u6700\u597D\u90FD\u8981\u751F\u6210)</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen -t rsa</span>
<span class="token comment">#2.\u5411\u4E3B\u673A\u5206\u53D1\u79C1\u94A5</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@192.168.0.8	ssh-copy-id a@192.168.0.8</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@192.168.0.9	ssh-copy-id a@192.168.0.9</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@192.168.0.10	ssh-copy-id a@192.168.0.10</span>

\u6821\u9A8C\uFF1A
<span class="token function">ssh</span> root@192.168.0.8 		<span class="token function">ssh</span> a@192.168.0.8
<span class="token function">ssh</span> root@192.168.0.9 		<span class="token function">ssh</span> a@192.168.0.9
<span class="token function">ssh</span> root@192.168.0.10 		<span class="token function">ssh</span> a@192.168.0.10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B192.168.0.8\u7528\u6237ssh\u76EE\u5F55 authorized_keys</p><blockquote><p>ssh-rsa xxx/ph8H3i2mKHscP root@admin</p></blockquote><h3 id="\u4E3B\u673A\u8FDE\u901A\u6027\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u673A\u8FDE\u901A\u6027\u6D4B\u8BD5" aria-hidden="true">#</a> \u4E3B\u673A\u8FDE\u901A\u6027\u6D4B\u8BD5</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># ansible web -m ping</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.0.10 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.0.9 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="command-\u6A21\u5757-\u76F4\u63A5\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u6267\u884C\u547D\u4EE4-\u5E76\u5C06\u7ED3\u679C\u8FD4\u56DE\u672C\u4E3B\u673A" tabindex="-1"><a class="header-anchor" href="#command-\u6A21\u5757-\u76F4\u63A5\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u6267\u884C\u547D\u4EE4-\u5E76\u5C06\u7ED3\u679C\u8FD4\u56DE\u672C\u4E3B\u673A" aria-hidden="true">#</a> command \u6A21\u5757\uFF08\u76F4\u63A5\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u6267\u884C\u547D\u4EE4\uFF0C\u5E76\u5C06\u7ED3\u679C\u8FD4\u56DE\u672C\u4E3B\u673A\uFF09</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;ss -ntl&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>    <span class="token number">127.0</span>.0.1:25                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:111                      *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:22                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>      <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:25                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:111                   <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
<span class="token number">192.168</span>.0.10 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>    <span class="token number">127.0</span>.0.1:25                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:111                      *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:22                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>      <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:25                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:111                   <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
<span class="token number">192.168</span>.0.9 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:22                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>    <span class="token number">127.0</span>.0.1:25                       *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:111                      *:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">100</span>      <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:25                    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:111                   <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u547D\u4EE4\u6A21\u5757\u63A5\u53D7\u547D\u4EE4\u540D\u79F0\uFF0C\u540E\u9762\u662F\u7A7A\u683C\u5206\u9694\u7684\u5217\u8868\u53C2\u6570\u3002\u7ED9\u5B9A\u7684\u547D\u4EE4\u5C06\u5728\u6240\u6709\u9009\u5B9A\u7684\u8282\u70B9\u4E0A\u6267\u884C\u3002\u5B83\u4E0D\u4F1A\u901A\u8FC7shell\u8FDB\u884C\u5904\u7406\uFF0C\u6BD4\u5982 $HOME \u548C\u64CD\u4F5C\u5982 &quot;&lt;&quot;\uFF0C&quot;&gt;&quot;\uFF0C&quot;|&quot;\uFF0C&quot;;&quot;\uFF0C&quot;&amp;&quot; \u5DE5\u4F5C\uFF08\u9700\u8981\u4F7F\u7528\uFF08shell\uFF09\u6A21\u5757\u5B9E\u73B0\u8FD9\u4E9B\u529F\u80FD\uFF09\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u8BE5\u547D\u4EE4\u4E0D\u652F\u6301<code>| \u7BA1\u9053\u547D\u4EE4</code>\u3002</p><p>\u8BE5\u6A21\u5757\u4E0B\u5E38\u7528\u7684\u51E0\u4E2A\u547D\u4EE4\uFF1A</p><blockquote><p>chdir\u3000\u3000\u3000\u3000\u3000\u3000 # \u5728\u6267\u884C\u547D\u4EE4\u4E4B\u524D\uFF0C\u5148\u5207\u6362\u5230\u8BE5\u76EE\u5F55</p><p>executable # \u5207\u6362shell\u6765\u6267\u884C\u547D\u4EE4\uFF0C\u9700\u8981\u4F7F\u7528\u547D\u4EE4\u7684\u7EDD\u5BF9\u8DEF\u5F84</p><p>free_form \u3000 # \u8981\u6267\u884C\u7684Linux\u6307\u4EE4\uFF0C\u4E00\u822C\u4F7F\u7528Ansible\u7684-a\u53C2\u6570\u4EE3\u66FF\u3002</p><p>creates \u3000# \u4E00\u4E2A\u6587\u4EF6\u540D\uFF0C\u5F53\u8FD9\u4E2A\u6587\u4EF6\u5B58\u5728\uFF0C\u5219\u8BE5\u547D\u4EE4\u4E0D\u6267\u884C,\u53EF\u4EE5\u7528\u6765\u505A\u5224\u65AD</p><p>removes # \u4E00\u4E2A\u6587\u4EF6\u540D\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u4E0D\u5B58\u5728\uFF0C\u5219\u8BE5\u547D\u4EE4\u4E0D\u6267\u884C</p></blockquote><h4 id="chdir-\u5728\u6267\u884C\u547D\u4EE4\u4E4B\u524D-\u5148\u5207\u6362\u5230\u8BE5\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#chdir-\u5728\u6267\u884C\u547D\u4EE4\u4E4B\u524D-\u5148\u5207\u6362\u5230\u8BE5\u76EE\u5F55" aria-hidden="true">#</a> chdir \u5728\u6267\u884C\u547D\u4EE4\u4E4B\u524D\uFF0C\u5148\u5207\u6362\u5230\u8BE5\u76EE\u5F55</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;chdir=/root/ ls -all&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
\u603B\u7528\u91CF <span class="token number">28</span>
dr-xr-x---.  <span class="token number">7</span> root root  <span class="token number">204</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">13</span>:19 <span class="token builtin class-name">.</span>
dr-xr-xr-x. <span class="token number">17</span> root root  <span class="token number">224</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">11</span>:04 <span class="token punctuation">..</span>
-rw-------.  <span class="token number">1</span> root root <span class="token number">1614</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">11</span>:05 anaconda-ks.cfg
drwx------.  <span class="token number">3</span> root root   <span class="token number">17</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">13</span>:19 .ansible
-rw-------.  <span class="token number">1</span> root root  <span class="token number">540</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">13</span>:29 .bash_history
-rw-r--r--.  <span class="token number">1</span> root root   <span class="token number">18</span> <span class="token number">12</span>\u6708 <span class="token number">29</span> <span class="token number">2013</span> .bash_logout
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> <span class="token number">12</span>\u6708 <span class="token number">29</span> <span class="token number">2013</span> .bash_profile
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> <span class="token number">12</span>\u6708 <span class="token number">29</span> <span class="token number">2013</span> .bashrc
drwxr-xr-x.  <span class="token number">3</span> root root   <span class="token number">18</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">11</span>:06 .cache
drwxr-xr-x.  <span class="token number">3</span> root root   <span class="token number">18</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">11</span>:06 .config
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">100</span> <span class="token number">12</span>\u6708 <span class="token number">29</span> <span class="token number">2013</span> .cshrc
drwxr-----.  <span class="token number">3</span> root root   <span class="token number">19</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">11</span>:18 .pki
drwx------.  <span class="token number">2</span> root root   <span class="token number">61</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">13</span>:12 .ssh
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">129</span> <span class="token number">12</span>\u6708 <span class="token number">29</span> <span class="token number">2013</span> .tcshrc
<span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="creates-\u5B58\u5728-\u4E0D\u6267\u884Cls-\u4E0D\u5B58\u5728-\u6267\u884Cls" tabindex="-1"><a class="header-anchor" href="#creates-\u5B58\u5728-\u4E0D\u6267\u884Cls-\u4E0D\u5B58\u5728-\u6267\u884Cls" aria-hidden="true">#</a> creates\uFF08\u5B58\u5728\uFF0C\u4E0D\u6267\u884Cls\uFF0C\u4E0D\u5B58\u5728\uFF0C\u6267\u884Cls\uFF09</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5B58\u5728\uFF0C\u4E0D\u6267\u884Cls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;creates=/root/test.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
skipped, since /root/test.png exists

<span class="token comment"># \u4E0D\u5B58\u5728\uFF0C\u6267\u884Cls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;creates=/root/test1.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
anaconda-ks.cfg
test.png
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="removes-\u5B58\u5728-\u6267\u884Cls\u3001\u4E0D\u5B58\u5728-\u4E0D\u6267\u884Cls" tabindex="-1"><a class="header-anchor" href="#removes-\u5B58\u5728-\u6267\u884Cls\u3001\u4E0D\u5B58\u5728-\u4E0D\u6267\u884Cls" aria-hidden="true">#</a> removes\uFF08\u5B58\u5728\uFF0C\u6267\u884Cls\u3001\u4E0D\u5B58\u5728\uFF0C\u4E0D\u6267\u884Cls\uFF09</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5B58\u5728\uFF0C\u6267\u884Cls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;removes=/root/test.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
anaconda-ks.cfg
test.png

<span class="token comment"># \u4E0D\u5B58\u5728\uFF0C\u4E0D\u6267\u884Cls</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m command -a &#39;removes=/root/test1.png ls&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
skipped, since /root/test1.png does not exist
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shell-\u6A21\u5757" tabindex="-1"><a class="header-anchor" href="#shell-\u6A21\u5757" aria-hidden="true">#</a> Shell \u6A21\u5757</h3><p>shell\u6A21\u5757\u53EF\u4EE5\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u8C03\u7528shell\u89E3\u91CA\u5668\u8FD0\u884C\u547D\u4EE4\uFF0C\u652F\u6301shell\u7684\u5404\u79CD\u529F\u80FD\uFF0C\u4F8B\u5982\u7BA1\u9053\u7B49\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/passwd |grep &quot;root&quot;&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
root:x:0:0:root:/root:/bin/bash
operator:x:11:0:operator:/root:/sbin/nologin
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="copy-\u6A21\u5757" tabindex="-1"><a class="header-anchor" href="#copy-\u6A21\u5757" aria-hidden="true">#</a> copy \u6A21\u5757</h3><p>\u5C06\u6587\u4EF6\u590D\u5236\u5230\u8FDC\u7A0B\u4E3B\u673A\uFF0C\u540C\u65F6\u652F\u6301\u7ED9\u5B9A\u5185\u5BB9\u751F\u6210\u6587\u4EF6\u548C\u4FEE\u6539\u6743\u9650\u7B49\u3002</p><p>\u76F8\u5173\u9009\u9879\u5982\u4E0B\uFF1A</p><blockquote><p><code>src</code>\u3000\u3000\u3000\u3000#\u672C\u5730\u6587\u4EF6\u3002\u53EF\u4EE5\u662F\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u4E5F\u53EF\u4EE5\u662F\u76F8\u5BF9\u8DEF\u5F84\u3002\u5982\u679C\u8DEF\u5F84\u662F\u4E00\u4E2A\u76EE\u5F55\uFF0C\u5219\u4F1A\u9012\u5F52\u590D\u5236\uFF0C\u7528\u6CD5\u7C7B\u4F3C\u4E8E&quot;rsync&quot;</p><p><code>content</code>\u3000\u3000\u3000#\u7528\u4E8E\u66FF\u6362&quot;src&quot;\uFF0C\u53EF\u4EE5\u76F4\u63A5\u6307\u5B9A\u6587\u4EF6\u7684\u503C</p><p><code>dest</code>\u3000\u3000\u3000\u3000#\u5FC5\u9009\u9879\uFF0C\u5C06\u6E90\u6587\u4EF6\u590D\u5236\u5230\u7684\u8FDC\u7A0B\u4E3B\u673A\u7684<strong>\u7EDD\u5BF9\u8DEF\u5F84</strong></p><p><code>backup</code>\u3000\u3000\u3000#\u5F53\u6587\u4EF6\u5185\u5BB9\u53D1\u751F\u6539\u53D8\u540E\uFF0C\u5728\u8986\u76D6\u4E4B\u524D\u628A\u6E90\u6587\u4EF6\u5907\u4EFD\uFF0C\u5907\u4EFD\u6587\u4EF6\u5305\u542B\u65F6\u95F4\u4FE1\u606F</p><p><code>directory_mode</code>\u3000\u3000\u3000\u3000#\u9012\u5F52\u8BBE\u5B9A\u76EE\u5F55\u7684\u6743\u9650\uFF0C\u9ED8\u8BA4\u4E3A\u7CFB\u7EDF\u9ED8\u8BA4\u6743\u9650</p><p><code>force</code>\u3000\u3000\u3000\u3000#\u5F53\u76EE\u6807\u4E3B\u673A\u5305\u542B\u8BE5\u6587\u4EF6\uFF0C\u4F46\u5185\u5BB9\u4E0D\u540C\u65F6\uFF0C\u8BBE\u4E3A&quot;yes&quot;\uFF0C\u8868\u793A\u5F3A\u5236\u8986\u76D6\uFF1B\u8BBE\u4E3A&quot;no&quot;\uFF0C\u8868\u793A\u76EE\u6807\u4E3B\u673A\u7684\u76EE\u6807\u4F4D\u7F6E\u4E0D\u5B58\u5728\u8BE5\u6587\u4EF6\u624D\u590D\u5236\u3002\u9ED8\u8BA4\u4E3A&quot;yes&quot;</p><p><code>others</code>\u3000\u3000\u3000\u3000#\u6240\u6709\u7684 file \u6A21\u5757\u4E2D\u7684\u9009\u9879\u53EF\u4EE5\u5728\u8FD9\u91CC\u4F7F\u7528</p></blockquote><h4 id="\u590D\u5236\u6587\u4EF6-src\u3001dest" tabindex="-1"><a class="header-anchor" href="#\u590D\u5236\u6587\u4EF6-src\u3001dest" aria-hidden="true">#</a> \u590D\u5236\u6587\u4EF6\uFF08src\u3001dest\uFF09</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ll</span>
\u603B\u7528\u91CF <span class="token number">8</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">2174</span> <span class="token number">5</span>\u6708  <span class="token number">10</span> <span class="token number">14</span>:10 anaconda-ks.cfg
-rwxrwxrwx  <span class="token number">1</span> root root <span class="token number">1960</span> <span class="token number">5</span>\u6708  <span class="token number">10</span> <span class="token number">19</span>:32 first.sh

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m copy -a &#39;src=./first.sh dest=/root/first.sh&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;23f3ef0aebb2a24b97c6617c3fe8a190dc1befed&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/first.sh&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;749f84620ba675946859e0d5a8c68ec5&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1960</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1658988228.09-12252-115055636503998/source&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

\u8FDC\u7A0B\u67E5\u770B\uFF1A
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -all /root/first.sh&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1960</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:03 /root/first.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u7ED9\u5B9A\u5185\u5BB9\u751F\u6210\u6587\u4EF6-content-\u5E76\u5236\u5B9A\u6743\u9650-mode" tabindex="-1"><a class="header-anchor" href="#\u7ED9\u5B9A\u5185\u5BB9\u751F\u6210\u6587\u4EF6-content-\u5E76\u5236\u5B9A\u6743\u9650-mode" aria-hidden="true">#</a> \u7ED9\u5B9A\u5185\u5BB9\u751F\u6210\u6587\u4EF6\uFF08content\uFF09\uFF0C\u5E76\u5236\u5B9A\u6743\u9650\uFF08mode\uFF09</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ansible web -m copy -a <span class="token string">&#39;src=/root/ds.txt dest=/root/ds.txt mode=777&#39;</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m copy -a &#39;content=&quot;I am admin666 to copy test\\n&quot; dest=/root/ds.txt mode=777&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;f1027296960724e4f07c7f6d695e2a9d59a41fc6&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/ds.txt&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ebe73ae34d327b8966e3a20fafd80eda&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">27</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1658988702.62-14114-156810509219572/source&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -all /root/ds.txt&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rwxrwxrwx. <span class="token number">1</span> root root <span class="token number">27</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:11 /root/ds.txt

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /root/ds.txt&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
I am admin666 to copy <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u8986\u76D6\u5907\u4EFD-backup" tabindex="-1"><a class="header-anchor" href="#\u8986\u76D6\u5907\u4EFD-backup" aria-hidden="true">#</a> \u8986\u76D6\u5907\u4EFD\uFF08backup\uFF09</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m copy -a &#39;content=&quot;I am admin666 to backup test\\n&quot; backup=yes dest=/root/ds.txt mode=777&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;f1027296960724e4f07c7f6d695e2a9d59a41fc6&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/ds.txt&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/ds.txt&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">27</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls /root/&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
anaconda-ks.cfg
ds.txt
ds.txt.13370.2022-07-28@14:20:20~
first.sh
test.png

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /root/ds.txt&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
I am admin666 to backup <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="file-\u6A21\u5757-\u6587\u4EF6\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#file-\u6A21\u5757-\u6587\u4EF6\u7BA1\u7406" aria-hidden="true">#</a> file \u6A21\u5757\uFF08\u6587\u4EF6\u7BA1\u7406\uFF09</h3><p>\u4E3B\u8981\u7528\u4E8E\u8BBE\u7F6E\u6587\u4EF6\u7684\u5C5E\u6027\uFF0C\u6BD4\u5982\u521B\u5EFA\u6587\u4EF6\u3001\u521B\u5EFA\u94FE\u63A5\u6587\u4EF6\u3001\u5220\u9664\u6587\u4EF6\u7B49\u3002</p><p>\u5E38\u89C1\u7684\u547D\u4EE4\uFF1A</p><blockquote><p><code>force</code>\u3000\u3000#\u9700\u8981\u5728\u4E24\u79CD\u60C5\u51B5\u4E0B\u5F3A\u5236\u521B\u5EFA\u8F6F\u94FE\u63A5\uFF0C\u4E00\u79CD\u662F\u6E90\u6587\u4EF6\u4E0D\u5B58\u5728\uFF0C\u4F46\u4E4B\u540E\u4F1A\u5EFA\u7ACB\u7684\u60C5\u51B5\u4E0B\uFF1B\u53E6\u4E00\u79CD\u662F\u76EE\u6807\u8F6F\u94FE\u63A5\u5DF2\u5B58\u5728\uFF0C\u9700\u8981\u5148\u53D6\u6D88\u4E4B\u524D\u7684\u8F6F\u94FE\uFF0C\u7136\u540E\u521B\u5EFA\u65B0\u7684\u8F6F\u94FE\uFF0C\u6709\u4E24\u4E2A\u9009\u9879\uFF1Ayes|no</p><p><code>group</code>\u3000\u3000#\u5B9A\u4E49\u6587\u4EF6/\u76EE\u5F55\u7684\u5C5E\u7EC4\u3002\u540E\u9762\u53EF\u4EE5\u52A0\u4E0A<code>mode</code>\uFF1A\u5B9A\u4E49\u6587\u4EF6/\u76EE\u5F55\u7684\u6743\u9650</p><p><code>owner</code>\u3000\u3000#\u5B9A\u4E49\u6587\u4EF6/\u76EE\u5F55\u7684\u5C5E\u4E3B\u3002\u540E\u9762\u5FC5\u987B\u8DDF\u4E0A<code>path</code>\uFF1A\u5B9A\u4E49\u6587\u4EF6/\u76EE\u5F55\u7684\u8DEF\u5F84</p><p><code>recurse</code>\u3000\u3000#\u9012\u5F52\u8BBE\u7F6E\u6587\u4EF6\u7684\u5C5E\u6027\uFF0C\u53EA\u5BF9\u76EE\u5F55\u6709\u6548\uFF0C\u540E\u9762\u8DDF\u4E0A<code>src</code>\uFF1A\u88AB\u94FE\u63A5\u7684\u6E90\u6587\u4EF6\u8DEF\u5F84\uFF0C\u53EA\u5E94\u7528\u4E8E<code>state=link</code>\u7684\u60C5\u51B5</p><p><code>dest</code>\u3000\u3000#\u88AB\u94FE\u63A5\u5230\u7684\u8DEF\u5F84\uFF0C\u53EA\u5E94\u7528\u4E8E<code>state=link</code>\u7684\u60C5\u51B5</p><p><code>state</code>\u3000\u3000#\u72B6\u6001\uFF0C\u6709\u4EE5\u4E0B\u9009\u9879\uFF1A</p><blockquote><p><code>directory</code>\uFF1A\u5982\u679C\u76EE\u5F55\u4E0D\u5B58\u5728\uFF0C\u5C31\u521B\u5EFA\u76EE\u5F55</p><p><code>file</code>\uFF1A\u5373\u4F7F\u6587\u4EF6\u4E0D\u5B58\u5728\uFF0C\u4E5F\u4E0D\u4F1A\u88AB\u521B\u5EFA</p><p><code>link</code>\uFF1A\u521B\u5EFA\u8F6F\u94FE\u63A5</p><p><code>hard</code>\uFF1A\u521B\u5EFA\u786C\u94FE\u63A5</p><p><code>touch</code>\uFF1A\u5982\u679C\u6587\u4EF6\u4E0D\u5B58\u5728\uFF0C\u5219\u4F1A\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u6587\u4EF6\uFF0C\u5982\u679C\u6587\u4EF6\u6216\u76EE\u5F55\u5DF2\u5B58\u5728\uFF0C\u5219\u66F4\u65B0\u5176\u6700\u540E\u4FEE\u6539\u65F6\u95F4</p><p><code>absent</code>\uFF1A\u5220\u9664\u76EE\u5F55\u3001\u6587\u4EF6\u6216\u8005\u53D6\u6D88\u94FE\u63A5\u6587\u4EF6</p></blockquote></blockquote><h4 id="\u521B\u5EFA\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u76EE\u5F55" aria-hidden="true">#</a> \u521B\u5EFA\u76EE\u5F55</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/app state=directory&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0755&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/app&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /root&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
\u603B\u7528\u91CF <span class="token number">16</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">1614</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">11</span>:05 anaconda-ks.cfg
drwxr-xr-x. <span class="token number">2</span> root root    <span class="token number">6</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:28 app
-rwxrwxrwx. <span class="token number">1</span> root root   <span class="token number">29</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:20 ds.txt
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">26</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:19 ds.txt.13370.2022-07-28@14:20:20~
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1960</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:03 first.sh
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">0</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">13</span>:44 test.png
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u521B\u5EFA\u94FE\u63A5\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u94FE\u63A5\u6587\u4EF6" aria-hidden="true">#</a> \u521B\u5EFA\u94FE\u63A5\u6587\u4EF6</h4><p>\u4E3Atest.jpg\u521B\u5EFA\u94FE\u63A5</p><p>link\uFF1A\u521B\u5EFA\u8F6F\u94FE\u63A5</p><p>hard\uFF1A\u521B\u5EFA\u786C\u94FE\u63A5</p><p>force\uFF1A\u9700\u8981\u5728\u4E24\u79CD\u60C5\u51B5\u4E0B\u5F3A\u5236\u521B\u5EFA\u8F6F\u94FE\u63A5\uFF0C\u4E00\u79CD\u662F\u6E90\u6587\u4EF6\u4E0D\u5B58\u5728\uFF0C\u4F46\u4E4B\u540E\u4F1A\u5EFA\u7ACB\u7684\u60C5\u51B5\u4E0B\uFF1B\u53E6\u4E00\u79CD\u662F\u76EE\u6807\u8F6F\u94FE\u63A5\u5DF2\u5B58\u5728\uFF0C\u9700\u8981\u5148\u53D6\u6D88\u4E4B\u524D\u7684\u8F6F\u94FE\uFF0C\u7136\u540E\u521B\u5EFA\u65B0\u7684\u8F6F\u94FE\uFF0C\u6709\u4E24\u4E2A\u9009\u9879\uFF1Ayes|no</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/test2.png src=/root/test.png state=link&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test2.png&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">14</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test.png&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;link&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/test3.png src=/root/test.png state=hard&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test3.png&quot;</span>,
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>,
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>,
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test.png&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;hard&quot;</span>,
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /root/&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
lrwxrwxrwx. <span class="token number">1</span> root root   <span class="token number">14</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:39 test2.png -<span class="token operator">&gt;</span> /root/test.png
-rw-r--r--. <span class="token number">2</span> root root    <span class="token number">0</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">13</span>:44 test3.png
-rw-r--r--. <span class="token number">2</span> root root    <span class="token number">0</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">13</span>:44 test.png
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5220\u9664\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u5220\u9664\u6587\u4EF6" aria-hidden="true">#</a> \u5220\u9664\u6587\u4EF6</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m file -a &#39;path=/root/test3.png state=absent&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/test3.png&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;absent&quot;</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /root/test3.png&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">2</span> <span class="token operator">&gt;&gt;</span>
ls: \u65E0\u6CD5\u8BBF\u95EE/root/test3.png: \u6CA1\u6709\u90A3\u4E2A\u6587\u4EF6\u6216\u76EE\u5F55non-zero <span class="token builtin class-name">return</span> code
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="fetch-\u6A21\u5757-\u590D\u5236\u8FDC\u7A0B\u6587\u4EF6\u5230\u672C\u5730\u4E3B\u673A" tabindex="-1"><a class="header-anchor" href="#fetch-\u6A21\u5757-\u590D\u5236\u8FDC\u7A0B\u6587\u4EF6\u5230\u672C\u5730\u4E3B\u673A" aria-hidden="true">#</a> fetch \u6A21\u5757\uFF08\u590D\u5236\u8FDC\u7A0B\u6587\u4EF6\u5230\u672C\u5730\u4E3B\u673A\uFF09</h3><p>\u7528\u4E8E\u4ECE\u8FDC\u7A0B\u67D0\u4E3B\u673A\u83B7\u53D6\uFF08\u590D\u5236\uFF09\u6587\u4EF6\u5230\u672C\u5730\u3002</p><blockquote><p><code>dest</code>\uFF1A\u7528\u6765\u5B58\u653E\u6587\u4EF6\u7684\u76EE\u5F55</p><p><code>src</code>\uFF1A\u5728\u8FDC\u7A0B\u62C9\u53D6\u7684\u6587\u4EF6\uFF0C\u5E76\u4E14\u5FC5\u987B\u662F\u4E00\u4E2A<strong>file</strong>\uFF0C\u4E0D\u80FD\u662F<strong>\u76EE\u5F55</strong></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m fetch -a &#39;src=/root/ds.txt dest=/root&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dbd48461fe5fff10ea97f688511ba74a292ab6f9&quot;</span>,
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/192.168.0.8/root/ds.txt&quot;</span>,
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;9a282b66af8d46bceabdcd71173fc67d&quot;</span>,
    <span class="token string">&quot;remote_checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;dbd48461fe5fff10ea97f688511ba74a292ab6f9&quot;</span>,
    <span class="token string">&quot;remote_md5sum&quot;</span><span class="token builtin class-name">:</span> null
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ls -l /root/192.168.0.8/root/ds.txt</span>
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">29</span> <span class="token number">7</span>\u6708  <span class="token number">28</span> <span class="token number">14</span>:46 /root/192.168.0.8/root/ds.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u53EF\u4EE5\u5728\u672C\u673A\u4E0A\u67E5\u770B\u4E00\u4E0B\u6587\u4EF6\u662F\u5426\u590D\u5236\u6210\u529F\u3002\u8981\u6CE8\u610F\uFF0C\u6587\u4EF6\u4FDD\u5B58\u7684\u8DEF\u5F84\u662F\u6211\u4EEC\u8BBE\u7F6E\u7684\u63A5\u6536\u76EE\u5F55\u4E0B\u7684<code>\u88AB\u7BA1\u5236\u4E3B\u673Aip</code>\u76EE\u5F55\u4E0B</p><h3 id="cron-\u6A21\u5757-\u8BA1\u5212\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#cron-\u6A21\u5757-\u8BA1\u5212\u4EFB\u52A1" aria-hidden="true">#</a> cron \u6A21\u5757\uFF08\u8BA1\u5212\u4EFB\u52A1\uFF09</h3><p>\u7528\u4E8E\u7BA1\u7406<code>cron</code>\u8BA1\u5212\u4EFB\u52A1\u7684\u3002 \u3000\u5176\u4F7F\u7528\u7684\u8BED\u6CD5\u8DDF\u6211\u4EEC\u7684<code>crontab</code>\u6587\u4EF6\u4E2D\u7684\u8BED\u6CD5\u4E00\u81F4\uFF0C\u540C\u65F6\uFF0C\u53EF\u4EE5\u6307\u5B9A\u4EE5\u4E0B\u9009\u9879\uFF1A</p><blockquote><p><code>day=</code> #\u65E5\u5E94\u8BE5\u8FD0\u884C\u7684\u5DE5\u4F5C( 1-31, *, */2, )</p><p><code>hour=</code> # \u5C0F\u65F6 ( 0-23, *, */2, )</p><p><code>minute=</code> #\u5206\u949F( 0-59, *, */2, )</p><p><code>month=</code> # \u6708( 1-12, *, /2, )</p><p><code>weekday=</code> # \u5468 ( 0-6 for Sunday-Saturday,, )</p><p><code>job=</code> #\u6307\u660E\u8FD0\u884C\u7684\u547D\u4EE4\u662F\u4EC0\u4E48</p><p><code>name=</code> #\u5B9A\u65F6\u4EFB\u52A1\u63CF\u8FF0</p><p><code>reboot</code> # \u4EFB\u52A1\u5728\u91CD\u542F\u65F6\u8FD0\u884C\uFF0C\u4E0D\u5EFA\u8BAE\u4F7F\u7528\uFF0C\u5EFA\u8BAE\u4F7F\u7528special_time</p><p><code>special_time</code> #\u7279\u6B8A\u7684\u65F6\u95F4\u8303\u56F4\uFF0C\u53C2\u6570\uFF1Areboot\uFF08\u91CD\u542F\u65F6\uFF09\uFF0Cannually\uFF08\u6BCF\u5E74\uFF09\uFF0Cmonthly\uFF08\u6BCF\u6708\uFF09\uFF0Cweekly\uFF08\u6BCF\u5468\uFF09\uFF0Cdaily\uFF08\u6BCF\u5929\uFF09\uFF0Chourly\uFF08\u6BCF\u5C0F\u65F6\uFF09</p><p><code>state</code> #\u6307\u5B9A\u72B6\u6001\uFF0Cpresent\u8868\u793A\u6DFB\u52A0\u5B9A\u65F6\u4EFB\u52A1\uFF0C\u4E5F\u662F\u9ED8\u8BA4\u8BBE\u7F6E\uFF0Cabsent\u8868\u793A\u5220\u9664\u5B9A\u65F6\u4EFB\u52A1</p><p><code>user</code> # \u4EE5\u54EA\u4E2A\u7528\u6237\u7684\u8EAB\u4EFD\u6267\u884C</p></blockquote><h4 id="_1-\u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_1-\u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1" aria-hidden="true">#</a> \u2460 \u6DFB\u52A0\u8BA1\u5212\u4EFB\u52A1</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m cron -a &#39;name=&quot;ntp \u6BCF 5 \u5206\u949F\u66F4\u65B0\u4E00\u6B21&quot; minute=*/5 job=&quot;/sbin/ntpdate 172.17.0.1 &amp;&gt; /dev/null&quot;&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;envs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">&quot;jobs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;ntp \u6BCF 5 \u5206\u949F\u66F4\u65B0\u4E00\u6B21&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B\u8BA1\u5212\u4EFB\u52A1\u5217\u8868</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;crontab -l&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token comment">#Ansible: ntp \u6BCF 5 \u5206\u949F\u66F4\u65B0\u4E00\u6B21</span>
*/5 * * * * /sbin/ntpdate <span class="token number">172.17</span>.0.1 <span class="token operator">&amp;&gt;</span> /dev/null


<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ls -l /sbin/ntpdate&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">110160</span> <span class="token number">6</span>\u6708  <span class="token number">23</span> <span class="token number">2020</span> /sbin/ntpdate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-\u5220\u9664\u8BA1\u5212\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_2-\u5220\u9664\u8BA1\u5212\u4EFB\u52A1" aria-hidden="true">#</a> \u2461 \u5220\u9664\u8BA1\u5212\u4EFB\u52A1</h4><p>\u67E5\u770B\u8BA1\u5212\u4EFB\u52A1\u5217\u8868</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;crontab -l&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token comment">#Ansible: ntp \u6BCF 5 \u5206\u949F\u66F4\u65B0\u4E00\u6B21</span>
*/5 * * * * /sbin/ntpdate <span class="token number">172.17</span>.0.1 <span class="token operator">&amp;&gt;</span> /dev/null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5220\u9664</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m cron -a &#39;name=&quot;df everyday&quot; hour=15 job=&quot;df -lh &gt;&gt; /tmp/disk_total &amp;&gt; /dev/null&quot; state=absent&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;envs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">&quot;jobs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;ntp \u6BCF 5 \u5206\u949F\u66F4\u65B0\u4E00\u6B21&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5220\u9664\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u518D\u67E5\u770B\u4E00\u4E0B\u73B0\u6709\u7684\u8BA1\u5212\u4EFB\u52A1\u786E\u8BA4\u4E00\u4E0B\uFF1A</p><div class="language-perl ext-perl line-numbers-mode"><pre class="language-perl"><code>
<span class="token punctuation">[</span>root<span class="token variable">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;crontab -l&#39;</span>
<span class="token v-string string">192.168.0.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">|</span> rc<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token comment">#Ansible: ntp \u6BCF 5 \u5206\u949F\u66F4\u65B0\u4E00\u6B21</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">/</span>sbin<span class="token operator">/</span>ntpdate <span class="token v-string string">172.17.0.1</span> <span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token regex">/dev/null</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="yum-\u6A21\u5757-\u7528\u4E8E\u8F6F\u4EF6\u7684\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#yum-\u6A21\u5757-\u7528\u4E8E\u8F6F\u4EF6\u7684\u5B89\u88C5" aria-hidden="true">#</a> yum \u6A21\u5757\uFF08\u7528\u4E8E\u8F6F\u4EF6\u7684\u5B89\u88C5\uFF09</h3><p>\u987E\u540D\u601D\u4E49\uFF0C\u8BE5\u6A21\u5757\u4E3B\u8981\u7528\u4E8E\u8F6F\u4EF6\u7684\u5B89\u88C5\u3002 \u3000\u5176\u9009\u9879\u5982\u4E0B\uFF1A</p><blockquote><p><code>name=</code>\u3000\u3000#\u6240\u5B89\u88C5\u7684\u5305\u7684\u540D\u79F0</p><p><code>state=</code>\u3000\u3000#<code>present</code>---&gt;\u5B89\u88C5\uFF0C <code>latest</code>---&gt;\u5B89\u88C5\u6700\u65B0\u7684, <code>absent</code>---&gt; \u5378\u8F7D\u8F6F\u4EF6\u3002</p><p><code>update_cache</code>\u3000\u3000#\u5F3A\u5236\u66F4\u65B0yum\u7684\u7F13\u5B58</p><p><code>conf_file</code>\u3000\u3000#\u6307\u5B9A\u8FDC\u7A0Byum\u5B89\u88C5\u65F6\u6240\u4F9D\u8D56\u7684\u914D\u7F6E\u6587\u4EF6\uFF08\u5B89\u88C5\u672C\u5730\u5DF2\u6709\u7684\u5305\uFF09\u3002</p><p><code>disable_pgp_check</code>\u3000\u3000#\u662F\u5426\u7981\u6B62GPG checking\uFF0C\u53EA\u7528\u4E8E<code>present</code>or <code>latest</code>\u3002</p><p><code>disablerepo</code>\u3000\u3000#\u4E34\u65F6\u7981\u6B62\u4F7F\u7528yum\u5E93\u3002 \u53EA\u7528\u4E8E\u5B89\u88C5\u6216\u66F4\u65B0\u65F6\u3002</p><p><code>enablerepo</code>\u3000\u3000#\u4E34\u65F6\u4F7F\u7528\u7684yum\u5E93\u3002\u53EA\u7528\u4E8E\u5B89\u88C5\u6216\u66F4\u65B0\u65F6\u3002</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment">#  ansible web -m yum -a &#39;name=htop state=present&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;changes&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;installed&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;htop&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;msg&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
    <span class="token string">&quot;rc&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;results&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;Loaded plugins: fastestmirror, langpacks<span class="token entity" title="\\n">\\n</span>Loading mirror speeds from cached hostfile<span class="token entity" title="\\n">\\n</span> * base: ftp.sjtu.edu.cn<span class="token entity" title="\\n">\\n</span> * epel: ftp.riken.jp<span class="token entity" title="\\n">\\n</span> * extras: mirror.lzu.edu.cn<span class="token entity" title="\\n">\\n</span> * updates: ftp.sjtu.edu.cn<span class="token entity" title="\\n">\\n</span>Resolving Dependencies<span class="token entity" title="\\n">\\n</span>--&gt; Running transaction check<span class="token entity" title="\\n">\\n</span>---&gt; Package htop.x86_64 0:2.2.0-3.el7 will be installed<span class="token entity" title="\\n">\\n</span>--&gt; Finished Dependency Resolution<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Dependencies Resolved<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>================================================================================<span class="token entity" title="\\n">\\n</span> Package         Arch              Version                Repository       Size<span class="token entity" title="\\n">\\n</span>================================================================================<span class="token entity" title="\\n">\\n</span>Installing:<span class="token entity" title="\\n">\\n</span> htop            x86_64            2.2.0-3.el7            epel            103 k<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Transaction Summary<span class="token entity" title="\\n">\\n</span>================================================================================<span class="token entity" title="\\n">\\n</span>Install  1 Package<span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Total download size: 103 k<span class="token entity" title="\\n">\\n</span>Installed size: 218 k<span class="token entity" title="\\n">\\n</span>Downloading packages:<span class="token entity" title="\\n">\\n</span>Running transaction check<span class="token entity" title="\\n">\\n</span>Running transaction test<span class="token entity" title="\\n">\\n</span>Transaction test succeeded<span class="token entity" title="\\n">\\n</span>Running transaction<span class="token entity" title="\\n">\\n</span>  Installing : htop-2.2.0-3.el7.x86_64                                      1/1 <span class="token entity" title="\\n">\\n</span>  Verifying  : htop-2.2.0-3.el7.x86_64                                      1/1 <span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Installed:<span class="token entity" title="\\n">\\n</span>  htop.x86_64 0:2.2.0-3.el7                                                     <span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\n">\\n</span>Complete!<span class="token entity" title="\\n">\\n</span>&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="service-\u6A21\u5757-\u670D\u52A1\u7A0B\u5E8F\u7684\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#service-\u6A21\u5757-\u670D\u52A1\u7A0B\u5E8F\u7684\u7BA1\u7406" aria-hidden="true">#</a> service \u6A21\u5757\uFF08\u670D\u52A1\u7A0B\u5E8F\u7684\u7BA1\u7406\uFF09</h3><p>\u8BE5\u6A21\u5757\u7528\u4E8E\u670D\u52A1\u7A0B\u5E8F\u7684\u7BA1\u7406\u3002 \u3000\u5176\u4E3B\u8981\u9009\u9879\u5982\u4E0B\uFF1A</p><blockquote><p><code>arguments</code> #\u547D\u4EE4\u884C\u63D0\u4F9B\u989D\u5916\u7684\u53C2\u6570</p><p><code>enabled</code> #\u8BBE\u7F6E\u5F00\u673A\u542F\u52A8\u3002</p><p><code>name=</code> #\u670D\u52A1\u540D\u79F0</p><p><code>runlevel</code> #\u5F00\u673A\u542F\u52A8\u7684\u7EA7\u522B\uFF0C\u4E00\u822C\u4E0D\u7528\u6307\u5B9A\u3002</p><p><code>sleep</code> #\u5728\u91CD\u542F\u670D\u52A1\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u662F\u5426\u7B49\u5F85\u3002\u5982\u5728\u670D\u52A1\u5173\u95ED\u4EE5\u540E\u7B49\u5F852\u79D2\u518D\u542F\u52A8\u3002(\u5B9A\u4E49\u5728\u5267\u672C\u4E2D\u3002)</p><p><code>state</code> #\u6709\u56DB\u79CD\u72B6\u6001\uFF0C\u5206\u522B\u4E3A\uFF1A<code>started</code>---&gt;\u542F\u52A8\u670D\u52A1\uFF0C <code>stopped</code>---&gt;\u505C\u6B62\u670D\u52A1\uFF0C <code>restarted</code>---&gt;\u91CD\u542F\u670D\u52A1\uFF0C <code>reloaded</code>---&gt;\u91CD\u8F7D\u914D\u7F6E</p></blockquote><h4 id="_1-\u5F00\u542F\u670D\u52A1\u5E76\u8BBE\u7F6E\u81EA\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#_1-\u5F00\u542F\u670D\u52A1\u5E76\u8BBE\u7F6E\u81EA\u542F\u52A8" aria-hidden="true">#</a> \u2460 \u5F00\u542F\u670D\u52A1\u5E76\u8BBE\u7F6E\u81EA\u542F\u52A8</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m service -a &#39;name=nginx state=started enabled=true&#39; </span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;enabled&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;started&quot;</span>, 
    \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7AEF\u53E3\u662F\u5426\u6253\u5F00\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ss -ntl&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              
LISTEN     <span class="token number">0</span>      <span class="token number">128</span>          *:80                       *:*                                 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u51FA\u6211\u4EEC\u768480\u7AEF\u53E3\u5DF2\u7ECF\u6253\u5F00\u3002</p><h4 id="_2-\u5173\u95ED\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_2-\u5173\u95ED\u670D\u52A1" aria-hidden="true">#</a> \u2461 \u5173\u95ED\u670D\u52A1</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m service -a &#39;name=nginx state=stopped&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;stopped&quot;</span>, 
	\u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6765\u67E5\u770B\u4E00\u4E0B\u7AEF\u53E3\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ss -ntl | grep 80&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">&gt;&gt;</span>
non-zero <span class="token builtin class-name">return</span> code
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="user-\u6A21\u5757-\u7BA1\u7406\u7528\u6237\u8D26\u53F7" tabindex="-1"><a class="header-anchor" href="#user-\u6A21\u5757-\u7BA1\u7406\u7528\u6237\u8D26\u53F7" aria-hidden="true">#</a> user \u6A21\u5757\uFF08\u7BA1\u7406\u7528\u6237\u8D26\u53F7\uFF09</h3><p>\u8BE5\u6A21\u5757\u4E3B\u8981\u662F\u7528\u6765\u7BA1\u7406\u7528\u6237\u8D26\u53F7\u3002</p><p>\u5176\u4E3B\u8981\u9009\u9879\u5982\u4E0B\uFF1A</p><blockquote><p><code>comment</code>\u3000\u3000# \u7528\u6237\u7684\u63CF\u8FF0\u4FE1\u606F</p><p><code>createhome</code>\u3000\u3000# \u662F\u5426\u521B\u5EFA\u5BB6\u76EE\u5F55</p><p><code>force</code>\u3000\u3000# \u5728\u4F7F\u7528state=absent\u65F6, \u884C\u4E3A\u4E0Euserdel \u2013force\u4E00\u81F4.</p><p><code>group</code>\u3000\u3000# \u6307\u5B9A\u57FA\u672C\u7EC4</p><p><code>groups</code>\u3000\u3000# \u6307\u5B9A\u9644\u52A0\u7EC4\uFF0C\u5982\u679C\u6307\u5B9A\u4E3A(groups=)\u8868\u793A\u5220\u9664\u6240\u6709\u7EC4</p><p><code>home</code>\u3000\u3000# \u6307\u5B9A\u7528\u6237\u5BB6\u76EE\u5F55</p><p><code>move_home</code>\u3000\u3000# \u5982\u679C\u8BBE\u7F6E\u4E3Ahome=\u65F6, \u8BD5\u56FE\u5C06\u7528\u6237\u4E3B\u76EE\u5F55\u79FB\u52A8\u5230\u6307\u5B9A\u7684\u76EE\u5F55</p><p><code>name</code>\u3000\u3000# \u6307\u5B9A\u7528\u6237\u540D</p><p><code>non_unique</code>\u3000\u3000# \u8BE5\u9009\u9879\u5141\u8BB8\u6539\u53D8\u975E\u552F\u4E00\u7684\u7528\u6237ID\u503C</p><p><code>password</code>\u3000\u3000# \u6307\u5B9A\u7528\u6237\u5BC6\u7801</p><p><code>remove</code>\u3000\u3000# \u5728\u4F7F\u7528state=absent\u65F6, \u884C\u4E3A\u662F\u4E0Euserdel \u2013remove\u4E00\u81F4</p><p><code>shell</code>\u3000\u3000# \u6307\u5B9A\u9ED8\u8BA4shell</p><p><code>state</code>\u3000\u3000# \u8BBE\u7F6E\u5E10\u53F7\u72B6\u6001\uFF0C\u4E0D\u6307\u5B9A\u4E3A\u521B\u5EFA\uFF0C\u6307\u5B9A\u503C\u4E3Aabsent\u8868\u793A\u5220\u9664</p><p><code>system</code>\u3000\u3000# \u5F53\u521B\u5EFA\u4E00\u4E2A\u7528\u6237\uFF0C\u8BBE\u7F6E\u8FD9\u4E2A\u7528\u6237\u662F\u7CFB\u7EDF\u7528\u6237\u3002\u8FD9\u4E2A\u8BBE\u7F6E\u4E0D\u80FD\u66F4\u6539\u73B0\u6709\u7528\u6237</p><p><code>uid</code>\u3000\u3000# \u6307\u5B9A\u7528\u6237\u7684uid</p></blockquote><h4 id="_1-\u6DFB\u52A0\u4E00\u4E2A\u7528\u6237\u5E76\u6307\u5B9A\u5176-uid" tabindex="-1"><a class="header-anchor" href="#_1-\u6DFB\u52A0\u4E00\u4E2A\u7528\u6237\u5E76\u6307\u5B9A\u5176-uid" aria-hidden="true">#</a> \u2460 \u6DFB\u52A0\u4E00\u4E2A\u7528\u6237\u5E76\u6307\u5B9A\u5176 uid</h4><div class="language-smalltalk ext-smalltalk line-numbers-mode"><pre class="language-smalltalk"><code><span class="token punctuation">[</span>root<span class="token operator">@</span>admin ~<span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m user <span class="token operator">-</span>a <span class="token string">&#39;name=a2 uid=11111&#39;</span>
<span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">0.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span><span class="token operator">,</span>
    <span class="token comment">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token operator">,</span>
    <span class="token comment">&quot;comment&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;create_home&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token operator">,</span>
    <span class="token comment">&quot;group&quot;</span><span class="token punctuation">:</span> <span class="token number">11111</span><span class="token operator">,</span>
    <span class="token comment">&quot;home&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;/home/a2&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;a2&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;shell&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;/bin/bash&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;state&quot;</span><span class="token punctuation">:</span> <span class="token comment">&quot;present&quot;</span><span class="token operator">,</span>
    <span class="token comment">&quot;system&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token operator">,</span>
    <span class="token comment">&quot;uid&quot;</span><span class="token punctuation">:</span> <span class="token number">11111</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6DFB\u52A0\u5B8C\u6210\uFF0C\u6211\u4EEC\u53EF\u4EE5\u53BB\u67E5\u770B\u4E00\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/passwd |grep a2&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
a2:x:11111:11111::/home/a2:/bin/bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-\u5220\u9664\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#_2-\u5220\u9664\u7528\u6237" aria-hidden="true">#</a> \u2461 \u5220\u9664\u7528\u6237</h4><div class="language-dart ext-dart line-numbers-mode"><pre class="language-dart"><code><span class="token punctuation">[</span>root<span class="token metadata function">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m user <span class="token operator">-</span>a <span class="token string-literal"><span class="token string">&#39;name=a2 state=absent&#39;</span></span>
<span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string-literal"><span class="token string">&quot;ansible_facts&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string-literal"><span class="token string">&quot;discovered_interpreter_python&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;/usr/bin/python&quot;</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;changed&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;force&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;name&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;a2&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;remove&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;state&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;absent&quot;</span></span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u6837\u7684\uFF0C\u5220\u9664\u4E4B\u540E\uFF0C\u6211\u4EEC\u53BB\u770B\u4E00\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/passwd |grep a2&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">&gt;&gt;</span>
non-zero <span class="token builtin class-name">return</span> code
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53D1\u73B0\u5DF2\u7ECF\u6CA1\u6709\u8FD9\u4E2A\u7528\u6237\u4E86\u3002</p><h3 id="group-\u6A21\u5757-\u6DFB\u52A0\u6216\u5220\u9664\u7EC4" tabindex="-1"><a class="header-anchor" href="#group-\u6A21\u5757-\u6DFB\u52A0\u6216\u5220\u9664\u7EC4" aria-hidden="true">#</a> group \u6A21\u5757\uFF08\u6DFB\u52A0\u6216\u5220\u9664\u7EC4\uFF09</h3><p>\u8BE5\u6A21\u5757\u4E3B\u8981\u7528\u4E8E\u6DFB\u52A0\u6216\u5220\u9664\u7EC4\u3002</p><p>\u5E38\u7528\u7684\u9009\u9879\u5982\u4E0B\uFF1A</p><blockquote><p><code>gid=</code>\u3000\u3000#\u8BBE\u7F6E\u7EC4\u7684GID\u53F7</p><p><code>name=</code>\u3000\u3000#\u6307\u5B9A\u7EC4\u7684\u540D\u79F0</p><p><code>state=</code>\u3000\u3000#\u6307\u5B9A\u7EC4\u7684\u72B6\u6001\uFF0C\u9ED8\u8BA4\u4E3A\u521B\u5EFA\uFF0C\u8BBE\u7F6E\u503C\u4E3A<code>absent</code>\u4E3A\u5220\u9664</p><p><code>system=</code>\u3000\u3000#\u8BBE\u7F6E\u503C\u4E3A<code>yes</code>\uFF0C\u8868\u793A\u521B\u5EFA\u4E3A\u7CFB\u7EDF\u7EC4</p></blockquote><h4 id="_1-\u521B\u5EFA\u7EC4" tabindex="-1"><a class="header-anchor" href="#_1-\u521B\u5EFA\u7EC4" aria-hidden="true">#</a> \u2460 \u521B\u5EFA\u7EC4</h4><div class="language-dart ext-dart line-numbers-mode"><pre class="language-dart"><code><span class="token punctuation">[</span>root<span class="token metadata function">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m group <span class="token operator">-</span>a <span class="token string-literal"><span class="token string">&#39;name=a2 gid=12222&#39;</span></span>
<span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.8</span> <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string-literal"><span class="token string">&quot;ansible_facts&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string-literal"><span class="token string">&quot;discovered_interpreter_python&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;/usr/bin/python&quot;</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;changed&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;gid&quot;</span></span><span class="token punctuation">:</span> <span class="token number">12222</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;name&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;dd&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;state&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;present&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;system&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521B\u5EFA\u8FC7\u540E\uFF0C\u6211\u4EEC\u6765\u67E5\u770B\u4E00\u4E0B\uFF1A</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>[root<span class="token operator">@</span>admin ~]<span class="token comment"># ansible web -m shell -a &#39;cat /etc/group | grep 12222&#39;</span>
192.168.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> rc<span class="token operator">=</span>0 &gt;&gt;
<span class="token target symbol">a2</span><span class="token punctuation">:</span>x<span class="token punctuation">:</span>12222<span class="token punctuation">:</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u51FA\uFF0C\u6211\u4EEC\u7684\u7EC4\u5DF2\u7ECF\u521B\u5EFA\u6210\u529F\u4E86\u3002</p><h4 id="_2-\u5220\u9664\u7EC4" tabindex="-1"><a class="header-anchor" href="#_2-\u5220\u9664\u7EC4" aria-hidden="true">#</a> \u2461 \u5220\u9664\u7EC4</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m group -a &#39;name=a2 state=absent&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;a2&quot;</span>,
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;absent&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7167\u4F8B\u67E5\u770B\u4E00\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /etc/group | grep 12222&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> FAILED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">&gt;&gt;</span>
non-zero <span class="token builtin class-name">return</span> code

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5DF2\u7ECF\u6CA1\u6709\u8FD9\u4E2A\u7EC4\u7684\u76F8\u5173\u4FE1\u606F\u4E86\u3002</p><h3 id="script-\u6A21\u5757-\u5C06\u672C\u673A\u7684\u811A\u672Csh\u5728\u88AB\u7BA1\u7406\u7AEF\u7684\u673A\u5668\u4E0A\u8FD0\u884C" tabindex="-1"><a class="header-anchor" href="#script-\u6A21\u5757-\u5C06\u672C\u673A\u7684\u811A\u672Csh\u5728\u88AB\u7BA1\u7406\u7AEF\u7684\u673A\u5668\u4E0A\u8FD0\u884C" aria-hidden="true">#</a> script \u6A21\u5757\uFF08\u5C06\u672C\u673A\u7684\u811A\u672Csh\u5728\u88AB\u7BA1\u7406\u7AEF\u7684\u673A\u5668\u4E0A\u8FD0\u884C\uFF09</h3><p>\u8BE5\u6A21\u5757\u7528\u4E8E\u5C06\u672C\u673A\u7684\u811A\u672C\u5728\u88AB\u7BA1\u7406\u7AEF\u7684\u673A\u5668\u4E0A\u8FD0\u884C\u3002</p><p>\u8BE5\u6A21\u5757\u76F4\u63A5\u6307\u5B9A\u811A\u672C\u7684\u8DEF\u5F84\u5373\u53EF\uFF0C\u6211\u4EEC\u901A\u8FC7\u4F8B\u5B50\u6765\u770B\u4E00\u770B\u5230\u5E95\u5982\u4F55\u4F7F\u7528\u7684\uFF1A</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u5199\u4E00\u4E2A\u811A\u672C\uFF0C\u5E76\u7ED9\u5176\u52A0\u4E0A\u6267\u884C\u6743\u9650\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># vim /root/df.sh</span>

<span class="token comment">#!/bin/bash</span>

<span class="token function">date</span> <span class="token operator">&gt;&gt;</span> /root/disk_total.log
<span class="token function">df</span> -lh <span class="token operator">&gt;&gt;</span> /root/disk_total.log
	
<span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># chmod +x /root/df.sh </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\uFF0C\u6211\u4EEC\u76F4\u63A5\u8FD0\u884C\u547D\u4EE4\u6765\u5B9E\u73B0\u5728\u88AB\u7BA1\u7406\u7AEF\u6267\u884C\u8BE5\u811A\u672C\uFF1A</p><div class="language-swift ext-swift line-numbers-mode"><pre class="language-swift"><code><span class="token punctuation">[</span>root<span class="token attribute atrule">@admin</span> <span class="token operator">~</span><span class="token punctuation">]</span># ansible web <span class="token operator">-</span>m script <span class="token operator">-</span>a &#39;<span class="token operator">/</span>root<span class="token operator">/</span>df<span class="token punctuation">.</span>sh&#39;
<span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">0.8</span> <span class="token operator">|</span> <span class="token constant">CHANGED</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token string-literal"><span class="token string">&quot;changed&quot;</span></span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;rc&quot;</span></span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stderr&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Shared connection to 192.168.0.8 closed.\\r\\n&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stderr_lines&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string-literal"><span class="token string">&quot;Shared connection to 192.168.0.8 closed.&quot;</span></span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stdout&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">&quot;stdout_lines&quot;</span></span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7167\u4F8B\u67E5\u770B\u4E00\u4E0B\u6587\u4EF6\u5185\u5BB9\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;cat /root/disk_total.log&#39;</span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
<span class="token number">2022</span>\u5E74 07\u6708 <span class="token number">28</span>\u65E5 \u661F\u671F\u56DB <span class="token number">15</span>:23:35 CST
\u6587\u4EF6\u7CFB\u7EDF                 \u5BB9\u91CF  \u5DF2\u7528  \u53EF\u7528 \u5DF2\u7528% \u6302\u8F7D\u70B9
devtmpfs                 <span class="token number">3</span>.8G     <span class="token number">0</span>  <span class="token number">3</span>.8G    <span class="token number">0</span>% /dev
tmpfs                    <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G    <span class="token number">0</span>% /dev/shm
tmpfs                    <span class="token number">3</span>.9G   12M  <span class="token number">3</span>.8G    <span class="token number">1</span>% /run
tmpfs                    <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G    <span class="token number">0</span>% /sys/fs/cgroup
/dev/mapper/centos-root   50G  <span class="token number">2</span>.9G   48G    <span class="token number">6</span>% /
/dev/sda1               1014M  199M  816M   <span class="token number">20</span>% /boot
/dev/mapper/centos-home  142G   33M  142G    <span class="token number">1</span>% /home
tmpfs 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u51FA\u5DF2\u7ECF\u6267\u884C\u6210\u529F\u4E86\u3002</p><h3 id="setup-\u6A21\u5757-\u6536\u96C6\u88AB\u7BA1\u7406\u4E3B\u673A\u7684\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#setup-\u6A21\u5757-\u6536\u96C6\u88AB\u7BA1\u7406\u4E3B\u673A\u7684\u4FE1\u606F" aria-hidden="true">#</a> setup \u6A21\u5757\uFF08\u6536\u96C6\u88AB\u7BA1\u7406\u4E3B\u673A\u7684\u4FE1\u606F\uFF09</h3><p>\u8BE5\u6A21\u5757\u4E3B\u8981\u7528\u4E8E\u6536\u96C6\u4FE1\u606F\uFF0C\u662F\u901A\u8FC7\u8C03\u7528facts\u7EC4\u4EF6\u6765\u5B9E\u73B0\u7684\u3002</p><p>facts \u7EC4\u4EF6\u662FAnsible\u7528\u4E8E\u91C7\u96C6\u88AB\u7BA1\u673A\u5668\u8BBE\u5907\u4FE1\u606F\u7684\u4E00\u4E2A\u529F\u80FD\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528setup\u6A21\u5757\u67E5\u673A\u5668\u7684\u6240\u6709facts\u4FE1\u606F\uFF0C\u53EF\u4EE5\u4F7F\u7528filter\u6765\u67E5\u770B\u6307\u5B9A\u4FE1\u606F\u3002\u6574\u4E2Afacts\u4FE1\u606F\u88AB\u5305\u88C5\u5728\u4E00\u4E2AJSON\u683C\u5F0F\u7684\u6570\u636E\u7ED3\u6784\u4E2D\uFF0Cansible_facts\u662F\u6700\u4E0A\u5C42\u7684\u503C\u3002</p><p>facts \u5C31\u662F\u53D8\u91CF\uFF0C\u5185\u5EFA\u53D8\u91CF \u3002\u6BCF\u4E2A\u4E3B\u673A\u7684\u5404\u79CD\u4FE1\u606F\uFF0Ccpu\u9897\u6570\u3001\u5185\u5B58\u5927\u5C0F\u7B49\u3002\u4F1A\u5B58\u5728facts\u4E2D\u7684\u67D0\u4E2A\u53D8\u91CF\u4E2D\u3002\u8C03\u7528\u540E\u8FD4\u56DE\u5F88\u591A\u5BF9\u5E94\u4E3B\u673A\u7684\u4FE1\u606F\uFF0C\u5728\u540E\u9762\u7684\u64CD\u4F5C\u4E2D\u53EF\u4EE5\u6839\u636E\u4E0D\u540C\u7684\u4FE1\u606F\u6765\u505A\u4E0D\u540C\u7684\u64CD\u4F5C\u3002\u5982redhat\u7CFB\u5217\u7528yum\u5B89\u88C5\uFF0C\u800Cdebian\u7CFB\u5217\u7528apt\u6765\u5B89\u88C5\u8F6F\u4EF6\u3002</p><h4 id="_1-\u67E5\u770B\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_1-\u67E5\u770B\u4FE1\u606F" aria-hidden="true">#</a> \u2460 \u67E5\u770B\u4FE1\u606F</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m setup -a &#39;filter=&quot;*mem*&quot;&#39;</span>
192.168.0.8 <span class="token punctuation">|</span> SUCCESS =<span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token key atrule">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;ansible_memfree_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7068</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memory_mb&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">&quot;nocache&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7456</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">346</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;real&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7068</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">734</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;swap&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;cached&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memtotal_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u547D\u4EE4\u67E5\u770B\u4E00\u4E0B\u5185\u5B58\u7684\u5927\u5C0F\u4EE5\u786E\u8BA4\u4E00\u4E0B\u662F\u5426\u4E00\u81F4\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;free -m&#39;</span>


192.168.0.8 <span class="token punctuation">|</span> CHANGED <span class="token punctuation">|</span> rc=0 <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span>
              total        used        free      shared  buff/cache   available
<span class="token key atrule">Mem</span><span class="token punctuation">:</span>           7802         309        7067          11         426        7247
<span class="token key atrule">Swap</span><span class="token punctuation">:</span>          8063           0        8063

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u51FA\u4FE1\u606F\u662F\u4E00\u81F4\u7684\u3002</p><h4 id="_2-\u4FDD\u5B58\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_2-\u4FDD\u5B58\u4FE1\u606F" aria-hidden="true">#</a> \u2461 \u4FDD\u5B58\u4FE1\u606F</h4><p>\u6211\u4EEC\u7684setup\u6A21\u5757\u8FD8\u6709\u4E00\u4E2A\u5F88\u597D\u7528\u7684\u529F\u80FD\u5C31\u662F\u53EF\u4EE5\u4FDD\u5B58\u6211\u4EEC\u6240\u7B5B\u9009\u7684\u4FE1\u606F\u81F3\u6211\u4EEC\u7684\u4E3B\u673A\u4E0A\uFF0C\u540C\u65F6\uFF0C\u6587\u4EF6\u540D\u4E3A\u6211\u4EEC\u88AB\u7BA1\u5236\u7684\u4E3B\u673A\u7684IP\uFF0C\u8FD9\u6837\u65B9\u4FBF\u6211\u4EEC\u77E5\u9053\u662F\u54EA\u53F0\u673A\u5668\u51FA\u7684\u95EE\u9898\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># ansible web -m setup -a &#39;filter=&quot;*mem*&quot;&#39; --tree /root/facts</span>
192.168.0.8 <span class="token punctuation">|</span> SUCCESS =<span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token key atrule">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;ansible_memfree_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memory_mb&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">&quot;nocache&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7454</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">348</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;real&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">738</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">&quot;swap&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token key atrule">&quot;cached&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span>
                <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;ansible_memtotal_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u6211\u4EEC\u53EF\u4EE5\u53BB\u67E5\u770B\u4E00\u4E0B\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin ~<span class="token punctuation">]</span><span class="token comment"># cd /root/facts/</span>
<span class="token punctuation">[</span>root@admin facts<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@admin facts<span class="token punctuation">]</span><span class="token comment"># cat 192.168.0.8</span>
<span class="token punctuation">{</span><span class="token key atrule">&quot;ansible_facts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;ansible_memfree_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;ansible_memory_mb&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;nocache&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7454</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">348</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;real&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">7064</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">738</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;swap&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;cached&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;free&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">8063</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;used&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;ansible_memtotal_mb&quot;</span><span class="token punctuation">:</span> <span class="token number">7802</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;discovered_interpreter_python&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;changed&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u516D\u3001ansible-doc" tabindex="-1"><a class="header-anchor" href="#\u516D\u3001ansible-doc" aria-hidden="true">#</a> \u516D\u3001ansible-doc</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ansible-doc -l				<span class="token comment">#\u83B7\u53D6\u5168\u90E8\u6A21\u5757\u7684\u4FE1\u606F</span>
ansible-doc -s MOD_NAME		<span class="token comment">#\u83B7\u53D6\u6307\u5B9A\u6A21\u5757\u7684\u4F7F\u7528\u5E2E\u52A9</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+d+`" alt=""></p><h2 id="\u4E03\u3001ansible-playbook" tabindex="-1"><a class="header-anchor" href="#\u4E03\u3001ansible-playbook" aria-hidden="true">#</a> \u4E03\u3001ansible-playbook</h2><h3 id="\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a> \u7B80\u4ECB</h3><p>playbook \u662F ansible \u7528\u4E8E\u914D\u7F6E\uFF0C\u90E8\u7F72\uFF0C\u548C\u7BA1\u7406\u88AB\u63A7\u8282\u70B9\u7684\u5267\u672C\u3002</p><p>\u901A\u8FC7 playbook \u7684\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u6267\u884C\u5176\u4E2D\u7684\u4E00\u7CFB\u5217 tasks \uFF0C\u53EF\u4EE5\u8BA9\u8FDC\u7AEF\u4E3B\u673A\u8FBE\u5230\u9884\u671F\u7684\u72B6\u6001\u3002playbook \u5C31\u50CF Ansible \u63A7\u5236\u5668\u7ED9\u88AB\u63A7\u8282\u70B9\u5217\u51FA\u7684\u7684\u4E00\u7CFB\u5217 to-do-list \uFF0C\u800C\u88AB\u63A7\u8282\u70B9\u5FC5\u987B\u8981\u5B8C\u6210\u3002</p><p>\u4E5F\u53EF\u4EE5\u8FD9\u4E48\u7406\u89E3\uFF0Cplaybook \u5B57\u9762\u610F\u601D\uFF0C\u5373\u5267\u672C\uFF0C\u73B0\u5B9E\u4E2D\u7531\u6F14\u5458\u6309\u7167\u5267\u672C\u8868\u6F14\uFF0C\u5728Ansible\u4E2D\uFF0C\u8FD9\u6B21\u7531\u8BA1\u7B97\u673A\u8FDB\u884C\u8868\u6F14\uFF0C\u7531\u8BA1\u7B97\u673A\u5B89\u88C5\uFF0C\u90E8\u7F72\u5E94\u7528\uFF0C\u63D0\u4F9B\u5BF9\u5916\u670D\u52A1\uFF0C\u4EE5\u53CA\u7EC4\u7EC7\u8BA1\u7B97\u673A\u5904\u7406\u5404\u79CD\u5404\u6837\u7684\u4E8B\u60C5\u3002</p><h3 id="\u4F7F\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u573A\u666F" aria-hidden="true">#</a> \u4F7F\u7528\u573A\u666F</h3><p>\u6267\u884C\u4E00\u4E9B\u7B80\u5355\u7684\u4EFB\u52A1\uFF0C\u4F7F\u7528ad-hoc\u547D\u4EE4\u53EF\u4EE5\u65B9\u4FBF\u7684\u89E3\u51B3\u95EE\u9898\uFF0C\u4F46\u662F\u6709\u65F6\u4E00\u4E2A\u8BBE\u65BD\u8FC7\u4E8E\u590D\u6742\uFF0C\u9700\u8981\u5927\u91CF\u7684\u64CD\u4F5C\u65F6\u5019\uFF0C\u6267\u884C\u7684ad-hoc\u547D\u4EE4\u662F\u4E0D\u9002\u5408\u7684\uFF0C\u8FD9\u65F6\u6700\u597D\u4F7F\u7528playbook\u3002</p><p>\u5C31\u50CF\u6267\u884Cshell\u547D\u4EE4\u4E0E\u5199shell\u811A\u672C\u4E00\u6837\uFF0C\u4E5F\u53EF\u4EE5\u7406\u89E3\u4E3A\u6279\u5904\u7406\u4EFB\u52A1\uFF0C\u4E0D\u8FC7playbook\u6709\u81EA\u5DF1\u7684\u8BED\u6CD5\u683C\u5F0F\u3002</p><p>\u4F7F\u7528playbook\u4F60\u53EF\u4EE5\u65B9\u4FBF\u7684\u91CD\u7528\u8FD9\u4E9B\u4EE3\u7801\uFF0C\u53EF\u4EE5\u79FB\u690D\u5230\u4E0D\u540C\u7684\u673A\u5668\u4E0A\u9762\uFF0C\u50CF\u51FD\u6570\u4E00\u6837\uFF0C\u6700\u5927\u5316\u7684\u5229\u7528\u4EE3\u7801\u3002\u5728\u4F60\u4F7F\u7528Ansible\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u4F60\u4E5F\u4F1A\u53D1\u73B0\uFF0C\u4F60\u6240\u5904\u7406\u7684\u5927\u90E8\u5206\u64CD\u4F5C\u90FD\u662F\u7F16\u5199playbook\u3002\u53EF\u4EE5\u628A\u5E38\u89C1\u7684\u5E94\u7528\u90FD\u7F16\u5199\u6210playbook\uFF0C\u4E4B\u540E\u7BA1\u7406\u670D\u52A1\u5668\u4F1A\u53D8\u5F97\u5341\u5206\u7B80\u5355\u3002</p><h3 id="\u683C\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u683C\u5F0F" aria-hidden="true">#</a> \u683C\u5F0F</h3><p>**playbook\u7531YMAL\u8BED\u8A00\u7F16\u5199\u3002**YMAL\u683C\u5F0F\u662F\u7C7B\u4F3C\u4E8EJSON\u7684\u6587\u4EF6\u683C\u5F0F\uFF0C\u4FBF\u4E8E\u4EBA\u7406\u89E3\u548C\u9605\u8BFB\uFF0C\u540C\u65F6\u4FBF\u4E8E\u4E66\u5199\u3002</p><p>\u4EE5\u4E0B\u4E3Aplaybook\u5E38\u7528\u5230\u7684YMAL\u683C\u5F0F\uFF1A</p><p>1\u3001\u6587\u4EF6\u7684\u7B2C\u4E00\u884C\u5E94\u8BE5\u4EE5 &quot;---&quot; (\u4E09\u4E2A\u8FDE\u5B57\u7B26)\u5F00\u59CB\uFF0C\u8868\u660EYMAL\u6587\u4EF6\u7684\u5F00\u59CB\u3002</p><p>2\u3001\u5728\u540C\u4E00\u884C\u4E2D\uFF0C#\u4E4B\u540E\u7684\u5185\u5BB9\u8868\u793A\u6CE8\u91CA\uFF0C\u7C7B\u4F3C\u4E8Eshell\uFF0Cpython\u548Cruby\u3002</p><p>3\u3001YMAL\u4E2D\u7684\u5217\u8868\u5143\u7D20\u4EE5\u201D-\u201D\u5F00\u5934\u7136\u540E\u7D27\u8DDF\u7740\u4E00\u4E2A\u7A7A\u683C\uFF0C\u540E\u9762\u4E3A\u5143\u7D20\u5185\u5BB9\u3002</p><p>4\u3001\u540C\u4E00\u4E2A\u5217\u8868\u4E2D\u7684\u5143\u7D20\u5E94\u8BE5\u4FDD\u6301\u76F8\u540C\u7684\u7F29\u8FDB\u3002\u5426\u5219\u4F1A\u88AB\u5F53\u505A\u9519\u8BEF\u5904\u7406\u3002</p><p>5\u3001play\u4E2Dhosts\uFF0Cvariables\uFF0Croles\uFF0Ctasks\u7B49\u5BF9\u8C61\u7684\u8868\u793A\u65B9\u6CD5\u90FD\u662F\u952E\u503C\u4E2D\u95F4\u4EE5&quot;:&quot;\u5206\u9694\u8868\u793A\uFF0C&quot;:&quot;\u540E\u9762\u8FD8\u8981\u589E\u52A0\u4E00\u4E2A\u7A7A\u683C\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># \u81EA\u5B9A\u4E49\u4E3B\u673A\u4E0E\u7EC4
[web]
192.168.0.[8:10]

[mysqlServer]
192.168.0.[8:10]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ansible-playbook &lt;filename.yml&gt; ... [options]</p><ul><li>options:</li><li><ul><li>--check -C #\u53EA\u68C0\u6D4B\u53EF\u80FD\u4F1A\u53D1\u751F\u7684\u6539\u53D8\uFF0C\u4F46\u4E0D\u771F\u6B63\u6267\u884C\u64CD\u4F5C</li><li>--list-hosts #\u5217\u51FA\u8FD0\u884C\u4EFB\u52A1\u7684\u4E3B\u673A</li><li>--list-tags #\u5217\u51FAtag</li><li>--list-tasks #\u5217\u51FAtask</li><li>--limit \u4E3B\u673A\u5217\u8868 #\u53EA\u9488\u5BF9\u4E3B\u673A\u5217\u8868\u4E2D\u7684\u4E3B\u673A\u6267\u884C</li><li>-v -vv -vvv #\u663E\u793A\u8FC7\u7A0B</li></ul></li></ul></blockquote><p>vim mysql.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> mysqlServer
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install mysql<span class="token punctuation">-</span>server package
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=mysql<span class="token punctuation">-</span>server state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> starting mysqld service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=mysql state=started
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>host\u90E8\u5206</code>\uFF1A\u4F7F\u7528 hosts \u6307\u793A\u4F7F\u7528\u54EA\u4E2A\u4E3B\u673A\u6216\u4E3B\u673A\u7EC4\u6765\u8FD0\u884C\u4E0B\u9762\u7684 tasks \uFF0C\u6BCF\u4E2A playbook \u90FD\u5FC5\u987B\u6307\u5B9A hosts \uFF0Chosts\u4E5F<strong>\u53EF\u4EE5\u4F7F\u7528\u901A\u914D\u7B26\u683C\u5F0F</strong>\u3002\u4E3B\u673A\u6216\u4E3B\u673A\u7EC4\u5728 inventory \u6E05\u5355\u4E2D\u6307\u5B9A\uFF0C\u53EF\u4EE5\u4F7F\u7528\u7CFB\u7EDF\u9ED8\u8BA4\u7684<code>/etc/ansible/hosts</code>\uFF0C\u4E5F\u53EF\u4EE5\u81EA\u5DF1\u7F16\u8F91\uFF0C\u5728\u8FD0\u884C\u7684\u65F6\u5019\u52A0\u4E0A<code>-i</code>\u9009\u9879\uFF0C\u6307\u5B9A\u6E05\u5355\u7684\u4F4D\u7F6E\u5373\u53EF\u3002\u5728\u8FD0\u884C\u6E05\u5355\u6587\u4EF6\u7684\u65F6\u5019\uFF0C<code>\u2013list-hosts</code>\u9009\u9879\u4F1A\u663E\u793A\u90A3\u4E9B\u4E3B\u673A\u5C06\u4F1A\u53C2\u4E0E\u6267\u884C task \u7684\u8FC7\u7A0B\u4E2D\u3002</p><p><code>remote_user</code>\uFF1A\u6307\u5B9A\u8FDC\u7AEF\u4E3B\u673A\u4E2D\u7684\u54EA\u4E2A\u7528\u6237\u6765\u767B\u5F55\u8FDC\u7AEF\u7CFB\u7EDF\uFF0C\u5728\u8FDC\u7AEF\u7CFB\u7EDF\u6267\u884C task \u7684\u7528\u6237\uFF0C\u53EF\u4EE5\u4EFB\u610F\u6307\u5B9A\uFF0C\u4E5F\u53EF\u4EE5\u4F7F\u7528 sudo\uFF0C\u4F46\u662F\u7528\u6237\u5FC5\u987B\u8981\u6709\u6267\u884C\u76F8\u5E94 task \u7684\u6743\u9650\u3002</p><p><code>tasks</code>\uFF1A\u6307\u5B9A\u8FDC\u7AEF\u4E3B\u673A\u5C06\u8981\u6267\u884C\u7684\u4E00\u7CFB\u5217\u52A8\u4F5C\u3002tasks \u7684\u6838\u5FC3\u4E3A ansible \u7684\u6A21\u5757\uFF0C\u524D\u9762\u5DF2\u7ECF\u63D0\u5230\u6A21\u5757\u7684\u7528\u6CD5\u3002tasks \u5305\u542B <code>name</code> \u548C<code>\u8981\u6267\u884C\u7684\u6A21\u5757</code>\uFF0Cname \u662F\u53EF\u9009\u7684\uFF0C\u53EA\u662F\u4E3A\u4E86\u4FBF\u4E8E\u7528\u6237\u9605\u8BFB\uFF0C\u4E0D\u8FC7\u8FD8\u662F\u5EFA\u8BAE\u52A0\u4E0A\u53BB\uFF0C\u6A21\u5757\u662F\u5FC5\u987B\u7684\uFF0C\u540C\u65F6\u4E5F\u8981\u7ED9\u4E88\u6A21\u5757\u76F8\u5E94\u7684\u53C2\u6570\u3002</p></blockquote><p>ansible-playbook \u8FD0\u884Cplaybook\u6587\u4EF6</p><blockquote><p>ansible-playbook mysql.yml</p></blockquote><p>\u6267\u884C\u6709\u4E09\u4E2A\u6B65\u9AA4\uFF1A</p><p>1\u3001\u6536\u96C6facts</p><p>2\u3001\u6267\u884Ctasks</p><p>3\u3001\u62A5\u544A\u7ED3\u679C</p><p><img src="`+k+`" alt=""></p><h3 id="\u6838\u5FC3\u5143\u7D20" tabindex="-1"><a class="header-anchor" href="#\u6838\u5FC3\u5143\u7D20" aria-hidden="true">#</a> \u6838\u5FC3\u5143\u7D20</h3><p>Playbook\u7684\u6838\u5FC3\u5143\u7D20\uFF1A</p><blockquote><p><code>Hosts</code>\uFF1A\u4E3B\u673A\u7EC4\uFF1B</p><p><code>Tasks</code>\uFF1A\u4EFB\u52A1\u5217\u8868\uFF1B</p><p><code>Variables</code>\uFF1A\u53D8\u91CF\uFF0C\u8BBE\u7F6E\u65B9\u5F0F\u6709\u56DB\u79CD\uFF1B</p><p><code>Templates</code>\uFF1A\u5305\u542B\u4E86\u6A21\u677F\u8BED\u6CD5\u7684\u6587\u672C\u6587\u4EF6\uFF1B</p><p><code>Handlers</code>\uFF1A\u7531\u7279\u5B9A\u6761\u4EF6\u89E6\u53D1\u7684\u4EFB\u52A1\uFF1B</p></blockquote><h3 id="\u57FA\u672C\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u7EC4\u4EF6" aria-hidden="true">#</a> \u57FA\u672C\u7EC4\u4EF6</h3><p>Playbooks\u914D\u7F6E\u6587\u4EF6\u7684\u57FA\u7840\u7EC4\u4EF6\uFF1A</p><blockquote><p><code>Hosts</code>\uFF1A\u8FD0\u884C\u6307\u5B9A\u4EFB\u52A1\u7684\u76EE\u6807\u4E3B\u673A</p><p><code>remoute_user</code>\uFF1A\u5728\u8FDC\u7A0B\u4E3B\u673A\u4E0A\u6267\u884C\u4EFB\u52A1\u7684\u7528\u6237\uFF1B</p><p><code>sudo_user</code>\uFF1A</p><p><code>tasks</code>\uFF1A\u4EFB\u52A1\u5217\u8868</p><blockquote><p>tasks\u683C\u5F0F</p><p>\u2013 name: TASK_NAME</p><p>\u200B module: arguments</p><p>\u200B notify: HANDLER_NAME</p></blockquote><blockquote><p>handlers:</p><p>\u200B \u2013 name: HANDLER_NAME</p><p>\u200B module: arguments</p></blockquote></blockquote><blockquote><p><code>\u6A21\u5757\uFF0C\u6A21\u5757\u53C2\u6570</code>\uFF1A</p><blockquote><p>\u683C\u5F0F\uFF1A \u3000\u3000\u3000(1) action: module arguments \u3000\u3000\u3000(2) module: arguments \u3000\u3000\u3000\u6CE8\u610F\uFF1Ashell\u548Ccommand\u6A21\u5757\u540E\u9762\u76F4\u63A5\u8DDF\u547D\u4EE4\uFF0C\u800C\u975Ekey=value\u7C7B\u7684\u53C2\u6570\u5217\u8868\uFF1B</p></blockquote></blockquote><blockquote><p><code>handlers</code>\uFF1A\u4EFB\u52A1\uFF0C\u5728\u7279\u5B9A\u6761\u4EF6\u4E0B\u89E6\u53D1\uFF1B\u63A5\u6536\u5230\u5176\u5B83\u4EFB\u52A1\u7684\u901A\u77E5\u65F6\u88AB\u89E6\u53D1\uFF1B</p></blockquote><p>(1) \u67D0\u4EFB\u52A1\u7684\u72B6\u6001\u5728\u8FD0\u884C\u540E\u4E3Achanged\u65F6\uFF0C\u53EF\u901A\u8FC7\u201Cnotify\u201D\u901A\u77E5\u7ED9\u76F8\u5E94\u7684handlers\uFF1B</p><p>(2) \u4EFB\u52A1\u53EF\u4EE5\u901A\u8FC7\u201Ctags\u201C\u6253\u6807\u7B7E\uFF0C\u800C\u540E\u53EF\u5728ansible-playbook\u547D\u4EE4\u4E0A\u4F7F\u7528-t\u6307\u5B9A\u8FDB\u884C\u8C03\u7528\uFF1B</p><h4 id="_1-\u5B9A\u4E49-playbook" tabindex="-1"><a class="header-anchor" href="#_1-\u5B9A\u4E49-playbook" aria-hidden="true">#</a> \u2460 \u5B9A\u4E49 playbook</h4><p>\u524D\u63D0\uFF1A\u672C\u673A\u914D\u7F6E\u597D nginx.conf \u6A21\u677F</p><p><strong>\u76EE\u5F55\u7ED3\u6784</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@admin ansible]# tree nginx/
nginx/
\u251C\u2500\u2500 conf
\u2502   \u2514\u2500\u2500 nginx.conf
\u251C\u2500\u2500 conf.d
\u2502   \u251C\u2500\u2500 ry.conf
\u2502   \u2514\u2500\u2500 time.txt
\u251C\u2500\u2500 html
\u2502   \u251C\u2500\u2500 404.html
\u2502   \u251C\u2500\u2500 50x.html
\u2502   \u251C\u2500\u2500 dist
\u2502   \u2502   \u251C\u2500\u2500 assets
\u2502   \u2502   \u2502   \u251C\u2500\u2500 401.386cda99.js
\u2502   \u2502   \u2502   \u2514\u2500\u2500 zip.f12aeb4c.svg
\u2502   \u2502   \u251C\u2500\u2500 favicon.ico
\u2502   \u2502   \u2514\u2500\u2500 index.html
\u2502   \u2514\u2500\u2500 index.html
\u2514\u2500\u2500 logs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>nginx.conf</strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#user nginx;</span>

<span class="token comment">#\u5DE5\u4F5C\u7EBF\u7A0B\u6570\u7B49\u540Ccpu\u6570</span>
worker_processes 1; 

error_log /etc/nginx/logs/error.log;
pid /run/nginx.pid;

events <span class="token punctuation">{</span>
    worker_connections 1024;
<span class="token punctuation">}</span>
http <span class="token punctuation">{</span>
    server_tokens off;
    include       mime.types;
    default_type  application/octet<span class="token punctuation">-</span>stream;
    
    log_format  mylog &#39;<span class="token punctuation">{</span><span class="token key atrule">&quot;date_time&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;$year-$month-$day $hour:$minutes:$seconds&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;host&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$server_addr&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;client_ip&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$remote_addr&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;client_id&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$remote_user&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;url&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$request_uri&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;request&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$request&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;referer&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$http_referer&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;request_time&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$request_time&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;status&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$status&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;size&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$body_bytes_sent&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;info&quot;<span class="token punctuation">:</span> <span class="token string">&quot;$http_user_agent&quot;</span><span class="token punctuation">,</span>&#39;
                      &#39;&quot;x_forwarded_for&quot;<span class="token punctuation">:</span> &quot;$http_x_forwarded_for&quot;&#39;
                      &#39;<span class="token punctuation">}</span>&#39;;
                      
    sendfile        on;
  	<span class="token comment">#tcp_nopush     on;</span>
  	keepalive_timeout  65;
  
  	client_max_body_size 50m;
  	client_body_buffer_size 256k;
  	client_header_timeout 3m;
  	client_body_timeout 3m;
  	proxy_connect_timeout 300s;
  	proxy_read_timeout 300s;
  	proxy_send_timeout 300s;
  	proxy_buffer_size 64k;
  	proxy_buffers 4 32k;
  	proxy_busy_buffers_size 64k;
  	proxy_temp_file_write_size 64k;
  	proxy_ignore_client_abort on;
  	proxy_set_header Host $host;
  	proxy_set_header X<span class="token punctuation">-</span>Forwarder<span class="token punctuation">-</span>For $remote_addr;

    gzip  on;
    
    include /etc/nginx/conf.d/<span class="token important">*.conf;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ry.conf</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    server {
        listen       80;
        server_name  localhost;
        charset utf-8;
        #access_log  logs/host.access.log  main;
        
        location / {
            root   /etc/nginx/html;
            index  index.html index.htm;
        }
        
        error_page 404 /404.html;
        
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root   /etc/nginx/html;
        }
    }
    
#server {
#    listen       80;
#    server_name  www.ry8.cn;
#    charset utf-8;
#    include /etc/nginx/conf.d/time.txt;
#    access_log  /etc/nginx/logs/ry.log  mylog;

#    location / {
#        root  /etc/nginx/html/dist/;
#        index	index.html index.htm;
#        try_files $uri $uri/ /index.html;
#    }
#}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ansible -&gt; hosts</strong></p><blockquote><p>[web]</p><p>192.168.0.[8:10]</p></blockquote><p><strong>playbook</strong></p><p><code>vim /etc/ansible/playbook/i-nginx.yml</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install nginx
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=nginx state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/etc/ansible/nginx dest=/etc backup=yes
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restarted nginx service
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> restartnginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start nginx service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=started enabled=true
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> startnginx
 
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restarted nginx service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx  state=restarted
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> reloaded nginx service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx  state=reloaded
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-\u6D4B\u8BD5\u5B89\u88C5-nginx" tabindex="-1"><a class="header-anchor" href="#_2-\u6D4B\u8BD5\u5B89\u88C5-nginx" aria-hidden="true">#</a> \u2461 \u6D4B\u8BD5\u5B89\u88C5 nginx</h4><p>\u5199\u5B8C\u4E86\u4EE5\u540E\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u8FD0\u884C\u4E86\uFF1A</p><blockquote><p>ansible-playbook -C i-nginx.yml</p></blockquote><p><img src="`+m+'" alt=""></p><blockquote><p>ansible-playbook i-nginx.yml</p></blockquote><p><img src="'+v+`" alt=""></p><p>\u770B\u770B\u4E24\u53F0\u673A\u5668\u7684\u7AEF\u53E3\u662F\u5426\u5F00\u542F\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin playbook<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &#39;ss -nutlp |grep nginx&#39;</span>
<span class="token number">192.168</span>.0.9 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
tcp    LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       *:80                    *:*                   users:<span class="token variable"><span class="token punctuation">((</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17874</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17873</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17872</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">))</span></span>
tcp    LISTEN     <span class="token number">0</span>      <span class="token number">128</span>    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                   users:<span class="token variable"><span class="token punctuation">((</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17874</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17873</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17872</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span></span>
<span class="token number">192.168</span>.0.8 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
tcp    LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       *:80                    *:*                   users:<span class="token variable"><span class="token punctuation">((</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">22272</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">22271</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">22270</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">))</span></span>
tcp    LISTEN     <span class="token number">0</span>      <span class="token number">128</span>    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                   users:<span class="token variable"><span class="token punctuation">((</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">22272</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">22271</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">22270</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span></span>
<span class="token number">192.168</span>.0.10 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
tcp    LISTEN     <span class="token number">0</span>      <span class="token number">128</span>       *:80                    *:*                   users:<span class="token variable"><span class="token punctuation">((</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17842</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17841</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17840</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">))</span></span>
tcp    LISTEN     <span class="token number">0</span>      <span class="token number">128</span>    <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                   users:<span class="token variable"><span class="token punctuation">((</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17842</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17841</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>&quot;nginx&quot;<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">17840</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span></span>
<span class="token punctuation">[</span>root@admin playbook<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-\u6D4B\u8BD5-start" tabindex="-1"><a class="header-anchor" href="#_3-\u6D4B\u8BD5-start" aria-hidden="true">#</a> \u2462 \u6D4B\u8BD5 start</h4><p>\u76F4\u63A5\u5F15\u7528\u6807\u7B7E\u3002\u4F46\u662F\u6211\u4EEC\u9700\u8981\u5148\u628A\u670D\u52A1\u5173\u95ED\uFF0C\u518D\u6765\u8FD0\u884C\u5267\u672C\u5E76\u5F15\u7528\u6807\u7B7E\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ansible web -m shell -a <span class="token string">&#39;systemctl stop nginx&#39;</span>
ansible-playbook i-nginx.yml -t startnginx
ansible web -m shell -a <span class="token string">&#39;ss -nutlp |grep nginx&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+b+`" alt=""></p><h4 id="_4-\u6D4B\u8BD5-restarted" tabindex="-1"><a class="header-anchor" href="#_4-\u6D4B\u8BD5-restarted" aria-hidden="true">#</a> \u2463 \u6D4B\u8BD5 restarted</h4><p>\u6211\u4EEC\u8FD8\u505A\u4E86\u4E00\u4E2A<code>notify</code>\uFF0C\u6765\u6D4B\u8BD5\u4E00\u4E0B\uFF1A</p><p>\u9996\u5148\uFF0C\u5B83\u7684\u89E6\u53D1\u6761\u4EF6\u662F\u914D\u7F6E\u6587\u4EF6\u88AB\u6539\u53D8\uFF0C\u6240\u4EE5\u6211\u4EEC\u53BB\u628A\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u7AEF\u53E3\u6539\u4E00\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/ansible/nginx/conf.d/ry.conf
	listen       <span class="token number">80</span><span class="token punctuation">;</span>
	
ansible-playbook i-nginx.yml -t restartnginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u6211\u4EEC\u91CD\u65B0\u52A0\u8F7D\u4E00\u4E0B\u8FD9\u4E2A\u5267\u672C\uFF1A</p><p><img src="`+g+'" alt=""></p><p>\u53D1\u73B0\u6211\u4EEC\u6267\u884C\u7684\u5C31\u662F restart \u6BB5\u4EE5\u53CA\u6211\u4EEC\u5B9A\u4E49\u7684<code>notify</code>\u90E8\u5206\u3002</p><p>\u6211\u4EEC\u6765\u770B\u4E00\u770B\u6211\u4EEC\u7684\u7AEF\u53E3\u53F7\uFF1A</p><blockquote><p>ansible web -m shell -a &#39;ss -ntlp | grep nginx&#39;</p></blockquote><p><img src="'+h+`" alt=""></p><p>\u53EF\u4EE5\u770B\u51FA\uFF0C\u6211\u4EEC\u7684nginx\u7AEF\u53E3\u5DF2\u7ECF\u53D8\u6210\u4E868080\u3002 \u3000#### \u2464 \u6D4B\u8BD5 reloaded</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install nginx
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=nginx state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/etc/ansible/nginx dest=/etc backup=yes
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> reloaded nginx service
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> reloadednginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start nginx service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=started enabled=true
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> startnginx
 
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restarted nginx service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx  state=restarted
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> reloaded nginx service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx  state=reloaded

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/ansible/nginx/conf.d/ry.conf
	listen       <span class="token number">81</span><span class="token punctuation">;</span>
	
ansible-playbook i-nginx.yml -t reloadednginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+q+'" alt=""></p><blockquote><p>ansible web -m shell -a &#39;ss -ntlp | grep nginx&#39;</p></blockquote><p><img src="'+y+`" alt=""></p><p>#### \u2465 \u5378\u8F7D nginx</p><p>vim uni-nginx.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
<span class="token comment">#    - name: stop nginx service</span>
<span class="token comment">#      service: name=nginx state=stopped</span>
<span class="token comment">#      tags: stopnginx</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> uninstall nginx
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> yum remove <span class="token punctuation">-</span>y nginx <span class="token important">&amp;&amp;</span> rm <span class="token punctuation">-</span>rf /etc/nginx <span class="token important">&amp;&amp;</span> ls /usr/sbin/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ansible-playbook uni-nginx.yml</code></p><h3 id="variables-\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#variables-\u53D8\u91CF" aria-hidden="true">#</a> variables \u53D8\u91CF</h3><p>\u4E0A\u6587\u4E2D\uFF0C\u6211\u4EEC\u8BF4\u5230\u4E86<code>variables</code>\u662F\u53D8\u91CF\uFF0C\u6709\u56DB\u79CD\u5B9A\u4E49\u65B9\u6CD5\uFF0C\u73B0\u5728\u6211\u4EEC\u5C31\u6765\u8BF4\u8BF4\u8FD9\u56DB\u79CD\u5B9A\u4E49\u65B9\u6CD5\uFF1A</p><h4 id="_1-facts-\u53EF\u76F4\u63A5\u8C03\u7528" tabindex="-1"><a class="header-anchor" href="#_1-facts-\u53EF\u76F4\u63A5\u8C03\u7528" aria-hidden="true">#</a> \u2460 facts \uFF1A\u53EF\u76F4\u63A5\u8C03\u7528</h4><p>\u4E0A\u4E00\u7BC7\u4E2D\uFF0C\u6211\u4EEC\u6709\u8BF4\u5230<code>setup</code>\u8FD9\u4E2A\u6A21\u5757\uFF0C\u8FD9\u4E2A\u6A21\u5757\u5C31\u662F\u901A\u8FC7\u8C03\u7528facts\u7EC4\u4EF6\u6765\u5B9E\u73B0\u7684\u3002\u6211\u4EEC\u8FD9\u91CC\u7684<code>variables</code>\u4E5F\u53EF\u4EE5\u76F4\u63A5\u8C03\u7528<code>facts</code>\u7EC4\u4EF6\u3002 \u3000\u5177\u4F53\u7684<code>facters</code>\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528<code>setup</code>\u6A21\u5757\u6765\u83B7\u53D6\uFF0C\u7136\u540E\u76F4\u63A5\u653E\u5165\u6211\u4EEC\u7684\u5267\u672C\u4E2D\u8C03\u7528\u5373\u53EF\u3002</p><h4 id="_2-\u7528\u6237\u81EA\u5B9A\u4E49\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_2-\u7528\u6237\u81EA\u5B9A\u4E49\u53D8\u91CF" aria-hidden="true">#</a> \u2461 \u7528\u6237\u81EA\u5B9A\u4E49\u53D8\u91CF</h4><p>\u6211\u4EEC\u4E5F\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u7528\u6237\u81EA\u5B9A\u4E49\u53D8\u91CF\uFF0C\u60F3\u8981\u81EA\u5B9A\u4E49\u53D8\u91CF\u6709\u4EE5\u4E0B\u4E24\u79CD\u65B9\u5F0F\uFF1A</p><blockquote><p>\u901A\u8FC7\u547D\u4EE4\u884C\u4F20\u5165</p></blockquote><p><code>ansible-playbook</code>\u547D\u4EE4\u7684\u547D\u4EE4\u884C\u4E2D\u7684<code>-e VARS, --extra-vars=VARS</code>\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u76F4\u63A5\u628A\u81EA\u5B9A\u4E49\u7684\u53D8\u91CF\u4F20\u5165\u3002</p><blockquote><p>\u5728playbook\u4E2D\u5B9A\u4E49\u53D8\u91CF</p></blockquote><p>\u6211\u4EEC\u4E5F\u53EF\u4EE5\u76F4\u63A5\u5728playbook\u4E2D\u5B9A\u4E49\u6211\u4EEC\u7684\u53D8\u91CF\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
\u3000\u3000<span class="token punctuation">-</span> <span class="token key atrule">var1</span><span class="token punctuation">:</span> value1
\u3000\u3000<span class="token punctuation">-</span> <span class="token punctuation">-</span> <span class="token key atrule">var2</span><span class="token punctuation">:</span> value2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-\u5B9A\u4E49\u5267\u672C" tabindex="-1"><a class="header-anchor" href="#_1-\u5B9A\u4E49\u5267\u672C" aria-hidden="true">#</a> \u2460 \u5B9A\u4E49\u5267\u672C</h4><p>\u6211\u4EEC\u5C31\u4F7F\u7528\u5168\u5C40\u66FF\u6362\u628A\u6211\u4EEC\u521A\u521A\u7F16\u8F91\u7684\u6587\u4EF6\u4FEE\u6539\u4E00\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/playbook/i-nginx.yml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/etc/ansible/<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=/etc backup=yes
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restarted <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> restart<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> state=started enabled=true
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> start<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
 
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restarted <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>  state=restarted
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> reloaded <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>  state=reloaded
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u6837\u4E00\u6765\uFF0C\u6211\u4EEC\u7684\u5267\u672C\u5C31\u5B9A\u4E49\u5B8C\u6210\u4E86\u3002</p><h4 id="_2-\u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2-\u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u2461 \u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6</h4><p>\u6211\u4EEC\u60F3\u8981\u5728\u88AB\u76D1\u7BA1\u7684\u673A\u5668\u4E0A\u5B89\u88C5\u4EC0\u4E48\u670D\u52A1\u7684\u8BDD\uFF0C\u5C31\u76F4\u63A5\u5728\u6211\u4EEC\u7684server\u7AEF\u4E0A\u628A\u8BE5\u670D\u52A1\u7684\u914D\u7F6E\u6587\u4EF6\u62F7\u8D1D\u5230\u6211\u4EEC\u7684<code>/tmp/</code>\u76EE\u5F55\u4E0B\u3002\u8FD9\u6837\u6211\u4EEC\u7684\u5267\u672C\u624D\u80FD\u6B63\u5E38\u8FD0\u884C\u3002</p><p>\u6211\u4EEC\u5C31\u4EE5<code>keepalived</code>\u670D\u52A1\u4E3A\u4F8B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># cp /etc/ansible/keepalived/keepalived.conf /tmp/keepalived.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3-\u8FD0\u884C\u5267\u672C-\u53D8\u91CF\u7531\u547D\u4EE4\u884C\u4F20\u5165" tabindex="-1"><a class="header-anchor" href="#_3-\u8FD0\u884C\u5267\u672C-\u53D8\u91CF\u7531\u547D\u4EE4\u884C\u4F20\u5165" aria-hidden="true">#</a> \u2462 \u8FD0\u884C\u5267\u672C\uFF0C\u53D8\u91CF\u7531\u547D\u4EE4\u884C\u4F20\u5165</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># ansible-playbook i-nginx.yml -e rpmname=keepalived</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+x+`" alt=""></p><h4 id="_4-\u4FEE\u6539\u5267\u672C-\u76F4\u63A5\u5B9A\u4E49\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_4-\u4FEE\u6539\u5267\u672C-\u76F4\u63A5\u5B9A\u4E49\u53D8\u91CF" aria-hidden="true">#</a> \u2463 \u4FEE\u6539\u5267\u672C\uFF0C\u76F4\u63A5\u5B9A\u4E49\u53D8\u91CF</h4><p>\u540C\u6837\u7684\uFF0C\u6211\u4EEC\u53EF\u4EE5\u76F4\u63A5\u5728\u5267\u672C\u4E2D\u628A\u53D8\u91CF\u5B9A\u4E49\u597D\uFF0C\u8FD9\u6837\u5C31\u4E0D\u9700\u8981\u5728\u901A\u8FC7\u547D\u4EE4\u884C\u4F20\u5165\u4E86\u3002\u4EE5\u540E\u60F3\u8981\u5B89\u88C5\u4E0D\u540C\u7684\u670D\u52A1\uFF0C\u76F4\u63A5\u5728\u5267\u672C\u91CC\u628A\u53D8\u91CF\u4FEE\u6539\u4E00\u4E0B\u5373\u53EF\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/playbook/i-nginx.yml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">rpmname</span><span class="token punctuation">:</span> keepalived
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/etc/ansible/<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=/etc backup=yes
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restarted <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> restart<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> state=started enabled=true
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> start<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
 
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restarted <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>  state=restarted
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> reloaded <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>  state=reloaded
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-\u8FD0\u884C\u5B9A\u4E49\u8FC7\u53D8\u91CF\u7684\u5267\u672C" tabindex="-1"><a class="header-anchor" href="#_5-\u8FD0\u884C\u5B9A\u4E49\u8FC7\u53D8\u91CF\u7684\u5267\u672C" aria-hidden="true">#</a> \u2464 \u8FD0\u884C\u5B9A\u4E49\u8FC7\u53D8\u91CF\u7684\u5267\u672C</h4><p>\u6211\u4EEC\u521A\u521A\u5DF2\u7ECF\u628A\u53D8\u91CF\u5B9A\u4E49\u5728\u5267\u672C\u91CC\u9762\u4E86\u3002\u73B0\u5728\u6211\u4EEC\u6765\u8FD0\u884C\u4E00\u4E0B\u8BD5\u8BD5\u770B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># ansible-playbook i-nginx.yml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+f+'" alt=""></p><p>\u53D1\u73B0\u8FD9\u6837\u4E5F\u662F\u53EF\u4EE5\u7684</p><h4 id="_3-\u901A\u8FC7roles\u4F20\u9012\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_3-\u901A\u8FC7roles\u4F20\u9012\u53D8\u91CF" aria-hidden="true">#</a> \u2462 \u901A\u8FC7roles\u4F20\u9012\u53D8\u91CF</h4>',333),L=s("\u5177\u4F53\u7684\uFF0C\u6211\u4EEC\u4E0B\u6587\u4E2D\u8BF4\u5230 roles \u7684\u65F6\u5019\u518D\u8BE6\u7EC6\u8BF4\u660E\u3002\u8FD9\u91CC\u662F"),T={href:"https://www.cnblogs.com/keerya/p/8004566.html#jump",target:"_blank",rel:"noopener noreferrer"},j=s("\u4F20\u9001\u5E26"),P=t(`<h4 id="_4-host-inventory" tabindex="-1"><a class="header-anchor" href="#_4-host-inventory" aria-hidden="true">#</a> \u2463 Host Inventory</h4><p>\u6211\u4EEC\u4E5F\u53EF\u4EE5\u76F4\u63A5\u5728\u4E3B\u673A\u6E05\u5355\u4E2D\u5B9A\u4E49\u3002</p><blockquote><p>\u5411\u4E0D\u540C\u7684\u4E3B\u673A\u4F20\u9012\u4E0D\u540C\u7684\u53D8\u91CF\uFF1A</p></blockquote><div class="language-ABAP ext-ABAP line-numbers-mode"><pre class="language-ABAP"><code>IP/HOSTNAME varaiable=value var2=value2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5411\u7EC4\u4E2D\u7684\u4E3B\u673A\u4F20\u9012\u76F8\u540C\u7684\u53D8\u91CF\uFF1A</p></blockquote><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">web:vars</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">variable</span><span class="token punctuation">=</span><span class="token value attr-value">value</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="templates-\u6A21\u677F" tabindex="-1"><a class="header-anchor" href="#templates-\u6A21\u677F" aria-hidden="true">#</a> templates \u6A21\u677F</h3><p>\u6A21\u677F\u662F\u4E00\u4E2A\u6587\u672C\u6587\u4EF6\uFF0C\u5D4C\u5957\u6709\u811A\u672C\uFF08\u4F7F\u7528\u6A21\u677F\u7F16\u7A0B\u8BED\u8A00\u7F16\u5199\uFF09\u3002</p><p><code>Jinja2</code>\uFF1AJinja2\u662Fpython\u7684\u4E00\u79CD\u6A21\u677F\u8BED\u8A00\uFF0C\u4EE5Django\u7684\u6A21\u677F\u8BED\u8A00\u4E3A\u539F\u672C\u3002 \u6A21\u677F\u652F\u6301\uFF1A</p><blockquote><p>\u5B57\u7B26\u4E32\uFF1A\u4F7F\u7528\u5355\u5F15\u53F7\u6216\u53CC\u5F15\u53F7\uFF1B</p><p>\u6570\u5B57\uFF1A\u6574\u6570\uFF0C\u6D6E\u70B9\u6570\uFF1B</p><p>\u5217\u8868\uFF1A[item1, item2, ...]</p><p>\u5143\u7EC4\uFF1A(item1, item2, ...)</p><p>\u5B57\u5178\uFF1A{key1:value1, key2:value2, ...}</p><p>\u5E03\u5C14\u578B\uFF1Atrue/false</p><p>\u7B97\u672F\u8FD0\u7B97\uFF1A +, -, *, /, //, %, **</p><p>\u6BD4\u8F83\u64CD\u4F5C\uFF1A ==, !=, &gt;, &gt;=, &lt;, &lt;=</p><p>\u903B\u8F91\u8FD0\u7B97\uFF1A and, or, not</p></blockquote><p>\u901A\u5E38\u6765\u8BF4\uFF0C\u6A21\u677F\u90FD\u662F\u901A\u8FC7\u5F15\u7528\u53D8\u91CF\u6765\u8FD0\u7528\u7684\u3002</p><h4 id="_1-\u5B9A\u4E49\u6A21\u677F" tabindex="-1"><a class="header-anchor" href="#_1-\u5B9A\u4E49\u6A21\u677F" aria-hidden="true">#</a> \u2460 \u5B9A\u4E49\u6A21\u677F</h4><p>\u6211\u4EEC\u76F4\u63A5\u628A\u4E4B\u524D\u5B9A\u4E49\u7684<code>/tmp/nginx.conf</code>\u6539\u4E2A\u540D\uFF0C\u7136\u540E\u7F16\u8F91\u4E00\u4E0B\uFF0C\u5C31\u53EF\u4EE5\u5B9A\u4E49\u6210\u6211\u4EEC\u7684\u6A21\u677F\u6587\u4EF6\u4E86\uFF1A</p><div class="language-perl ext-perl line-numbers-mode"><pre class="language-perl"><code>cd <span class="token operator">/</span>templates
vim <span class="token operator">.</span><span class="token operator">/</span>nginx<span class="token regex">/conf/nginx</span><span class="token operator">.</span>conf<span class="token operator">.</span>j2 <span class="token operator">||</span> vim <span class="token operator">.</span><span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">.</span>d<span class="token operator">/</span>ry<span class="token operator">.</span>conf<span class="token operator">.</span>j2
	worker_processes  <span class="token punctuation">{</span><span class="token punctuation">{</span> ansible_processor_vcpus <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	listen       <span class="token punctuation">{</span><span class="token punctuation">{</span> nginxport <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-\u4FEE\u6539\u5267\u672C" tabindex="-1"><a class="header-anchor" href="#_2-\u4FEE\u6539\u5267\u672C" aria-hidden="true">#</a> \u2461 \u4FEE\u6539\u5267\u672C</h4><p>\u6211\u4EEC\u73B0\u5728\u9700\u8981\u53BB\u4FEE\u6539\u5267\u672C\u6765\u5B9A\u4E49\u53D8\u91CF\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/playbook/i-nginx.yml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">rpmname</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">nginxport</span><span class="token punctuation">:</span> <span class="token number">8888</span>
      <span class="token key atrule">ansible_processor_vcpus</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/etc/ansible/templates/<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=/etc backup=yes
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> restarted <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> restart<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> state=started enabled=true
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> start<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>
 
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restarted <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>  state=restarted
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> reloaded <span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span> service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> rpmname <span class="token punctuation">}</span><span class="token punctuation">}</span>  state=reloaded
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-\u8FD0\u884C\u5267\u672C" tabindex="-1"><a class="header-anchor" href="#_3-\u8FD0\u884C\u5267\u672C" aria-hidden="true">#</a> \u2462 \u8FD0\u884C\u5267\u672C</h4><p>\u4E0A\u9762\u7684\u51C6\u5907\u5DE5\u4F5C\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u53BB\u8FD0\u884C\u5267\u672C\u4E86\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ansible-playbook i-nginx.yml
ansible-playbook i-nginx.yml -t restartnginx
ansible web -m shell -a <span class="token string">&#39;ss -ntlp | grep nginx&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6761\u4EF6\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u6761\u4EF6\u6D4B\u8BD5" aria-hidden="true">#</a> \u6761\u4EF6\u6D4B\u8BD5</h3><p>when\u8BED\u53E5\uFF1A\u5728task\u4E2D\u4F7F\u7528\uFF0Cjinja2\u7684\u8BED\u6CD5\u683C\u5F0F\u3002</p><div class="language-vhdl ext-vhdl line-numbers-mode"><pre class="language-vhdl"><code>tasks<span class="token punctuation">:</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> install conf <span class="token keyword">file</span> <span class="token keyword">to</span> centos7
    template<span class="token punctuation">:</span> src<span class="token operator">=</span>files<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>c7<span class="token punctuation">.</span>j2
    <span class="token keyword">when</span><span class="token punctuation">:</span> ansible_distribution_major_version <span class="token operator">=</span><span class="token operator">=</span> <span class="token string">&quot;7&quot;</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> install conf <span class="token keyword">file</span> <span class="token keyword">to</span> centos6
    template<span class="token punctuation">:</span> src<span class="token operator">=</span>files<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>c6<span class="token punctuation">.</span>j2
    <span class="token keyword">when</span><span class="token punctuation">:</span> ansible_distribution_major_version <span class="token operator">=</span><span class="token operator">=</span> <span class="token string">&quot;6&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5FAA\u73AF\uFF1A\u8FED\u4EE3\uFF0C\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\u4EFB\u52A1\uFF1B</p><p>\u5BF9\u8FED\u4EE3\u9879\u7684\u5F15\u7528\uFF0C\u56FA\u5B9A\u53D8\u91CF\u540D\u4E3A&quot;item&quot;\uFF0C\u800C\u540E\uFF0C\u8981\u5728task\u4E2D\u4F7F\u7528with_items\u7ED9\u5B9A\u8981\u8FED\u4EE3\u7684\u5143\u7D20\u5217\u8868\uFF1B \u4E3E\u4F8B\u5982\u4E0B\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> unstall web packages
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=absent
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> httpd
        <span class="token punctuation">-</span> php
        <span class="token punctuation">-</span> php<span class="token punctuation">-</span>mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5B57\u5178" tabindex="-1"><a class="header-anchor" href="#\u5B57\u5178" aria-hidden="true">#</a> \u5B57\u5178</h3><p>ansible playbook \u8FD8\u652F\u6301\u5B57\u5178\u529F\u80FD\u3002\u4E3E\u4F8B\u5982\u4E0B\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install some packages
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> nginx
        <span class="token punctuation">-</span> memcached
        <span class="token punctuation">-</span> php<span class="token punctuation">-</span>fpm
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add some groups
      <span class="token key atrule">group</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> group11
        <span class="token punctuation">-</span> group12
        <span class="token punctuation">-</span> group13
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> add some users
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.name <span class="token punctuation">}</span><span class="token punctuation">}</span> group=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.group <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;user11&#39;</span><span class="token punctuation">,</span> <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">&#39;group11&#39;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;user12&#39;</span><span class="token punctuation">,</span> <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">&#39;group12&#39;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;user13&#39;</span><span class="token punctuation">,</span> <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">&#39;group13&#39;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u89D2\u8272\u8BA2\u5236-roles" tabindex="-1"><a class="header-anchor" href="#\u89D2\u8272\u8BA2\u5236-roles" aria-hidden="true">#</a> \u89D2\u8272\u8BA2\u5236\uFF1Aroles</h3><h4 id="_1-\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_1-\u7B80\u4ECB" aria-hidden="true">#</a> \u2460 \u7B80\u4ECB</h4><p>\u5BF9\u4E8E\u4EE5\u4E0A\u6240\u6709\u7684\u65B9\u5F0F\u6709\u4E2A\u5F0A\u7AEF\u5C31\u662F\u65E0\u6CD5\u5B9E\u73B0\u590D\u7528\u5047\u8BBE\u5728\u540C\u65F6\u90E8\u7F72Web\u3001db\u3001ha \u65F6\u6216\u4E0D\u540C\u670D\u52A1\u5668\u7EC4\u5408\u4E0D\u540C\u7684\u5E94\u7528\u5C31\u9700\u8981\u5199\u591A\u4E2Ayml\u6587\u4EF6\u3002\u5F88\u96BE\u5B9E\u73B0\u7075\u6D3B\u7684\u8C03\u7528\u3002</p><p>roles \u7528\u4E8E\u5C42\u6B21\u6027\u3001\u7ED3\u6784\u5316\u5730\u7EC4\u7EC7playbook\u3002roles \u80FD\u591F\u6839\u636E\u5C42\u6B21\u578B\u7ED3\u6784\u81EA\u52A8\u88C5\u8F7D\u53D8\u91CF\u6587\u4EF6\u3001tasks\u4EE5\u53CAhandlers\u7B49\u3002</p><p>\u8981\u4F7F\u7528roles\u53EA\u9700\u8981\u5728playbook\u4E2D\u4F7F\u7528include\u6307\u4EE4\u5373\u53EF\u3002\u7B80\u5355\u6765\u8BB2\uFF0Croles\u5C31\u662F\u901A\u8FC7\u5206\u522B\u5C06\u53D8\u91CF(vars)\u3001\u6587\u4EF6(file)\u3001\u4EFB\u52A1(tasks)\u3001\u6A21\u5757(modules)\u53CA\u5904\u7406\u5668(handlers)\u653E\u7F6E\u4E8E\u5355\u72EC\u7684\u76EE\u5F55\u4E2D\uFF0C\u5E76\u53EF\u4EE5\u4FBF\u6377\u5730include\u5B83\u4EEC\u7684\u4E00\u79CD\u673A\u5236\u3002</p><p>\u89D2\u8272\u4E00\u822C\u7528\u4E8E\u57FA\u4E8E\u4E3B\u673A\u6784\u5EFA\u670D\u52A1\u7684\u573A\u666F\u4E2D\uFF0C\u4F46\u4E5F\u53EF\u4EE5\u662F\u7528\u4E8E\u6784\u5EFA\u5B88\u62A4\u8FDB\u7A0B\u7B49\u573A\u666F\u4E2D\u3002</p><h4 id="_2-\u76EE\u5F55\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_2-\u76EE\u5F55\u8BF4\u660E" aria-hidden="true">#</a> \u2461 \u76EE\u5F55\u8BF4\u660E</h4><p><strong>xxx\u6A21\u5757\u4E0B\u9762\u7684\u6BCF\u4E2A\u76EE\u5F55\u81F3\u5C11\u5E94\u8BE5\u6709\u4E00\u4E2A\u540D\u4E3Amain.yml\u7684\u6587\u4EF6\uFF0C\u5176\u5B83\u7684\u6587\u4EF6\u9700\u8981\u7531main.yml\u8FDB\u884C\u201C\u5305\u542B\u201D\u8C03\u7528\uFF1B</strong></p><div class="language-tex ext-tex line-numbers-mode"><pre class="language-tex"><code><span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span># tree
.
\u251C\u2500\u2500 xxx\u6A21\u5757
\u2502   \u251C\u2500\u2500 default		# \u7528\u4E8E\u8BBE\u5B9A\u9ED8\u8BA4\u53D8\u91CF\uFF1B
\u2502   \u251C\u2500\u2500 files		# \u5B58\u50A8\u7531 copy \u6216 script \u7B49\u6A21\u5757\u8C03\u7528\u7684\u6587\u4EF6\uFF1B
\u2502   \u251C\u2500\u2500 handlers	# \u7528\u4E8E\u5B9A\u4E49\u5404 handler \u5904\u7406\u5668\uFF1B
\u2502   \u251C\u2500\u2500 meta		# \u5B9A\u4E49\u5F53\u524D\u89D2\u8272\u7684\u7279\u6B8A\u8BBE\u5B9A\u53CA\u5176\u4F9D\u8D56\u5173\u7CFB\uFF1B
\u2502   \u251C\u2500\u2500 tasks		# \u7528\u4E8E\u5B9A\u4E49\u5404 task;
\u2502   \u251C\u2500\u2500 templates	# \u6A21\u677F\u6587\u672C\uFF1B
\u2502   \u2514\u2500\u2500 vars		# \u7528\u4E8E\u5B9A\u4E49\u5404 variable \u53D8\u91CF
| ......
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-\u5728roles\u76EE\u5F55\u4E0B\u751F\u6210\u5BF9\u5E94\u7684\u76EE\u5F55\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#_3-\u5728roles\u76EE\u5F55\u4E0B\u751F\u6210\u5BF9\u5E94\u7684\u76EE\u5F55\u7ED3\u6784" aria-hidden="true">#</a> \u2462 \u5728roles\u76EE\u5F55\u4E0B\u751F\u6210\u5BF9\u5E94\u7684\u76EE\u5F55\u7ED3\u6784</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin ansible<span class="token punctuation">]</span><span class="token comment"># cd roles/</span>
<span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># mkdir -pv ./{nginx,mysql,httpd}/{files,templates,vars,tasks,handlers,meta,default}</span>
<span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># touch ./{nginx,mysql,httpd}/{files,templates,vars,tasks,handlers,meta,default}/main.yml</span>
<span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># tree</span>
<span class="token builtin class-name">.</span>
\u251C\u2500\u2500 httpd
\u2502   \u251C\u2500\u2500 default
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 files
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 handlers
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 meta
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 tasks
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 templates
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u2514\u2500\u2500 vars
\u2502       \u2514\u2500\u2500 main.yml
\u251C\u2500\u2500 mysql
\u2502   \u251C\u2500\u2500 default
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 files
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 handlers
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 meta
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 tasks
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 templates
\u2502   \u2502   \u2514\u2500\u2500 main.yml
\u2502   \u2514\u2500\u2500 vars
\u2502       \u2514\u2500\u2500 main.yml
\u2514\u2500\u2500 nginx
    \u251C\u2500\u2500 default
    \u2502   \u2514\u2500\u2500 main.yml
    \u251C\u2500\u2500 files
    \u2502   \u2514\u2500\u2500 main.yml
    \u251C\u2500\u2500 handlers
    \u2502   \u2514\u2500\u2500 main.yml
    \u251C\u2500\u2500 meta
    \u2502   \u2514\u2500\u2500 main.yml
    \u251C\u2500\u2500 tasks
    \u2502   \u2514\u2500\u2500 main.yml
    \u251C\u2500\u2500 templates
    \u2502   \u2514\u2500\u2500 main.yml
    \u2514\u2500\u2500 vars
        \u2514\u2500\u2500 main.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-\u5B9A\u4E49-tasks-\u4EFB\u52A1\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_4-\u5B9A\u4E49-tasks-\u4EFB\u52A1\u6587\u4EF6" aria-hidden="true">#</a> \u2463 \u5B9A\u4E49 tasks \u4EFB\u52A1\u6587\u4EF6</h4><p>rpm\u5305\u4E0B\u8F7D\uFF1A</p><blockquote><p>wget http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.22.0-1.el7.ngx.x86_64.rpm</p><p>chmod -R 777 nginx-1.22.0-1.el7.ngx.x86_64.rpm</p></blockquote><h4 id="nginx-conf" tabindex="-1"><a class="header-anchor" href="#nginx-conf" aria-hidden="true">#</a> nginx.conf</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>
user nginx;

worker_processes <span class="token punctuation">{</span><span class="token punctuation">{</span> ansible_processor_vcpus <span class="token punctuation">}</span><span class="token punctuation">}</span>;

error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

include /usr/share/nginx/modules/<span class="token important">*.conf;</span>

events <span class="token punctuation">{</span>
    worker_connections 1024;
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    log_format  main  &#39;$remote_addr <span class="token punctuation">-</span> $remote_user <span class="token punctuation">[</span>$time_local<span class="token punctuation">]</span> &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet<span class="token punctuation">-</span>stream;

    include /etc/nginx/conf.d/<span class="token important">*.conf;</span>

    server <span class="token punctuation">{</span>
        listen       <span class="token punctuation">{</span><span class="token punctuation">{</span> nginxprot <span class="token punctuation">}</span><span class="token punctuation">}</span>;
        listen       <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> nginxprot <span class="token punctuation">}</span><span class="token punctuation">}</span>;
        server_name  _;
        
        root         /usr/share/nginx/html;

        error_page 404 /404.html;
        location = /404.html <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        error_page 500 502 503 504 /50x.html;
        location = /50x.html <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vim /etc/ansible/roles/nginx/tasks/main.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">include</span><span class="token punctuation">:</span> install.yml
<span class="token punctuation">-</span> <span class="token key atrule">include</span><span class="token punctuation">:</span> copy.yml
<span class="token punctuation">-</span> <span class="token key atrule">include</span><span class="token punctuation">:</span> start.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>install.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install nginx
  <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=nginx state=present
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>copy.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy config
  <span class="token key atrule">template</span><span class="token punctuation">:</span> src=/etc/ansible/roles/nginx/templates/nginx.conf.j2 dest=/etc/nginx/nginx.conf mode=0777
  <span class="token comment"># notify: restarted\u3001reloaded \u8FD9\u91CC\u5BF9\u5E94\u7684\u89E6\u53D1\u662F handlers \u5904\u7406\u5668</span>
  <span class="token key atrule">notify</span><span class="token punctuation">:</span> restarted nginx service
  <span class="token comment"># tags: restartnginx\u3001reloadnginx</span>
  <span class="token key atrule">tags</span><span class="token punctuation">:</span> restartnginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>start.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start nginx service
  <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=started enabled=true
  <span class="token key atrule">tags</span><span class="token punctuation">:</span> startnginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-\u653E\u7F6E\u6211\u4EEC\u6240\u9700\u8981\u7684\u6587\u4EF6\u5230\u6307\u5B9A\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#_5-\u653E\u7F6E\u6211\u4EEC\u6240\u9700\u8981\u7684\u6587\u4EF6\u5230\u6307\u5B9A\u76EE\u5F55" aria-hidden="true">#</a> \u2464 \u653E\u7F6E\u6211\u4EEC\u6240\u9700\u8981\u7684\u6587\u4EF6\u5230\u6307\u5B9A\u76EE\u5F55</h4><p>\u56E0\u4E3A\u6211\u4EEC\u5B9A\u4E49\u7684\u89D2\u8272\u5DF2\u7ECF\u6709\u4E86\u65B0\u7684\u7EC4\u6210\u65B9\u5F0F\uFF0C\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u628A\u6587\u4EF6\u90FD\u653E\u5230\u6307\u5B9A\u7684\u4F4D\u7F6E\uFF0C\u8FD9\u6837\uFF0C\u624D\u80FD\u8BA9\u914D\u7F6E\u6587\u4EF6\u627E\u5230\u8FD9\u4E9B\u5E76\u8FDB\u884C\u52A0\u8F7D\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin nginx<span class="token punctuation">]</span><span class="token comment"># tree</span>
\u251C\u2500\u2500 default
\u2502   \u2514\u2500\u2500 main.yml
\u251C\u2500\u2500 files
\u2502   \u251C\u2500\u2500 main.yml
\u2502   \u2514\u2500\u2500 nginx-1.22.0-1.el7.ngx.x86_64.rpm
\u251C\u2500\u2500 handlers
\u2502   \u2514\u2500\u2500 main.yml
\u251C\u2500\u2500 meta
\u2502   \u2514\u2500\u2500 main.yml
\u251C\u2500\u2500 tasks
\u2502   \u251C\u2500\u2500 copy.yml
\u2502   \u251C\u2500\u2500 install.yml
\u2502   \u251C\u2500\u2500 main.yml
\u2502   \u2514\u2500\u2500 start.yml
\u251C\u2500\u2500 templates
\u2502   \u251C\u2500\u2500 default.conf.j2
\u2502   \u251C\u2500\u2500 html
\u2502   \u2502   \u251C\u2500\u2500 <span class="token number">404</span>.html
\u2502   \u2502   \u251C\u2500\u2500 50x.html
\u2502   \u2502   \u2514\u2500\u2500 index.html
\u2502   \u251C\u2500\u2500 logs
\u2502   \u251C\u2500\u2500 main.yml
\u2502   \u251C\u2500\u2500 nginx.conf.j2
\u2502   \u2514\u2500\u2500 time.txt
\u2514\u2500\u2500 vars
    \u2514\u2500\u2500 main.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-\u5B9A\u4E49-vars-\u53D8\u91CF\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_6-\u5B9A\u4E49-vars-\u53D8\u91CF\u6587\u4EF6" aria-hidden="true">#</a> \u2465 \u5B9A\u4E49 vars \u53D8\u91CF\u6587\u4EF6</h4><p>\u6211\u4EEC\u5728\u6A21\u677F\u4E2D\u5B9A\u4E49\u7684\u53D8\u91CF\uFF0C\u4E5F\u8981\u53BB\u914D\u7F6E\u6587\u4EF6\u4E2D\u52A0\u4E0A\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin nginx<span class="token punctuation">]</span><span class="token comment"># vim ./vars/main.yml</span>

nginxprot: <span class="token number">5120</span>
ansible_processor_vcpus: <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-\u5B9A\u4E49-handlers-\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_7-\u5B9A\u4E49-handlers-\u6587\u4EF6" aria-hidden="true">#</a> \u2466 \u5B9A\u4E49 handlers \u6587\u4EF6</h4><p>\u6211\u4EEC\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u5B9A\u4E49\u4E86<code>notify</code>\uFF0C\u6240\u4EE5\u6211\u4E48\u4E5F\u9700\u8981\u5B9A\u4E49<code>handlers</code>\uFF0C\u6211\u4EEC\u6765\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin nginx<span class="token punctuation">]</span><span class="token comment"># vim ./handlers/main.yml</span>

- name: restarted nginx <span class="token function">service</span>
  service: <span class="token assign-left variable">name</span><span class="token operator">=</span>nginx <span class="token assign-left variable">state</span><span class="token operator">=</span>restarted
- name: reloaded nginx <span class="token function">service</span>
  service: <span class="token assign-left variable">name</span><span class="token operator">=</span>nginx <span class="token assign-left variable">state</span><span class="token operator">=</span>reloaded

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-\u5B9A\u4E49-roles-\u5267\u672C\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_8-\u5B9A\u4E49-roles-\u5267\u672C\u6587\u4EF6" aria-hidden="true">#</a> \u2467 \u5B9A\u4E49 roles \u5267\u672C\u6587\u4EF6</h4><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u5C31\u6765\u5B9A\u4E49\u5267\u672C\u6587\u4EF6\uFF0C\u7531\u4E8E\u5927\u90E8\u5206\u8BBE\u7F6E\u6211\u4EEC\u90FD\u5355\u72EC\u914D\u7F6E\u5728\u4E86roles\u91CC\u9762\uFF0C\u6240\u4EE5\uFF0C\u63A5\u4E0B\u6765\u5267\u672C\u5C31\u53EA\u9700\u8981\u5199\u4E00\u70B9\u70B9\u5185\u5BB9\u5373\u53EF\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># vim ./roles.yml</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> nginx

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-\u542F\u52A8\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_9-\u542F\u52A8\u670D\u52A1" aria-hidden="true">#</a> \u2468 \u542F\u52A8\u670D\u52A1</h4><p>\u5267\u672C\u5B9A\u4E49\u5B8C\u6210\u4EE5\u540E\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u6765\u542F\u52A8\u670D\u52A1\u4E86\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># ansible-playbook roles.yml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+_+`" alt=""></p><h4 id="_10-\u542F\u52A8\u8FC7\u540E\u7167\u4F8B\u67E5\u770B\u7AEF\u53E3\u53F7" tabindex="-1"><a class="header-anchor" href="#_10-\u542F\u52A8\u8FC7\u540E\u7167\u4F8B\u67E5\u770B\u7AEF\u53E3\u53F7" aria-hidden="true">#</a> \u2469 \u542F\u52A8\u8FC7\u540E\u7167\u4F8B\u67E5\u770B\u7AEF\u53E3\u53F7\uFF1A</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &quot;ss -ntulp |grep 5120&quot;</span>

<span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># ansible web -m shell -a &quot;ss -ntulp |grep nginx&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+w+`" alt=""></p><h4 id="_11-\u6D4B\u8BD5\u4FEE\u6539\u540E\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6-restartnginx" tabindex="-1"><a class="header-anchor" href="#_11-\u6D4B\u8BD5\u4FEE\u6539\u540E\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6-restartnginx" aria-hidden="true">#</a> 11 \u6D4B\u8BD5\u4FEE\u6539\u540E\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6 - restartnginx</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin nginx<span class="token punctuation">]</span><span class="token comment"># vim ./vars/main.yml</span>

nginxprot: <span class="token number">5133</span>

<span class="token punctuation">[</span>root@admin nginx<span class="token punctuation">]</span><span class="token comment"># vim ./tasks/copy.yml</span>
- name: copy config
  template: <span class="token assign-left variable">src</span><span class="token operator">=</span>/etc/ansible/roles/nginx/templates/nginx.conf.j2 <span class="token assign-left variable">dest</span><span class="token operator">=</span>/etc/nginx/nginx.conf <span class="token assign-left variable">mode</span><span class="token operator">=</span>0777
  notify: restarted nginx <span class="token function">service</span>
  tags: restartnginx

<span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># ansible-playbook roles.yml -t restartnginx</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+S+`" alt=""></p><h4 id="_12-\u6D4B\u8BD5\u4FEE\u6539\u540E\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6-reloadnginx" tabindex="-1"><a class="header-anchor" href="#_12-\u6D4B\u8BD5\u4FEE\u6539\u540E\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6-reloadnginx" aria-hidden="true">#</a> 12 \u6D4B\u8BD5\u4FEE\u6539\u540E\u91CD\u65B0\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6 - reloadnginx</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@admin nginx<span class="token punctuation">]</span><span class="token comment"># vim ./vars/main.yml</span>

nginxprot: <span class="token number">5166</span>

<span class="token punctuation">[</span>root@admin nginx<span class="token punctuation">]</span><span class="token comment"># vim ./tasks/copy.yml</span>
- name: copy config
  template: <span class="token assign-left variable">src</span><span class="token operator">=</span>/etc/ansible/roles/nginx/templates/nginx.conf.j2 <span class="token assign-left variable">dest</span><span class="token operator">=</span>/etc/nginx/nginx.conf <span class="token assign-left variable">mode</span><span class="token operator">=</span>0777
  notify: reloaded nginx <span class="token function">service</span>
  tags: reloadnginx

<span class="token punctuation">[</span>root@admin roles<span class="token punctuation">]</span><span class="token comment"># ansible-playbook roles.yml -t reloadnginx</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+A+'" alt=""></p><h2 id="\u516B\u3001ansible-galaxy" tabindex="-1"><a class="header-anchor" href="#\u516B\u3001ansible-galaxy" aria-hidden="true">#</a> \u516B\u3001ansible-galaxy</h2>',80);function $(M,R){const a=i("ExternalLinkIcon");return o(),l("div",null,[N,n("p",null,[n("a",C,[G,e(a)])]),n("p",null,[n("a",H,[D,e(a)])]),I,n("p",null,[L,n("a",T,[j,e(a)])]),P])}var O=p(E,[["render",$],["__file","ansible.html.vue"]]);export{O as default};
