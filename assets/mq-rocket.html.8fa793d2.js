import{_ as p}from"./plugin-vue_export-helper.21dcd24c.js";import{o as e,c as o,b as n,e as c,a as s,d as a,r as l}from"./app.c37b87a5.js";var u="/assets/true-image-20220713143224748.f96aab54.png",i="/assets/true-image-20220713151738323.02fe672c.png",k="/assets/true-image-20220713164803431.4f23f500.png",r="/assets/true-image-20220713164815150.33499b57.png",d="/assets/true-image-20220714105719209.979f020b.png",m="/assets/true-image-20220714102811856.474636f5.png",v="/assets/true-image-20220714102824828.379dfa84.png",g="/assets/true-image-20220716132334903.303b872a.png",b="/assets/true-image-20220716134814483.6447b2f0.png",y="/assets/true-image-20220716135827145.8e5e916b.png";const h={},w=s('<h1 id="rocketmq" tabindex="-1"><a class="header-anchor" href="#rocketmq" aria-hidden="true">#</a> RocketMQ</h1><p>https://rocketmq.apache.org</p><p>https://github.com/apache/rocketmq</p><p>https://github.com/apache/rocketmq/tree/master/docs/cn</p><p>https://gitee.com/MFork/rocketmq/tree/develop/docs/cn</p><h2 id="_1\u3001\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6982\u5FF5" aria-hidden="true">#</a> 1\u3001\u6982\u5FF5</h2><h3 id="\u90E8\u7F72\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72\u6A21\u5F0F" aria-hidden="true">#</a> \u90E8\u7F72\u6A21\u5F0F</h3><table><thead><tr><th>\u90E8\u7F72\u6A21\u5F0F</th><th style="text-align:left;">\u5B9A\u4E49</th><th style="text-align:left;">\u4F18\u70B9</th><th style="text-align:left;">\u7F3A\u70B9</th><th style="text-align:left;">\u5176\u4ED6</th></tr></thead><tbody><tr><td>\u5355 master \u6A21\u5F0F</td><td style="text-align:left;">\u4E5F\u5C31\u662F\u53EA\u6709\u4E00\u4E2A master \u8282\u70B9\uFF0C\u79F0\u4E0D\u4E0A\u662F\u96C6\u7FA4\uFF0C\u4E00\u65E6\u8FD9\u4E2A master \u8282\u70B9\u5B95\u673A\uFF0C\u90A3\u4E48\u6574\u4E2A\u670D\u52A1\u5C31\u4E0D\u53EF\u7528\uFF0C\u9002\u5408\u4E2A\u4EBA\u5B66\u4E60\u4F7F\u7528\u3002</td><td style="text-align:left;">-</td><td style="text-align:left;">-</td><td style="text-align:left;">-</td></tr><tr><td>\u591A master \u6A21\u5F0F</td><td style="text-align:left;">\u591A\u4E2A master \u8282\u70B9\u7EC4\u6210\u96C6\u7FA4\uFF0C\u5355\u4E2A master \u8282\u70B9\u5B95\u673A\u6216\u8005\u91CD\u542F\u5BF9\u5E94\u7528\u6CA1\u6709\u5F71\u54CD\u3002</td><td style="text-align:left;">\u6240\u6709\u6A21\u5F0F\u4E2D\u6027\u80FD\u6700\u9AD8</td><td style="text-align:left;">\u5355\u4E2A master \u8282\u70B9\u5B95\u673A\u671F\u95F4\uFF0C\u672A\u88AB\u6D88\u8D39\u7684\u6D88\u606F\u5728\u8282\u70B9\u6062\u590D\u4E4B\u524D\u4E0D\u53EF\u7528\uFF0C\u6D88\u606F\u7684\u5B9E\u65F6\u6027\u5C31\u53D7\u5230\u5F71\u54CD\u3002</td><td style="text-align:left;">\u4F7F\u7528\u540C\u6B65\u5237\u76D8\u53EF\u4EE5\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u5931\uFF0C\u540C\u65F6 Topic \u76F8\u5BF9\u5E94\u7684 queue \u5E94\u8BE5\u5206\u5E03\u5728\u96C6\u7FA4\u4E2D\u5404\u4E2A\u8282\u70B9\uFF0C\u800C\u4E0D\u662F\u53EA\u5728\u67D0\u5404\u8282\u70B9\u4E0A\uFF0C\u5426\u5219\uFF0C\u8BE5\u8282\u70B9\u5B95\u673A\u4F1A\u5BF9\u8BA2\u9605\u8BE5 topic \u7684\u5E94\u7528\u9020\u6210\u5F71\u54CD\u3002</td></tr><tr><td>\u591A master \u591A slave <strong>\u5F02\u6B65</strong>\u590D\u5236\u6A21\u5F0F</td><td style="text-align:left;">\u5728\u591A master \u6A21\u5F0F\u7684\u57FA\u7840\u4E0A\uFF0C\u6BCF\u4E2A master \u8282\u70B9\u90FD\u6709\u81F3\u5C11\u4E00\u4E2A\u5BF9\u5E94\u7684 slave\u3002master \u8282\u70B9\u53EF\u8BFB\u53EF\u5199\uFF0C\u4F46\u662F slave \u53EA\u80FD\u8BFB\u4E0D\u80FD\u5199\uFF0C\u7C7B\u4F3C\u4E8E mysql \u7684\u4E3B\u5907\u6A21\u5F0F\u3002</td><td style="text-align:left;">\u5728 master \u5B95\u673A\u65F6\uFF0C\u6D88\u8D39\u8005\u53EF\u4EE5\u4ECE slave \u8BFB\u53D6\u6D88\u606F\uFF0C\u6D88\u606F\u7684\u5B9E\u65F6\u6027\u4E0D\u4F1A\u53D7\u5F71\u54CD\uFF0C\u6027\u80FD\u51E0\u4E4E\u548C\u591A master \u4E00\u6837\u3002</td><td style="text-align:left;">\u4F7F\u7528\u5F02\u6B65\u590D\u5236\u7684\u540C\u6B65\u65B9\u5F0F\u6709\u53EF\u80FD\u4F1A\u6709\u6D88\u606F\u4E22\u5931\u7684\u95EE\u9898\u3002</td><td style="text-align:left;">-</td></tr><tr><td>\u591A master \u591A slave <strong>\u540C\u6B65</strong>\u53CC\u5199\u6A21\u5F0F</td><td style="text-align:left;">\u540C\u591A master \u591A slave \u5F02\u6B65\u590D\u5236\u6A21\u5F0F\u7C7B\u4F3C\uFF0C\u533A\u522B\u5728\u4E8E master \u548C slave \u4E4B\u95F4\u7684\u6570\u636E\u540C\u6B65\u65B9\u5F0F\u3002</td><td style="text-align:left;">\u540C\u6B65\u53CC\u5199\u7684\u540C\u6B65\u6A21\u5F0F\u80FD\u4FDD\u8BC1\u6570\u636E\u4E0D\u4E22\u5931\u3002</td><td style="text-align:left;">\u53D1\u9001\u5355\u4E2A\u6D88\u606F RT \u4F1A\u7565\u957F\uFF0C\u6027\u80FD\u76F8\u6BD4\u5F02\u6B65\u590D\u5236\u4F4E10%\u5DE6\u53F3\u3002</td><td style="text-align:left;">\u5237\u76D8\u7B56\u7565\uFF1A\u540C\u6B65\u5237\u76D8\u548C\u5F02\u6B65\u5237\u76D8\uFF08\u6307\u7684\u662F\u8282\u70B9\u81EA\u8EAB\u6570\u636E\u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65\u5B58\u50A8\uFF09<br> \u540C\u6B65\u65B9\u5F0F\uFF1A\u540C\u6B65\u53CC\u5199\u548C\u5F02\u6B65\u590D\u5236\uFF08\u6307\u7684\u4E00\u7EC4 master \u548C slave \u4E4B\u95F4\u6570\u636E\u7684\u540C\u6B65\uFF09<br> <strong>\u6CE8\u610F</strong>\uFF1A\u8981\u4FDD\u8BC1\u6570\u636E\u53EF\u9760\uFF0C\u9700\u91C7\u7528\u540C\u6B65\u5237\u76D8\u548C\u540C\u6B65\u53CC\u5199\u7684\u65B9\u5F0F\uFF0C\u4F46\u6027\u80FD\u4F1A\u8F83\u5176\u4ED6\u65B9\u5F0F\u4F4E\u3002</td></tr></tbody></table><h3 id="\u57FA\u672C\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a> \u57FA\u672C\u6982\u5FF5</h3><p>RocketMQ\u4E3B\u8981\u7531 Producer\u3001Broker\u3001Consumer \u4E09\u90E8\u5206\u7EC4\u6210\uFF0C\u5176\u4E2DProducer \u8D1F\u8D23\u751F\u4EA7\u6D88\u606F\uFF0CConsumer \u8D1F\u8D23\u6D88\u8D39\u6D88\u606F\uFF0CBroker \u8D1F\u8D23\u5B58\u50A8\u6D88\u606F\u3002Broker \u5728\u5B9E\u9645\u90E8\u7F72\u8FC7\u7A0B\u4E2D\u5BF9\u5E94\u4E00\u53F0\u670D\u52A1\u5668\uFF0C\u6BCF\u4E2A Broker \u53EF\u4EE5\u5B58\u50A8\u591A\u4E2ATopic\u7684\u6D88\u606F\uFF0C\u6BCF\u4E2ATopic\u7684\u6D88\u606F\u4E5F\u53EF\u4EE5\u5206\u7247\u5B58\u50A8\u4E8E\u4E0D\u540C\u7684 Broker\u3002Message Queue \u7528\u4E8E\u5B58\u50A8\u6D88\u606F\u7684\u7269\u7406\u5730\u5740\uFF0C\u6BCF\u4E2ATopic\u4E2D\u7684\u6D88\u606F\u5730\u5740\u5B58\u50A8\u4E8E\u591A\u4E2A Message Queue \u4E2D\u3002ConsumerGroup \u7531\u591A\u4E2AConsumer \u5B9E\u4F8B\u6784\u6210\u3002</p><table><thead><tr><th>\u6982\u5FF5</th><th>\u8BF4\u660E</th><th>\u5176\u4ED6</th></tr></thead><tbody><tr><td>Producer</td><td>\u6D88\u606F\u751F\u4EA7\u8005</td><td>\u8D1F\u8D23\u751F\u4EA7\u6D88\u606F\uFF0C\u4E00\u822C\u7531\u4E1A\u52A1\u7CFB\u7EDF\u8D1F\u8D23\u751F\u4EA7\u6D88\u606F\u3002\u4E00\u4E2A\u6D88\u606F\u751F\u4EA7\u8005\u4F1A\u628A\u4E1A\u52A1\u5E94\u7528\u7CFB\u7EDF\u91CC\u4EA7\u751F\u7684\u6D88\u606F\u53D1\u9001\u5230broker\u670D\u52A1\u5668\u3002RocketMQ\u63D0\u4F9B\u591A\u79CD\u53D1\u9001\u65B9\u5F0F\uFF0C\u540C\u6B65\u53D1\u9001\u3001\u5F02\u6B65\u53D1\u9001\u3001\u987A\u5E8F\u53D1\u9001\u3001\u5355\u5411\u53D1\u9001\u3002\u540C\u6B65\u548C\u5F02\u6B65\u65B9\u5F0F\u5747\u9700\u8981Broker\u8FD4\u56DE\u786E\u8BA4\u4FE1\u606F\uFF0C\u5355\u5411\u53D1\u9001\u4E0D\u9700\u8981\u3002</td></tr><tr><td>Producer Group</td><td>\u6D88\u606F\u751F\u4EA7\u8005\u5206\u7EC4</td><td>-</td></tr><tr><td>Broker</td><td>\u6D88\u606F\u4EE3\u7406\u670D\u52A1\u5668</td><td>\u6D88\u606F\u4E2D\u8F6C\u89D2\u8272\uFF0C\u8D1F\u8D23\u5B58\u50A8\u6D88\u606F\u3001\u8F6C\u53D1\u6D88\u606F\u3002\u4EE3\u7406\u670D\u52A1\u5668\u5728RocketMQ\u7CFB\u7EDF\u4E2D\u8D1F\u8D23\u63A5\u6536\u4ECE\u751F\u4EA7\u8005\u53D1\u9001\u6765\u7684\u6D88\u606F\u5E76\u5B58\u50A8\u3001\u540C\u65F6\u4E3A\u6D88\u8D39\u8005\u7684\u62C9\u53D6\u8BF7\u6C42\u4F5C\u51C6\u5907\u3002\u4EE3\u7406\u670D\u52A1\u5668\u4E5F\u5B58\u50A8\u6D88\u606F\u76F8\u5173\u7684\u5143\u6570\u636E\uFF0C\u5305\u62EC\u6D88\u8D39\u8005\u7EC4\u3001\u6D88\u8D39\u8FDB\u5EA6\u504F\u79FB\u548C\u4E3B\u9898\u548C\u961F\u5217\u6D88\u606F\u7B49\u3002</td></tr><tr><td>Consumer</td><td>\u6D88\u606F\u6D88\u8D39\u8005</td><td>\u8D1F\u8D23\u6D88\u8D39\u6D88\u606F\uFF0C\u4E00\u822C\u662F\u540E\u53F0\u7CFB\u7EDF\u8D1F\u8D23\u5F02\u6B65\u6D88\u8D39\u3002\u4E00\u4E2A\u6D88\u606F\u6D88\u8D39\u8005\u4F1A\u4ECEBroker\u670D\u52A1\u5668\u62C9\u53D6\u6D88\u606F\u3001\u5E76\u5C06\u5176\u63D0\u4F9B\u7ED9\u5E94\u7528\u7A0B\u5E8F\u3002\u4ECE\u7528\u6237\u5E94\u7528\u7684\u89D2\u5EA6\u800C\u8A00\u63D0\u4F9B\u4E86\u4E24\u79CD\u6D88\u8D39\u5F62\u5F0F\uFF1A\u62C9\u53D6\u5F0F\u6D88\u8D39\u3001\u63A8\u52A8\u5F0F\u6D88\u8D39\u3002</td></tr><tr><td>Consumer Group</td><td>\u6D88\u8D39\u8005\u5206\u7EC4</td><td>-</td></tr><tr><td>Topic</td><td>\u4E3B\u9898</td><td>\u8868\u793A\u4E00\u7C7B\u6D88\u606F\u7684\u96C6\u5408\uFF0C\u6BCF\u4E2A\u4E3B\u9898\u5305\u542B\u82E5\u5E72\u6761\u6D88\u606F\uFF0C\u6BCF\u6761\u6D88\u606F\u53EA\u80FD\u5C5E\u4E8E\u4E00\u4E2A\u4E3B\u9898\uFF0C\u662FRocketMQ\u8FDB\u884C\u6D88\u606F\u8BA2\u9605\u7684\u57FA\u672C\u5355\u4F4D\u3002</td></tr><tr><td>Message\uFF08Queue\uFF09</td><td>\u6D88\u606F</td><td>\u6D88\u606F\u7CFB\u7EDF\u6240\u4F20\u8F93\u4FE1\u606F\u7684\u7269\u7406\u8F7D\u4F53\uFF0C\u751F\u4EA7\u548C\u6D88\u8D39\u6570\u636E\u7684\u6700\u5C0F\u5355\u4F4D\uFF0C\u6BCF\u6761\u6D88\u606F\u5FC5\u987B\u5C5E\u4E8E\u4E00\u4E2A\u4E3B\u9898\u3002RocketMQ\u4E2D\u6BCF\u4E2A\u6D88\u606F\u62E5\u6709\u552F\u4E00\u7684Message ID\uFF0C\u4E14\u53EF\u4EE5\u643A\u5E26\u5177\u6709\u4E1A\u52A1\u6807\u8BC6\u7684Key\u3002\u7CFB\u7EDF\u63D0\u4F9B\u4E86\u901A\u8FC7Message ID\u548CKey\u67E5\u8BE2\u6D88\u606F\u7684\u529F\u80FD\u3002</td></tr><tr><td>Tag</td><td>\u6807\u7B7E</td><td>\u4E3A\u6D88\u606F\u8BBE\u7F6E\u7684\u6807\u5FD7\uFF0C\u7528\u4E8E\u540C\u4E00\u4E3B\u9898\u4E0B\u533A\u5206\u4E0D\u540C\u7C7B\u578B\u7684\u6D88\u606F\u3002</td></tr><tr><td>Name Server</td><td>\u540D\u5B57\u670D\u52A1</td><td>\u540D\u79F0\u670D\u52A1\u5145\u5F53\u8DEF\u7531\u6D88\u606F\u7684\u63D0\u4F9B\u8005\u3002\u751F\u4EA7\u8005\u6216\u6D88\u8D39\u8005\u80FD\u591F\u901A\u8FC7\u540D\u5B57\u670D\u52A1\u67E5\u627E\u5404\u4E3B\u9898\u76F8\u5E94\u7684Broker IP\u5217\u8868\u3002\u591A\u4E2ANamesrv\u5B9E\u4F8B\u7EC4\u6210\u96C6\u7FA4\uFF0C\u4F46\u76F8\u4E92\u72EC\u7ACB\uFF0C\u6CA1\u6709\u4FE1\u606F\u4EA4\u6362\u3002</td></tr><tr><td>Pull Consumer</td><td>\u62C9\u53D6\u5F0F\u6D88\u8D39</td><td>Consumer\u6D88\u8D39\u7684\u4E00\u79CD\u7C7B\u578B\uFF0C\u5E94\u7528\u901A\u5E38\u4E3B\u52A8\u8C03\u7528Consumer\u7684\u62C9\u6D88\u606F\u65B9\u6CD5\u4ECEBroker\u670D\u52A1\u5668\u62C9\u6D88\u606F\u3001\u4E3B\u52A8\u6743\u7531\u5E94\u7528\u63A7\u5236\u3002\u4E00\u65E6\u83B7\u53D6\u4E86\u6279\u91CF\u6D88\u606F\uFF0C\u5E94\u7528\u5C31\u4F1A\u542F\u52A8\u6D88\u8D39\u8FC7\u7A0B\u3002</td></tr><tr><td>Push Consumer</td><td>\u63A8\u52A8\u5F0F\u6D88\u8D39</td><td>Consumer\u6D88\u8D39\u7684\u4E00\u79CD\u7C7B\u578B\uFF0C\u8BE5\u6A21\u5F0F\u4E0BBroker\u6536\u5230\u6570\u636E\u540E\u4F1A\u4E3B\u52A8\u63A8\u9001\u7ED9\u6D88\u8D39\u7AEF\uFF0C\u8BE5\u6D88\u8D39\u6A21\u5F0F\u4E00\u822C<strong>\u5B9E\u65F6\u6027</strong>\u8F83\u9AD8\u3002</td></tr><tr><td>Clustering</td><td>\u96C6\u7FA4\u6D88\u8D39</td><td>\u96C6\u7FA4\u6D88\u8D39\u6A21\u5F0F\u4E0B,\u76F8\u540CConsumer Group\u7684\u6BCF\u4E2AConsumer\u5B9E\u4F8B\u5E73\u5747\u5206\u644A\u6D88\u606F\u3002</td></tr><tr><td>Broadcasting</td><td>\u5E7F\u64AD\u6D88\u8D39</td><td>\u5E7F\u64AD\u6D88\u8D39\u6A21\u5F0F\u4E0B\uFF0C\u76F8\u540CConsumer Group\u7684\u6BCF\u4E2AConsumer\u5B9E\u4F8B\u90FD\u63A5\u6536\u5168\u91CF\u7684\u6D88\u606F\u3002</td></tr><tr><td>Normal Ordered Message</td><td>\u666E\u901A\u987A\u5E8F\u6D88\u606F</td><td>\u666E\u901A\u987A\u5E8F\u6D88\u8D39\u6A21\u5F0F\u4E0B\uFF0C\u6D88\u8D39\u8005\u901A\u8FC7\u540C\u4E00\u4E2A\u6D88\u606F\u961F\u5217\uFF08 Topic \u5206\u533A\uFF0C\u79F0\u4F5C Message Queue\uFF09 \u6536\u5230\u7684\u6D88\u606F\u662F\u6709\u987A\u5E8F\u7684\uFF0C\u4E0D\u540C\u6D88\u606F\u961F\u5217\u6536\u5230\u7684\u6D88\u606F\u5219\u53EF\u80FD\u662F\u65E0\u987A\u5E8F\u7684\u3002</td></tr><tr><td>Strictly Ordered Message</td><td>\u4E25\u683C\u987A\u5E8F\u6D88\u606F</td><td>\u4E25\u683C\u987A\u5E8F\u6D88\u606F\u6A21\u5F0F\u4E0B\uFF0C\u6D88\u8D39\u8005\u6536\u5230\u7684\u6240\u6709\u6D88\u606F\u5747\u662F\u6709\u987A\u5E8F\u7684\u3002</td></tr></tbody></table><h2 id="_2\u3001\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7279\u6027" aria-hidden="true">#</a> 2\u3001\u7279\u6027</h2><h3 id="\u8BA2\u9605\u4E0E\u53D1\u5E03" tabindex="-1"><a class="header-anchor" href="#\u8BA2\u9605\u4E0E\u53D1\u5E03" aria-hidden="true">#</a> \u8BA2\u9605\u4E0E\u53D1\u5E03</h3><p>\u6D88\u606F\u7684\u53D1\u5E03\u662F\u6307\u67D0\u4E2A\u751F\u4EA7\u8005\u5411\u67D0\u4E2Atopic\u53D1\u9001\u6D88\u606F\uFF1B\u6D88\u606F\u7684\u8BA2\u9605\u662F\u6307\u67D0\u4E2A\u6D88\u8D39\u8005\u5173\u6CE8\u4E86\u67D0\u4E2Atopic\u4E2D\u5E26\u6709\u67D0\u4E9Btag\u7684\u6D88\u606F\uFF0C\u8FDB\u800C\u4ECE\u8BE5topic\u6D88\u8D39\u6570\u636E\u3002</p><h3 id="\u6D88\u606F\u987A\u5E8F" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u987A\u5E8F" aria-hidden="true">#</a> \u6D88\u606F\u987A\u5E8F</h3><p>\u6D88\u606F\u6709\u5E8F\u6307\u7684\u662F\u4E00\u7C7B\u6D88\u606F\u6D88\u8D39\u65F6\uFF0C\u80FD\u6309\u7167\u53D1\u9001\u7684\u987A\u5E8F\u6765\u6D88\u8D39\u3002\u4F8B\u5982\uFF1A\u4E00\u4E2A\u8BA2\u5355\u4EA7\u751F\u4E86\u4E09\u6761\u6D88\u606F\u5206\u522B\u662F\u8BA2\u5355\u521B\u5EFA\u3001\u8BA2\u5355\u4ED8\u6B3E\u3001\u8BA2\u5355\u5B8C\u6210\u3002\u6D88\u8D39\u65F6\u8981\u6309\u7167\u8FD9\u4E2A\u987A\u5E8F\u6D88\u8D39\u624D\u80FD\u6709\u610F\u4E49\uFF0C\u4F46\u662F\u540C\u65F6\u8BA2\u5355\u4E4B\u95F4\u662F\u53EF\u4EE5\u5E76\u884C\u6D88\u8D39\u7684\u3002RocketMQ\u53EF\u4EE5\u4E25\u683C\u7684\u4FDD\u8BC1\u6D88\u606F\u6709\u5E8F\u3002</p><p>\u987A\u5E8F\u6D88\u606F\u5206\u4E3A\u5168\u5C40\u987A\u5E8F\u6D88\u606F\u4E0E\u5206\u533A\u987A\u5E8F\u6D88\u606F\uFF0C\u5168\u5C40\u987A\u5E8F\u662F\u6307\u67D0\u4E2ATopic\u4E0B\u7684\u6240\u6709\u6D88\u606F\u90FD\u8981\u4FDD\u8BC1\u987A\u5E8F\uFF1B\u90E8\u5206\u987A\u5E8F\u6D88\u606F\u53EA\u8981\u4FDD\u8BC1\u6BCF\u4E00\u7EC4\u6D88\u606F\u88AB\u987A\u5E8F\u6D88\u8D39\u5373\u53EF\u3002</p><ul><li>\u5168\u5C40\u987A\u5E8F \u5BF9\u4E8E\u6307\u5B9A\u7684\u4E00\u4E2A Topic\uFF0C\u6240\u6709\u6D88\u606F\u6309\u7167\u4E25\u683C\u7684\u5148\u5165\u5148\u51FA\uFF08FIFO\uFF09\u7684\u987A\u5E8F\u8FDB\u884C\u53D1\u5E03\u548C\u6D88\u8D39\u3002 \u9002\u7528\u573A\u666F\uFF1A\u6027\u80FD\u8981\u6C42\u4E0D\u9AD8\uFF0C\u6240\u6709\u7684\u6D88\u606F\u4E25\u683C\u6309\u7167 FIFO \u539F\u5219\u8FDB\u884C\u6D88\u606F\u53D1\u5E03\u548C\u6D88\u8D39\u7684\u573A\u666F</li><li>\u5206\u533A\u987A\u5E8F \u5BF9\u4E8E\u6307\u5B9A\u7684\u4E00\u4E2A Topic\uFF0C\u6240\u6709\u6D88\u606F\u6839\u636E sharding key \u8FDB\u884C\u533A\u5757\u5206\u533A\u3002 \u540C\u4E00\u4E2A\u5206\u533A\u5185\u7684\u6D88\u606F\u6309\u7167\u4E25\u683C\u7684 FIFO \u987A\u5E8F\u8FDB\u884C\u53D1\u5E03\u548C\u6D88\u8D39\u3002 Sharding key \u662F\u987A\u5E8F\u6D88\u606F\u4E2D\u7528\u6765\u533A\u5206\u4E0D\u540C\u5206\u533A\u7684\u5173\u952E\u5B57\u6BB5\uFF0C\u548C\u666E\u901A\u6D88\u606F\u7684 Key \u662F\u5B8C\u5168\u4E0D\u540C\u7684\u6982\u5FF5\u3002 \u9002\u7528\u573A\u666F\uFF1A\u6027\u80FD\u8981\u6C42\u9AD8\uFF0C\u4EE5 sharding key \u4F5C\u4E3A\u5206\u533A\u5B57\u6BB5\uFF0C\u5728\u540C\u4E00\u4E2A\u533A\u5757\u4E2D\u4E25\u683C\u7684\u6309\u7167 FIFO \u539F\u5219\u8FDB\u884C\u6D88\u606F\u53D1\u5E03\u548C\u6D88\u8D39\u7684\u573A\u666F\u3002</li></ul><h3 id="\u6D88\u606F\u8FC7\u6EE4" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u8FC7\u6EE4" aria-hidden="true">#</a> \u6D88\u606F\u8FC7\u6EE4</h3><p>RocketMQ\u7684\u6D88\u8D39\u8005\u53EF\u4EE5\u6839\u636ETag\u8FDB\u884C\u6D88\u606F\u8FC7\u6EE4\uFF0C\u4E5F\u652F\u6301\u81EA\u5B9A\u4E49\u5C5E\u6027\u8FC7\u6EE4\u3002\u6D88\u606F\u8FC7\u6EE4\u76EE\u524D\u662F\u5728Broker\u7AEF\u5B9E\u73B0\u7684\uFF0C\u4F18\u70B9\u662F\u51CF\u5C11\u4E86\u5BF9\u4E8EConsumer\u65E0\u7528\u6D88\u606F\u7684\u7F51\u7EDC\u4F20\u8F93\uFF0C\u7F3A\u70B9\u662F\u589E\u52A0\u4E86Broker\u7684\u8D1F\u62C5\u3001\u800C\u4E14\u5B9E\u73B0\u76F8\u5BF9\u590D\u6742\u3002</p><h3 id="\u6D88\u606F\u53EF\u9760\u6027" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u53EF\u9760\u6027" aria-hidden="true">#</a> \u6D88\u606F\u53EF\u9760\u6027</h3><p>RocketMQ\u652F\u6301\u6D88\u606F\u7684\u9AD8\u53EF\u9760\uFF0C\u5F71\u54CD\u6D88\u606F\u53EF\u9760\u6027\u7684\u51E0\u79CD\u60C5\u51B5\uFF1A</p><ol><li>Broker\u975E\u6B63\u5E38\u5173\u95ED</li><li>Broker\u5F02\u5E38Crash</li><li>OS Crash</li><li>\u673A\u5668\u6389\u7535\uFF0C\u4F46\u662F\u80FD\u7ACB\u5373\u6062\u590D\u4F9B\u7535\u60C5\u51B5</li><li>\u673A\u5668\u65E0\u6CD5\u5F00\u673A\uFF08\u53EF\u80FD\u662Fcpu\u3001\u4E3B\u677F\u3001\u5185\u5B58\u7B49\u5173\u952E\u8BBE\u5907\u635F\u574F\uFF09</li><li>\u78C1\u76D8\u8BBE\u5907\u635F\u574F</li></ol><p>1)\u30012)\u30013)\u30014) \u56DB\u79CD\u60C5\u51B5\u90FD\u5C5E\u4E8E\u786C\u4EF6\u8D44\u6E90\u53EF\u7ACB\u5373\u6062\u590D\u60C5\u51B5\uFF0CRocketMQ\u5728\u8FD9\u56DB\u79CD\u60C5\u51B5\u4E0B\u80FD\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\uFF0C\u6216\u8005\u4E22\u5931\u5C11\u91CF\u6570\u636E\uFF08\u4F9D\u8D56\u5237\u76D8\u65B9\u5F0F\u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65\uFF09\u3002</p><p>5)\u30016)\u5C5E\u4E8E\u5355\u70B9\u6545\u969C\uFF0C\u4E14\u65E0\u6CD5\u6062\u590D\uFF0C\u4E00\u65E6\u53D1\u751F\uFF0C\u5728\u6B64\u5355\u70B9\u4E0A\u7684\u6D88\u606F\u5168\u90E8\u4E22\u5931\u3002RocketMQ\u5728\u8FD9\u4E24\u79CD\u60C5\u51B5\u4E0B\uFF0C\u901A\u8FC7\u5F02\u6B65\u590D\u5236\uFF0C\u53EF\u4FDD\u8BC199%\u7684\u6D88\u606F\u4E0D\u4E22\uFF0C\u4F46\u662F\u4ECD\u7136\u4F1A\u6709\u6781\u5C11\u91CF\u7684\u6D88\u606F\u53EF\u80FD\u4E22\u5931\u3002\u901A\u8FC7\u540C\u6B65\u53CC\u5199\u6280\u672F\u53EF\u4EE5\u5B8C\u5168\u907F\u514D\u5355\u70B9\uFF0C\u540C\u6B65\u53CC\u5199\u52BF\u5FC5\u4F1A\u5F71\u54CD\u6027\u80FD\uFF0C\u9002\u5408\u5BF9\u6D88\u606F\u53EF\u9760\u6027\u8981\u6C42\u6781\u9AD8\u7684\u573A\u5408\uFF0C\u4F8B\u5982\u4E0EMoney\u76F8\u5173\u7684\u5E94\u7528\u3002\u6CE8\uFF1ARocketMQ\u4ECE3.0\u7248\u672C\u5F00\u59CB\u652F\u6301\u540C\u6B65\u53CC\u5199\u3002</p><h3 id="\u81F3\u5C11\u4E00\u6B21" tabindex="-1"><a class="header-anchor" href="#\u81F3\u5C11\u4E00\u6B21" aria-hidden="true">#</a> \u81F3\u5C11\u4E00\u6B21</h3><p>\u81F3\u5C11\u4E00\u6B21(At least Once)\u6307\u6BCF\u4E2A\u6D88\u606F\u5FC5\u987B\u6295\u9012\u4E00\u6B21\u3002Consumer\u5148Pull\u6D88\u606F\u5230\u672C\u5730\uFF0C\u6D88\u8D39\u5B8C\u6210\u540E\uFF0C\u624D\u5411\u670D\u52A1\u5668\u8FD4\u56DEack\uFF0C\u5982\u679C\u6CA1\u6709\u6D88\u8D39\u4E00\u5B9A\u4E0D\u4F1Aack\u6D88\u606F\uFF0C\u6240\u4EE5RocketMQ\u53EF\u4EE5\u5F88\u597D\u7684\u652F\u6301\u6B64\u7279\u6027\u3002</p><h3 id="\u56DE\u6EAF\u6D88\u8D39" tabindex="-1"><a class="header-anchor" href="#\u56DE\u6EAF\u6D88\u8D39" aria-hidden="true">#</a> \u56DE\u6EAF\u6D88\u8D39</h3><p>\u56DE\u6EAF\u6D88\u8D39\u662F\u6307Consumer\u5DF2\u7ECF\u6D88\u8D39\u6210\u529F\u7684\u6D88\u606F\uFF0C\u7531\u4E8E\u4E1A\u52A1\u4E0A\u9700\u6C42\u9700\u8981\u91CD\u65B0\u6D88\u8D39\uFF0C\u8981\u652F\u6301\u6B64\u529F\u80FD\uFF0CBroker\u5728\u5411Consumer\u6295\u9012\u6210\u529F\u6D88\u606F\u540E\uFF0C\u6D88\u606F\u4ECD\u7136\u9700\u8981\u4FDD\u7559\u3002\u5E76\u4E14\u91CD\u65B0\u6D88\u8D39\u4E00\u822C\u662F\u6309\u7167\u65F6\u95F4\u7EF4\u5EA6\uFF0C\u4F8B\u5982\u7531\u4E8EConsumer\u7CFB\u7EDF\u6545\u969C\uFF0C\u6062\u590D\u540E\u9700\u8981\u91CD\u65B0\u6D88\u8D391\u5C0F\u65F6\u524D\u7684\u6570\u636E\uFF0C\u90A3\u4E48Broker\u8981\u63D0\u4F9B\u4E00\u79CD\u673A\u5236\uFF0C\u53EF\u4EE5\u6309\u7167\u65F6\u95F4\u7EF4\u5EA6\u6765\u56DE\u9000\u6D88\u8D39\u8FDB\u5EA6\u3002RocketMQ\u652F\u6301\u6309\u7167\u65F6\u95F4\u56DE\u6EAF\u6D88\u8D39\uFF0C\u65F6\u95F4\u7EF4\u5EA6\u7CBE\u786E\u5230\u6BEB\u79D2\u3002</p><h3 id="\u4E8B\u52A1\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#\u4E8B\u52A1\u6D88\u606F" aria-hidden="true">#</a> \u4E8B\u52A1\u6D88\u606F</h3><p>RocketMQ\u4E8B\u52A1\u6D88\u606F\uFF08Transactional Message\uFF09\u662F\u6307\u5E94\u7528\u672C\u5730\u4E8B\u52A1\u548C\u53D1\u9001\u6D88\u606F\u64CD\u4F5C\u53EF\u4EE5\u88AB\u5B9A\u4E49\u5230\u5168\u5C40\u4E8B\u52A1\u4E2D\uFF0C\u8981\u4E48\u540C\u65F6\u6210\u529F\uFF0C\u8981\u4E48\u540C\u65F6\u5931\u8D25\u3002RocketMQ\u7684\u4E8B\u52A1\u6D88\u606F\u63D0\u4F9B\u7C7B\u4F3C X/Open XA \u7684\u5206\u5E03\u4E8B\u52A1\u529F\u80FD\uFF0C\u901A\u8FC7\u4E8B\u52A1\u6D88\u606F\u80FD\u8FBE\u5230\u5206\u5E03\u5F0F\u4E8B\u52A1\u7684\u6700\u7EC8\u4E00\u81F4\u3002</p><h3 id="\u5B9A\u65F6\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u65F6\u6D88\u606F" aria-hidden="true">#</a> \u5B9A\u65F6\u6D88\u606F</h3><p>\u5B9A\u65F6\u6D88\u606F\uFF08\u5EF6\u8FDF\u961F\u5217\uFF09\u662F\u6307\u6D88\u606F\u53D1\u9001\u5230broker\u540E\uFF0C\u4E0D\u4F1A\u7ACB\u5373\u88AB\u6D88\u8D39\uFF0C\u7B49\u5F85\u7279\u5B9A\u65F6\u95F4\u6295\u9012\u7ED9\u771F\u6B63\u7684topic\u3002 broker\u6709\u914D\u7F6E\u9879messageDelayLevel\uFF0C\u9ED8\u8BA4\u503C\u4E3A\u201C1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\u201D\uFF0C18\u4E2Alevel\u3002\u53EF\u4EE5\u914D\u7F6E\u81EA\u5B9A\u4E49messageDelayLevel\u3002\u6CE8\u610F\uFF0CmessageDelayLevel\u662Fbroker\u7684\u5C5E\u6027\uFF0C\u4E0D\u5C5E\u4E8E\u67D0\u4E2Atopic\u3002\u53D1\u6D88\u606F\u65F6\uFF0C\u8BBE\u7F6EdelayLevel\u7B49\u7EA7\u5373\u53EF\uFF1Amsg.setDelayLevel(level)\u3002level\u6709\u4EE5\u4E0B\u4E09\u79CD\u60C5\u51B5\uFF1A</p><ul><li>level == 0\uFF0C\u6D88\u606F\u4E3A\u975E\u5EF6\u8FDF\u6D88\u606F</li><li>1&lt;=level&lt;=maxLevel\uFF0C\u6D88\u606F\u5EF6\u8FDF\u7279\u5B9A\u65F6\u95F4\uFF0C\u4F8B\u5982level==1\uFF0C\u5EF6\u8FDF1s</li><li>level &gt; maxLevel\uFF0C\u5219level== maxLevel\uFF0C\u4F8B\u5982level==20\uFF0C\u5EF6\u8FDF2h</li></ul><p>\u5B9A\u65F6\u6D88\u606F\u4F1A\u6682\u5B58\u5728\u540D\u4E3ASCHEDULE_TOPIC_XXXX\u7684topic\u4E2D\uFF0C\u5E76\u6839\u636EdelayTimeLevel\u5B58\u5165\u7279\u5B9A\u7684queue\uFF0CqueueId = delayTimeLevel \u2013 1\uFF0C\u5373\u4E00\u4E2Aqueue\u53EA\u5B58\u76F8\u540C\u5EF6\u8FDF\u7684\u6D88\u606F\uFF0C\u4FDD\u8BC1\u5177\u6709\u76F8\u540C\u53D1\u9001\u5EF6\u8FDF\u7684\u6D88\u606F\u80FD\u591F\u987A\u5E8F\u6D88\u8D39\u3002broker\u4F1A\u8C03\u5EA6\u5730\u6D88\u8D39SCHEDULE_TOPIC_XXXX\uFF0C\u5C06\u6D88\u606F\u5199\u5165\u771F\u5B9E\u7684topic\u3002</p><p>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5B9A\u65F6\u6D88\u606F\u4F1A\u5728\u7B2C\u4E00\u6B21\u5199\u5165\u548C\u8C03\u5EA6\u5199\u5165\u771F\u5B9Etopic\u65F6\u90FD\u4F1A\u8BA1\u6570\uFF0C\u56E0\u6B64\u53D1\u9001\u6570\u91CF\u3001tps\u90FD\u4F1A\u53D8\u9AD8\u3002</p><h3 id="\u6D88\u606F\u91CD\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u91CD\u8BD5" aria-hidden="true">#</a> \u6D88\u606F\u91CD\u8BD5</h3><p>Consumer\u6D88\u8D39\u6D88\u606F\u5931\u8D25\u540E\uFF0C\u8981\u63D0\u4F9B\u4E00\u79CD\u91CD\u8BD5\u673A\u5236\uFF0C\u4EE4\u6D88\u606F\u518D\u6D88\u8D39\u4E00\u6B21\u3002Consumer\u6D88\u8D39\u6D88\u606F\u5931\u8D25\u901A\u5E38\u53EF\u4EE5\u8BA4\u4E3A\u6709\u4EE5\u4E0B\u51E0\u79CD\u60C5\u51B5\uFF1A</p><ul><li>\u7531\u4E8E\u6D88\u606F\u672C\u8EAB\u7684\u539F\u56E0\uFF0C\u4F8B\u5982\u53CD\u5E8F\u5217\u5316\u5931\u8D25\uFF0C\u6D88\u606F\u6570\u636E\u672C\u8EAB\u65E0\u6CD5\u5904\u7406\uFF08\u4F8B\u5982\u8BDD\u8D39\u5145\u503C\uFF0C\u5F53\u524D\u6D88\u606F\u7684\u624B\u673A\u53F7\u88AB\u6CE8\u9500\uFF0C\u65E0\u6CD5\u5145\u503C\uFF09\u7B49\u3002\u8FD9\u79CD\u9519\u8BEF\u901A\u5E38\u9700\u8981\u8DF3\u8FC7\u8FD9\u6761\u6D88\u606F\uFF0C\u518D\u6D88\u8D39\u5176\u5B83\u6D88\u606F\uFF0C\u800C\u8FD9\u6761\u5931\u8D25\u7684\u6D88\u606F\u5373\u4F7F\u7ACB\u523B\u91CD\u8BD5\u6D88\u8D39\uFF0C99%\u4E5F\u4E0D\u6210\u529F\uFF0C\u6240\u4EE5\u6700\u597D\u63D0\u4F9B\u4E00\u79CD\u5B9A\u65F6\u91CD\u8BD5\u673A\u5236\uFF0C\u5373\u8FC710\u79D2\u540E\u518D\u91CD\u8BD5\u3002</li><li>\u7531\u4E8E\u4F9D\u8D56\u7684\u4E0B\u6E38\u5E94\u7528\u670D\u52A1\u4E0D\u53EF\u7528\uFF0C\u4F8B\u5982db\u8FDE\u63A5\u4E0D\u53EF\u7528\uFF0C\u5916\u7CFB\u7EDF\u7F51\u7EDC\u4E0D\u53EF\u8FBE\u7B49\u3002\u9047\u5230\u8FD9\u79CD\u9519\u8BEF\uFF0C\u5373\u4F7F\u8DF3\u8FC7\u5F53\u524D\u5931\u8D25\u7684\u6D88\u606F\uFF0C\u6D88\u8D39\u5176\u4ED6\u6D88\u606F\u540C\u6837\u4E5F\u4F1A\u62A5\u9519\u3002\u8FD9\u79CD\u60C5\u51B5\u5EFA\u8BAE\u5E94\u7528sleep 30s\uFF0C\u518D\u6D88\u8D39\u4E0B\u4E00\u6761\u6D88\u606F\uFF0C\u8FD9\u6837\u53EF\u4EE5\u51CF\u8F7BBroker\u91CD\u8BD5\u6D88\u606F\u7684\u538B\u529B\u3002</li></ul><p>RocketMQ\u4F1A\u4E3A\u6BCF\u4E2A\u6D88\u8D39\u7EC4\u90FD\u8BBE\u7F6E\u4E00\u4E2ATopic\u540D\u79F0\u4E3A\u201C%RETRY%+consumerGroup\u201D\u7684\u91CD\u8BD5\u961F\u5217\uFF08\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u4E2ATopic\u7684\u91CD\u8BD5\u961F\u5217\u662F\u9488\u5BF9\u6D88\u8D39\u7EC4\uFF0C\u800C\u4E0D\u662F\u9488\u5BF9\u6BCF\u4E2ATopic\u8BBE\u7F6E\u7684\uFF09\uFF0C\u7528\u4E8E\u6682\u65F6\u4FDD\u5B58\u56E0\u4E3A\u5404\u79CD\u5F02\u5E38\u800C\u5BFC\u81F4Consumer\u7AEF\u65E0\u6CD5\u6D88\u8D39\u7684\u6D88\u606F\u3002\u8003\u8651\u5230\u5F02\u5E38\u6062\u590D\u8D77\u6765\u9700\u8981\u4E00\u4E9B\u65F6\u95F4\uFF0C\u4F1A\u4E3A\u91CD\u8BD5\u961F\u5217\u8BBE\u7F6E\u591A\u4E2A\u91CD\u8BD5\u7EA7\u522B\uFF0C\u6BCF\u4E2A\u91CD\u8BD5\u7EA7\u522B\u90FD\u6709\u4E0E\u4E4B\u5BF9\u5E94\u7684\u91CD\u65B0\u6295\u9012\u5EF6\u65F6\uFF0C\u91CD\u8BD5\u6B21\u6570\u8D8A\u591A\u6295\u9012\u5EF6\u65F6\u5C31\u8D8A\u5927\u3002RocketMQ\u5BF9\u4E8E\u91CD\u8BD5\u6D88\u606F\u7684\u5904\u7406\u662F\u5148\u4FDD\u5B58\u81F3Topic\u540D\u79F0\u4E3A\u201CSCHEDULE_TOPIC_XXXX\u201D\u7684\u5EF6\u8FDF\u961F\u5217\u4E2D\uFF0C\u540E\u53F0\u5B9A\u65F6\u4EFB\u52A1\u6309\u7167\u5BF9\u5E94\u7684\u65F6\u95F4\u8FDB\u884CDelay\u540E\u91CD\u65B0\u4FDD\u5B58\u81F3\u201C%RETRY%+consumerGroup\u201D\u7684\u91CD\u8BD5\u961F\u5217\u4E2D\u3002</p><h3 id="\u6D88\u606F\u91CD\u6295" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u91CD\u6295" aria-hidden="true">#</a> \u6D88\u606F\u91CD\u6295</h3><p>\u751F\u4EA7\u8005\u5728\u53D1\u9001\u6D88\u606F\u65F6\uFF0C\u540C\u6B65\u6D88\u606F\u5931\u8D25\u4F1A\u91CD\u6295\uFF0C\u5F02\u6B65\u6D88\u606F\u6709\u91CD\u8BD5\uFF0Coneway\u6CA1\u6709\u4EFB\u4F55\u4FDD\u8BC1\u3002</p><p>\u6D88\u606F\u91CD\u6295\u4FDD\u8BC1\u6D88\u606F\u5C3D\u53EF\u80FD\u53D1\u9001\u6210\u529F\u3001\u4E0D\u4E22\u5931\uFF0C\u4F46\u53EF\u80FD\u4F1A\u9020\u6210\u6D88\u606F\u91CD\u590D\uFF0C\u6D88\u606F\u91CD\u590D\u5728RocketMQ\u4E2D\u662F\u65E0\u6CD5\u907F\u514D\u7684\u95EE\u9898\u3002\u6D88\u606F\u91CD\u590D\u5728\u4E00\u822C\u60C5\u51B5\u4E0B\u4E0D\u4F1A\u53D1\u751F\uFF0C\u5F53\u51FA\u73B0\u6D88\u606F\u91CF\u5927\u3001\u7F51\u7EDC\u6296\u52A8\uFF0C\u6D88\u606F\u91CD\u590D\u5C31\u4F1A\u662F\u5927\u6982\u7387\u4E8B\u4EF6\u3002\u53E6\u5916\uFF0C\u751F\u4EA7\u8005\u4E3B\u52A8\u91CD\u53D1\u3001consumer\u8D1F\u8F7D\u53D8\u5316\u4E5F\u4F1A\u5BFC\u81F4\u91CD\u590D\u6D88\u606F\u3002\u5982\u4E0B\u65B9\u6CD5\u53EF\u4EE5\u8BBE\u7F6E\u6D88\u606F\u91CD\u8BD5\u7B56\u7565\uFF1A</p><ul><li>retryTimesWhenSendFailed:\u540C\u6B65\u53D1\u9001\u5931\u8D25\u91CD\u6295\u6B21\u6570\uFF0C\u9ED8\u8BA4\u4E3A2\uFF0C\u56E0\u6B64\u751F\u4EA7\u8005\u4F1A\u6700\u591A\u5C1D\u8BD5\u53D1\u9001retryTimesWhenSendFailed + 1\u6B21\u3002\u4E0D\u4F1A\u9009\u62E9\u4E0A\u6B21\u5931\u8D25\u7684broker\uFF0C\u5C1D\u8BD5\u5411\u5176\u4ED6broker\u53D1\u9001\uFF0C\u6700\u5927\u7A0B\u5EA6\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u3002\u8D85\u8FC7\u91CD\u6295\u6B21\u6570\uFF0C\u629B\u51FA\u5F02\u5E38\uFF0C\u7531\u5BA2\u6237\u7AEF\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u3002\u5F53\u51FA\u73B0RemotingException\u3001MQClientException\u548C\u90E8\u5206MQBrokerException\u65F6\u4F1A\u91CD\u6295\u3002</li><li>retryTimesWhenSendAsyncFailed:\u5F02\u6B65\u53D1\u9001\u5931\u8D25\u91CD\u8BD5\u6B21\u6570\uFF0C\u5F02\u6B65\u91CD\u8BD5\u4E0D\u4F1A\u9009\u62E9\u5176\u4ED6broker\uFF0C\u4EC5\u5728\u540C\u4E00\u4E2Abroker\u4E0A\u505A\u91CD\u8BD5\uFF0C\u4E0D\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u3002</li><li>retryAnotherBrokerWhenNotStoreOK:\u6D88\u606F\u5237\u76D8\uFF08\u4E3B\u6216\u5907\uFF09\u8D85\u65F6\u6216slave\u4E0D\u53EF\u7528\uFF08\u8FD4\u56DE\u72B6\u6001\u975ESEND_OK\uFF09\uFF0C\u662F\u5426\u5C1D\u8BD5\u53D1\u9001\u5230\u5176\u4ED6broker\uFF0C\u9ED8\u8BA4false\u3002\u5341\u5206\u91CD\u8981\u6D88\u606F\u53EF\u4EE5\u5F00\u542F\u3002</li></ul><h3 id="\u6D41\u91CF\u63A7\u5236" tabindex="-1"><a class="header-anchor" href="#\u6D41\u91CF\u63A7\u5236" aria-hidden="true">#</a> \u6D41\u91CF\u63A7\u5236</h3><p>\u751F\u4EA7\u8005\u6D41\u63A7\uFF0C\u56E0\u4E3Abroker\u5904\u7406\u80FD\u529B\u8FBE\u5230\u74F6\u9888\uFF1B\u6D88\u8D39\u8005\u6D41\u63A7\uFF0C\u56E0\u4E3A\u6D88\u8D39\u80FD\u529B\u8FBE\u5230\u74F6\u9888\u3002</p><p>\u751F\u4EA7\u8005\u6D41\u63A7\uFF1A</p><ul><li>commitLog\u6587\u4EF6\u88AB\u9501\u65F6\u95F4\u8D85\u8FC7osPageCacheBusyTimeOutMills\u65F6\uFF0C\u53C2\u6570\u9ED8\u8BA4\u4E3A1000ms\uFF0C\u8FD4\u56DE\u6D41\u63A7\u3002</li><li>\u5982\u679C\u5F00\u542FtransientStorePoolEnable == true\uFF0C\u4E14broker\u4E3A\u5F02\u6B65\u5237\u76D8\u7684\u4E3B\u673A\uFF0C\u4E14transientStorePool\u4E2D\u8D44\u6E90\u4E0D\u8DB3\uFF0C\u62D2\u7EDD\u5F53\u524Dsend\u8BF7\u6C42\uFF0C\u8FD4\u56DE\u6D41\u63A7\u3002</li><li>broker\u6BCF\u969410ms\u68C0\u67E5send\u8BF7\u6C42\u961F\u5217\u5934\u90E8\u8BF7\u6C42\u7684\u7B49\u5F85\u65F6\u95F4\uFF0C\u5982\u679C\u8D85\u8FC7waitTimeMillsInSendQueue\uFF0C\u9ED8\u8BA4200ms\uFF0C\u62D2\u7EDD\u5F53\u524Dsend\u8BF7\u6C42\uFF0C\u8FD4\u56DE\u6D41\u63A7\u3002</li><li>broker\u901A\u8FC7\u62D2\u7EDDsend \u8BF7\u6C42\u65B9\u5F0F\u5B9E\u73B0\u6D41\u91CF\u63A7\u5236\u3002</li></ul><p>\u6CE8\u610F\uFF0C\u751F\u4EA7\u8005\u6D41\u63A7\uFF0C\u4E0D\u4F1A\u5C1D\u8BD5\u6D88\u606F\u91CD\u6295\u3002</p><p>\u6D88\u8D39\u8005\u6D41\u63A7\uFF1A</p><ul><li>\u6D88\u8D39\u8005\u672C\u5730\u7F13\u5B58\u6D88\u606F\u6570\u8D85\u8FC7pullThresholdForQueue\u65F6\uFF0C\u9ED8\u8BA41000\u3002</li><li>\u6D88\u8D39\u8005\u672C\u5730\u7F13\u5B58\u6D88\u606F\u5927\u5C0F\u8D85\u8FC7pullThresholdSizeForQueue\u65F6\uFF0C\u9ED8\u8BA4100MB\u3002</li><li>\u6D88\u8D39\u8005\u672C\u5730\u7F13\u5B58\u6D88\u606F\u8DE8\u5EA6\u8D85\u8FC7consumeConcurrentlyMaxSpan\u65F6\uFF0C\u9ED8\u8BA42000\u3002</li></ul><p>\u6D88\u8D39\u8005\u6D41\u63A7\u7684\u7ED3\u679C\u662F\u964D\u4F4E\u62C9\u53D6\u9891\u7387\u3002</p><h3 id="\u6B7B\u4FE1\u961F\u5217" tabindex="-1"><a class="header-anchor" href="#\u6B7B\u4FE1\u961F\u5217" aria-hidden="true">#</a> \u6B7B\u4FE1\u961F\u5217</h3><p>\u6B7B\u4FE1\u961F\u5217\u7528\u4E8E\u5904\u7406\u65E0\u6CD5\u88AB\u6B63\u5E38\u6D88\u8D39\u7684\u6D88\u606F\u3002\u5F53\u4E00\u6761\u6D88\u606F\u521D\u6B21\u6D88\u8D39\u5931\u8D25\uFF0C\u6D88\u606F\u961F\u5217\u4F1A\u81EA\u52A8\u8FDB\u884C\u6D88\u606F\u91CD\u8BD5\uFF1B\u8FBE\u5230\u6700\u5927\u91CD\u8BD5\u6B21\u6570\u540E\uFF0C\u82E5\u6D88\u8D39\u4F9D\u7136\u5931\u8D25\uFF0C\u5219\u8868\u660E\u6D88\u8D39\u8005\u5728\u6B63\u5E38\u60C5\u51B5\u4E0B\u65E0\u6CD5\u6B63\u786E\u5730\u6D88\u8D39\u8BE5\u6D88\u606F\uFF0C\u6B64\u65F6\uFF0C\u6D88\u606F\u961F\u5217 \u4E0D\u4F1A\u7ACB\u523B\u5C06\u6D88\u606F\u4E22\u5F03\uFF0C\u800C\u662F\u5C06\u5176\u53D1\u9001\u5230\u8BE5\u6D88\u8D39\u8005\u5BF9\u5E94\u7684\u7279\u6B8A\u961F\u5217\u4E2D\u3002</p><p>RocketMQ\u5C06\u8FD9\u79CD\u6B63\u5E38\u60C5\u51B5\u4E0B\u65E0\u6CD5\u88AB\u6D88\u8D39\u7684\u6D88\u606F\u79F0\u4E3A\u6B7B\u4FE1\u6D88\u606F\uFF08Dead-Letter Message\uFF09\uFF0C\u5C06\u5B58\u50A8\u6B7B\u4FE1\u6D88\u606F\u7684\u7279\u6B8A\u961F\u5217\u79F0\u4E3A\u6B7B\u4FE1\u961F\u5217\uFF08Dead-Letter Queue\uFF09\u3002\u5728RocketMQ\u4E2D\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528console\u63A7\u5236\u53F0\u5BF9\u6B7B\u4FE1\u961F\u5217\u4E2D\u7684\u6D88\u606F\u8FDB\u884C\u91CD\u53D1\u6765\u4F7F\u5F97\u6D88\u8D39\u8005\u5B9E\u4F8B\u518D\u6B21\u8FDB\u884C\u6D88\u8D39\u3002</p><h2 id="_3\u3001\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5B89\u88C5" aria-hidden="true">#</a> 3\u3001\u5B89\u88C5</h2><h3 id="\u4E0B\u8F7D\u5730\u5740" tabindex="-1"><a class="header-anchor" href="#\u4E0B\u8F7D\u5730\u5740" aria-hidden="true">#</a> \u4E0B\u8F7D\u5730\u5740</h3><p>https://rocketmq.apache.org/release_notes/release-notes-4.9.4/</p><h3 id="\u914D\u7F6E\u73AF\u5883\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u73AF\u5883\u53D8\u91CF" aria-hidden="true">#</a> \u914D\u7F6E\u73AF\u5883\u53D8\u91CF</h3><p>ROCKETMQ_HOME=&quot;D:\\rocketmq&quot;\u3001NAMESRV_ADDR=&quot;localhost:9876&quot;</p><p><img src="'+u+'" alt="image-20220713143224748"></p><p><img src="'+i+'" alt="image-20220713151738323"></p><h3 id="port-\u7AEF\u53E3\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#port-\u7AEF\u53E3\u8BF4\u660E" aria-hidden="true">#</a> port \u7AEF\u53E3\u8BF4\u660E</h3><table><thead><tr><th>\u7AEF\u53E3</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>NameServer</td><td>9876</td></tr><tr><td>Broker-listenPort\uFF08\u63A5\u53D7\u5BA2\u6237\u7AEF\u8FDE\u63A5\u7684\u76D1\u542C\u7AEF\u53E3\uFF09</td><td>10911</td></tr><tr><td>Broker-fastListenPort\uFF08\u4E3B\u8981\u7528\u4E8Eslave\u540C\u6B65master\uFF09</td><td>10909</td></tr><tr><td>Broker-haListenPort\uFF08haService\u4E2D\u4F7F\u7528\uFF09</td><td>10912</td></tr></tbody></table><h3 id="conf-\u76EE\u5F55\u914D\u7F6E\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#conf-\u76EE\u5F55\u914D\u7F6E\u8BF4\u660E" aria-hidden="true">#</a> conf \u76EE\u5F55\u914D\u7F6E\u8BF4\u660E</h3><table><thead><tr><th>\u6587\u4EF6</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>2m-2s-async</td><td>2 \u4E3B 2 \u4ECE\u5F02\u6B65\u590D\u5236\u7684\u914D\u7F6E</td></tr><tr><td>2m-2s-sync</td><td>2 \u4E3B 2 \u4ECE\u540C\u6B65\u590D\u5236\u7684\u914D\u7F6E</td></tr><tr><td>2m-noslave</td><td>2 \u4E3B\u7684\u914D\u7F6E</td></tr><tr><td>dledger</td><td></td></tr><tr><td>broker.conf</td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="broker-conf-\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#broker-conf-\u53C2\u6570" aria-hidden="true">#</a> broker.conf \u53C2\u6570</h3><table><thead><tr><th>\u53C2\u6570\u9009\u9879</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>brokerClusterName</td><td>\u6240\u5C5E\u96C6\u7FA4\u540D\u5B57</td></tr><tr><td>brokerName</td><td>broker\u540D\u5B57\uFF0C\u6CE8\u610F\u6B64\u5904\u4E0D\u540C\u7684\u914D\u7F6E\u6587\u4EF6\u586B\u5199\u7684\u4E0D\u4E00\u6837</td></tr><tr><td>brokerId</td><td>0 \u8868\u793A Master\uFF0C&gt;0 \u8868\u793A Slave</td></tr><tr><td>brokerIP1</td><td>broker ip\u6839\u636E\u670D\u52A1\u5668\u5B9E\u9645IP\u8FDB\u884C\u66F4\u6539</td></tr><tr><td>namesrvAddr</td><td>nameServer\u5730\u5740\uFF0C\u5206\u53F7\u5206\u5272</td></tr><tr><td>defaultTopicQueueNums</td><td>\u5728\u53D1\u9001\u6D88\u606F\u65F6\uFF0C\u81EA\u52A8\u521B\u5EFA\u670D\u52A1\u5668\u4E0D\u5B58\u5728\u7684topic\uFF0C\u9ED8\u8BA4\u521B\u5EFA\u7684\u961F\u5217\u6570</td></tr><tr><td>autoCreateTopicEnable</td><td>\u662F\u5426\u5141\u8BB8 Broker \u81EA\u52A8\u521B\u5EFATopic\uFF0C\u5EFA\u8BAE\u7EBF\u4E0B\u5F00\u542F\uFF0C\u7EBF\u4E0A\u5173\u95ED</td></tr><tr><td>autoCreateSubscriptionGroup</td><td>\u662F\u5426\u5141\u8BB8 Broker \u81EA\u52A8\u521B\u5EFA\u8BA2\u9605\u7EC4\uFF0C\u5EFA\u8BAE\u7EBF\u4E0B\u5F00\u542F\uFF0C\u7EBF\u4E0A\u5173\u95ED</td></tr><tr><td>listenPort</td><td>Broker \u5BF9\u5916\u670D\u52A1\u7684\u76D1\u542C\u7AEF\u53E3</td></tr><tr><td>deleteWhen</td><td>\u5220\u9664\u6587\u4EF6\u65F6\u95F4\u70B9\uFF0C\u9ED8\u8BA4\u51CC\u6668 4\u70B9</td></tr><tr><td>fileReservedTime</td><td>\u6587\u4EF6\u4FDD\u7559\u65F6\u95F4\uFF0C\u9ED8\u8BA4 48 \u5C0F\u65F6</td></tr><tr><td>mapedFileSizeCommitLog</td><td>commitLog\u6BCF\u4E2A\u6587\u4EF6\u7684\u5927\u5C0F\u9ED8\u8BA41G</td></tr><tr><td>mapedFileSizeConsumeQueue</td><td>ConsumeQueue\u6BCF\u4E2A\u6587\u4EF6\u9ED8\u8BA4\u5B5830W\u6761\uFF0C\u6839\u636E\u4E1A\u52A1\u60C5\u51B5\u8C03\u6574</td></tr><tr><td>destroyMapedFileIntervalForcibly</td><td></td></tr><tr><td>redeleteHangedFileInterval</td><td></td></tr><tr><td>diskMaxUsedSpaceRatio</td><td>\u68C0\u6D4B\u7269\u7406\u6587\u4EF6\u78C1\u76D8\u7A7A\u95F4</td></tr><tr><td>storePathRootDir</td><td>\u5B58\u50A8\u8DEF\u5F84</td></tr><tr><td>storePathCommitLog</td><td>commitLog \u5B58\u50A8\u8DEF\u5F84</td></tr><tr><td>storePathConsumeQueue</td><td>\u6D88\u8D39\u961F\u5217\u5B58\u50A8\u8DEF\u5F84\u5B58\u50A8\u8DEF\u5F84</td></tr><tr><td>storePathIndex</td><td>\u6D88\u606F\u7D22\u5F15\u5B58\u50A8\u8DEF\u5F84</td></tr><tr><td>storeCheckpoint</td><td>checkpoint \u6587\u4EF6\u5B58\u50A8\u8DEF\u5F84</td></tr><tr><td>abortFile</td><td>abort \u6587\u4EF6\u5B58\u50A8\u8DEF\u5F84</td></tr><tr><td>maxMessageSize</td><td>\u9650\u5236\u7684\u6D88\u606F\u5927\u5C0F</td></tr><tr><td>flushCommitLogLeastPages</td><td></td></tr><tr><td>flushConsumeQueueLeastPages</td><td></td></tr><tr><td>flushCommitLogThoroughInterval</td><td></td></tr><tr><td>flushConsumeQueueThoroughInterval</td><td></td></tr><tr><td>brokerRole</td><td>Broker \u7684\u89D2\u8272<br> - ASYNC_MASTER \u5F02\u6B65\u590D\u5236Master<br> - SYNC_MASTER \u540C\u6B65\u53CC\u5199Master<br> - SLAVE</td></tr><tr><td>flushDiskType</td><td>\u5237\u76D8\u65B9\u5F0F<br> - ASYNC_FLUSH \u5F02\u6B65\u5237\u76D8<br> - SYNC_FLUSH \u540C\u6B65\u5237\u76D8</td></tr><tr><td>checkTransactionMessageEnable</td><td></td></tr><tr><td>sendMessageThreadPoolNums</td><td>\u53D1\u6D88\u606F\u7EBF\u7A0B\u6C60\u6570\u91CF</td></tr><tr><td>pullMessageThreadPoolNums</td><td>\u62C9\u6D88\u606F\u7EBF\u7A0B\u6C60\u6570\u91CF</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8" aria-hidden="true">#</a> \u542F\u52A8</h3><p>1\u3001<strong>Start NameServer</strong> .\\mqnamesrv.cmd | start mqnamesrv.cmd\uFF08\u6216\u53CC\u51FB\uFF09</p><p>2\u3001<strong>Start Broker</strong> .\\mqbroker.cmd -n 192.168.0.5:9876 autoCreateTopicEnable=true | start mqbroker.cmd -n 192.168.0.5:9876 autoCreateTopicEnable=true\uFF08\u6216\u53CC\u51FB\uFF09</p><p>3\u3001\u5173\u95ED\uFF1Amqshutdown namesrv\u3001mqshutdown brokers</p><p><code>\uFF08mqadmin:\u7BA1\u7406\u5DE5\u5177\u3001mqnamesrv\uFF1A\u540D\u79F0\u670D\u52A1\u3001mqbroker:\u6D88\u606F\u4EE3\u7406\u670D\u52A1\u5668\uFF09</code></p><p><img src="'+k+'" alt="image-20220713164803431"></p><p><img src="'+r+'" alt="image-20220713164815150"></p><p><img src="'+d+`" alt="image-20220714105719209"></p><h3 id="\u542F\u52A8\u65F6jvm\u53C2\u6570\u62A5\u9519-\u4FEE\u6539\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u65F6jvm\u53C2\u6570\u62A5\u9519-\u4FEE\u6539\u6587\u4EF6" aria-hidden="true">#</a> \u542F\u52A8\u65F6jvm\u53C2\u6570\u62A5\u9519\uFF0C\u4FEE\u6539\u6587\u4EF6</h3><p>mqnamesrv.cmd-&gt;runserver.cmd</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>@echo off

<span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>JAVA_HOME:%JAVA_HOME%

<span class="token keyword">if</span> not exist <span class="token string">&quot;%JAVA_HOME%<span class="token entity" title="\\b">\\b</span>in\\java.exe&quot;</span> <span class="token builtin class-name">echo</span> Please <span class="token builtin class-name">set</span> the JAVA_HOME variable <span class="token keyword">in</span> your environment, We need java<span class="token punctuation">(</span>x64<span class="token punctuation">)</span><span class="token operator">!</span> <span class="token operator">&amp;</span> EXIT /B <span class="token number">1</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA=%JAVA_HOME%<span class="token entity" title="\\b">\\b</span>in\\java.exe&quot;</span>

setlocal

<span class="token builtin class-name">set</span> <span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span>%~dp0
<span class="token builtin class-name">set</span> <span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span>%BASE_DIR:~0,-1%
<span class="token keyword">for</span> %%d <span class="token keyword">in</span> <span class="token punctuation">(</span>%BASE_DIR%<span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token builtin class-name">set</span> <span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span>%%~dpd

<span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>BASE_DIR:%BASE_DIR%

<span class="token builtin class-name">set</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.<span class="token punctuation">;</span>%BASE_DIR%conf<span class="token punctuation">;</span>%BASE_DIR%lib<span class="token punctuation">\\</span>*<span class="token punctuation">;</span>%CLASSPATH%

<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
rem <span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -XX:SoftRefLRUPolicyMSPerMB=0 -XX:+CMSClassUnloadingEnabled -XX:SurvivorRatio=8 -XX:-UseParNewGC&quot;</span>
rem <span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -verbose:gc -Xloggc:&quot;</span>%USERPROFILE%<span class="token punctuation">\\</span>rmq_srv_gc.log<span class="token string">&quot; -XX:+PrintGCDetails -XX:+PrintGCDateStamps&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:-OmitStackTraceInFastThrow&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:-UseLargePages&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -cp &quot;</span>%CLASSPATH%<span class="token string">&quot;&quot;</span>

<span class="token string">&quot;%JAVA%&quot;</span> %JAVA_OPT% %*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>mqbroker.cmd-&gt;runbroker.cmd</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>@echo off

<span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>JAVA_HOME:%JAVA_HOME%

<span class="token keyword">if</span> not exist <span class="token string">&quot;%JAVA_HOME%<span class="token entity" title="\\b">\\b</span>in\\java.exe&quot;</span> <span class="token builtin class-name">echo</span> Please <span class="token builtin class-name">set</span> the JAVA_HOME variable <span class="token keyword">in</span> your environment, We need java<span class="token punctuation">(</span>x64<span class="token punctuation">)</span><span class="token operator">!</span> <span class="token operator">&amp;</span> EXIT /B <span class="token number">1</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA=%JAVA_HOME%<span class="token entity" title="\\b">\\b</span>in\\java.exe&quot;</span>

setlocal

<span class="token builtin class-name">set</span> <span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span>%~dp0
<span class="token builtin class-name">set</span> <span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span>%BASE_DIR:~0,-1%
<span class="token keyword">for</span> %%d <span class="token keyword">in</span> <span class="token punctuation">(</span>%BASE_DIR%<span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token builtin class-name">set</span> <span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span>%%~dpd

<span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>BASE_DIR:%BASE_DIR%

<span class="token builtin class-name">set</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.<span class="token punctuation">;</span>%BASE_DIR%conf<span class="token punctuation">;</span>%BASE_DIR%lib<span class="token punctuation">\\</span>*<span class="token punctuation">;</span>%CLASSPATH%

<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -server -Xms2g -Xmx2g&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:+UseG1GC -XX:G1HeapRegionSize=16m -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -XX:SoftRefLRUPolicyMSPerMB=0 -XX:SurvivorRatio=8&quot;</span>
rem <span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -verbose:gc -Xloggc:%USERPROFILE%\\mq_gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintAdaptiveSizePolicy&quot;</span>
rem <span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=30m&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:-OmitStackTraceInFastThrow&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:+AlwaysPreTouch&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:MaxDirectMemorySize=15g&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -XX:-UseLargePages -XX:-UseBiasedLocking&quot;</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;JAVA_OPT=%JAVA_OPT% -cp %CLASSPATH%&quot;</span>

<span class="token string">&quot;%JAVA%&quot;</span> %JAVA_OPT% %*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#docker\u5B89\u88C5" aria-hidden="true">#</a> Docker\u5B89\u88C5</h3><ol><li><strong>Start NameServer</strong></li></ol><p>docker pull apache/rocketmq:4.9.4</p><p>docker tag apache/rocketmq:4.9.4 registry.cn-chengdu.aliyuncs.com/jinfang/rocketmq:4.9.4</p><p>docker push registry.cn-chengdu.aliyuncs.com/jinfang/rocketmq:4.9.4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">9876</span>:9876 --name rocketmq-server --restart<span class="token operator">=</span>always --net<span class="token operator">=</span>host registry.cn-chengdu.aliyuncs.com/jinfang/rocketmq:4.9.4 ./mqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li><strong>Start Broker</strong></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">10911</span>:10911 --name rocketmq-broker -v E:<span class="token punctuation">\\</span>docker<span class="token punctuation">\\</span>rocketmq<span class="token punctuation">\\</span>conf<span class="token punctuation">\\</span>:/home/rocketmq/conf -v E:<span class="token punctuation">\\</span>docker<span class="token punctuation">\\</span>rocketmq<span class="token punctuation">\\</span>logs<span class="token punctuation">\\</span>:/home/rocketmq/logs -v E:<span class="token punctuation">\\</span>docker<span class="token punctuation">\\</span>rocketmq<span class="token punctuation">\\</span>store<span class="token punctuation">\\</span>:/home/rocketmq/store --restart<span class="token operator">=</span>always --net<span class="token operator">=</span>host -d registry.cn-chengdu.aliyuncs.com/jinfang/rocketmq:4.9.4 ./mqbroker -n <span class="token number">192.168</span>.0.5:9876
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u53EF\u89C6\u5316\u754C\u9762" tabindex="-1"><a class="header-anchor" href="#\u53EF\u89C6\u5316\u754C\u9762" aria-hidden="true">#</a> \u53EF\u89C6\u5316\u754C\u9762</h3><p>https://github.com/apache/rocketmq-externals</p><p>https://github.com/apache/rocketmq-externals/tree/release-rocketmq-console-1.0.0 (rocketmq-dashboard\u4EE3\u66FF)</p><p>https://github.com/apache/rocketmq-dashboard</p><p>\u6253\u5F00rocketmq-externals -&gt; rocketmq-console\u6211\u4EEC\u4F1A\u53D1\u73B0\u4ED6\u662F\u4E2Aspringboot\u9879\u76EE\uFF0C\u6B64\u65F6\u6211\u4EEC\u53EA\u9700\u8981\u505A\u4E00\u4E9B\u914D\u7F6E\u6587\u4EF6\u7684\u4FEE\u6539\u5E76\u542F\u52A8\u9879\u76EE\u5373\u53EF src -&gt; main -&gt; resource -&gt; application.properties \u4FEE\u6539 rocketmq.config.namesrvAddr=ip+port</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>alimaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>aliyun maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FEE\u6539\u5B8C\u6BD5\u540E\u542F\u52A8\u9879\u76EE\uFF0C\u7136\u540E\u8BBF\u95EE http://127.0.0.1:8080 \u5373\u53EF</p><p>\u6253\u5305jar</p><p>\u8FD0\u884C\u547D\u4EE4\uFF1Ajava -jar rocketmq-console-ng-2.0.0.jar --server.port=8181</p><h3 id="\u53EF\u89C6\u5316\u754C\u9762-docker" tabindex="-1"><a class="header-anchor" href="#\u53EF\u89C6\u5316\u754C\u9762-docker" aria-hidden="true">#</a> \u53EF\u89C6\u5316\u754C\u9762 docker</h3><p>docker pull apacherocketmq/rocketmq-dashboard:latest</p><p>docker run -d --name rocketmq-dashboard -e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.0.5:9876&quot; -p 8080:8080 -t apacherocketmq/rocketmq-dashboard:latest</p><p>http://127.0.0.1:8080</p><p><img src="`+m+'" alt="image-20220714102811856"></p><p><img src="'+v+'" alt="image-20220714102824828"></p><h2 id="_4\u3001\u6280\u672F\u67B6\u6784\u548C\u90E8\u7F72\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6280\u672F\u67B6\u6784\u548C\u90E8\u7F72\u67B6\u6784" aria-hidden="true">#</a> 4\u3001\u6280\u672F\u67B6\u6784\u548C\u90E8\u7F72\u67B6\u6784</h2><p><strong>\u6280\u672F\u67B6\u6784</strong></p><p><img src="'+g+'" alt="image-20220716132334903"></p><p>RocketMQ\u67B6\u6784\u4E0A\u4E3B\u8981\u5206\u4E3A\u56DB\u90E8\u5206\uFF0C\u5982\u4E0A\u56FE\u6240\u793A:</p><ul><li><strong>Producer</strong>\uFF1A\u6D88\u606F\u53D1\u5E03\u7684\u89D2\u8272\uFF0C\u652F\u6301\u5206\u5E03\u5F0F\u96C6\u7FA4\u65B9\u5F0F\u90E8\u7F72\u3002Producer\u901A\u8FC7MQ\u7684\u8D1F\u8F7D\u5747\u8861\u6A21\u5757\u9009\u62E9\u76F8\u5E94\u7684Broker\u96C6\u7FA4\u961F\u5217\u8FDB\u884C\u6D88\u606F\u6295\u9012\uFF0C\u6295\u9012\u7684\u8FC7\u7A0B\u652F\u6301\u5FEB\u901F\u5931\u8D25\u5E76\u4E14\u4F4E\u5EF6\u8FDF\u3002</li><li><strong>Consumer</strong>\uFF1A\u6D88\u606F\u6D88\u8D39\u7684\u89D2\u8272\uFF0C\u652F\u6301\u5206\u5E03\u5F0F\u96C6\u7FA4\u65B9\u5F0F\u90E8\u7F72\u3002\u652F\u6301\u4EE5push\u63A8\uFF0Cpull\u62C9\u4E24\u79CD\u6A21\u5F0F\u5BF9\u6D88\u606F\u8FDB\u884C\u6D88\u8D39\u3002\u540C\u65F6\u4E5F\u652F\u6301\u96C6\u7FA4\u65B9\u5F0F\u548C\u5E7F\u64AD\u65B9\u5F0F\u7684\u6D88\u8D39\uFF0C\u5B83\u63D0\u4F9B\u5B9E\u65F6\u6D88\u606F\u8BA2\u9605\u673A\u5236\uFF0C\u53EF\u4EE5\u6EE1\u8DB3\u5927\u591A\u6570\u7528\u6237\u7684\u9700\u6C42\u3002</li><li><strong>NameServer</strong>\uFF1ANameServer\u662F\u4E00\u4E2A\u975E\u5E38\u7B80\u5355\u7684Topic\u8DEF\u7531\u6CE8\u518C\u4E2D\u5FC3\uFF0C\u5176\u89D2\u8272\u7C7B\u4F3CDubbo\u4E2D\u7684zookeeper\uFF0C\u652F\u6301Broker\u7684\u52A8\u6001\u6CE8\u518C\u4E0E\u53D1\u73B0\u3002\u4E3B\u8981\u5305\u62EC\u4E24\u4E2A\u529F\u80FD\uFF1ABroker\u7BA1\u7406\uFF0CNameServer\u63A5\u53D7Broker\u96C6\u7FA4\u7684\u6CE8\u518C\u4FE1\u606F\u5E76\u4E14\u4FDD\u5B58\u4E0B\u6765\u4F5C\u4E3A\u8DEF\u7531\u4FE1\u606F\u7684\u57FA\u672C\u6570\u636E\u3002\u7136\u540E\u63D0\u4F9B\u5FC3\u8DF3\u68C0\u6D4B\u673A\u5236\uFF0C\u68C0\u67E5Broker\u662F\u5426\u8FD8\u5B58\u6D3B\uFF1B\u8DEF\u7531\u4FE1\u606F\u7BA1\u7406\uFF0C\u6BCF\u4E2ANameServer\u5C06\u4FDD\u5B58\u5173\u4E8EBroker\u96C6\u7FA4\u7684\u6574\u4E2A\u8DEF\u7531\u4FE1\u606F\u548C\u7528\u4E8E\u5BA2\u6237\u7AEF\u67E5\u8BE2\u7684\u961F\u5217\u4FE1\u606F\u3002\u7136\u540EProducer\u548CConumser\u901A\u8FC7NameServer\u5C31\u53EF\u4EE5\u77E5\u9053\u6574\u4E2ABroker\u96C6\u7FA4\u7684\u8DEF\u7531\u4FE1\u606F\uFF0C\u4ECE\u800C\u8FDB\u884C\u6D88\u606F\u7684\u6295\u9012\u548C\u6D88\u8D39\u3002NameServer\u901A\u5E38\u4E5F\u662F\u96C6\u7FA4\u7684\u65B9\u5F0F\u90E8\u7F72\uFF0C\u5404\u5B9E\u4F8B\u95F4\u76F8\u4E92\u4E0D\u8FDB\u884C\u4FE1\u606F\u901A\u8BAF\u3002Broker\u662F\u5411\u6BCF\u4E00\u53F0NameServer\u6CE8\u518C\u81EA\u5DF1\u7684\u8DEF\u7531\u4FE1\u606F\uFF0C\u6240\u4EE5\u6BCF\u4E00\u4E2ANameServer\u5B9E\u4F8B\u4E0A\u9762\u90FD\u4FDD\u5B58\u4E00\u4EFD\u5B8C\u6574\u7684\u8DEF\u7531\u4FE1\u606F\u3002\u5F53\u67D0\u4E2ANameServer\u56E0\u67D0\u79CD\u539F\u56E0\u4E0B\u7EBF\u4E86\uFF0CBroker\u4ECD\u7136\u53EF\u4EE5\u5411\u5176\u5B83NameServer\u540C\u6B65\u5176\u8DEF\u7531\u4FE1\u606F\uFF0CProducer\u548CConsumer\u4ECD\u7136\u53EF\u4EE5\u52A8\u6001\u611F\u77E5Broker\u7684\u8DEF\u7531\u7684\u4FE1\u606F\u3002</li><li><strong>BrokerServer</strong>\uFF1ABroker\u4E3B\u8981\u8D1F\u8D23\u6D88\u606F\u7684\u5B58\u50A8\u3001\u6295\u9012\u548C\u67E5\u8BE2\u4EE5\u53CA\u670D\u52A1\u9AD8\u53EF\u7528\u4FDD\u8BC1\uFF0C\u4E3A\u4E86\u5B9E\u73B0\u8FD9\u4E9B\u529F\u80FD\uFF0CBroker\u5305\u542B\u4E86\u4EE5\u4E0B\u51E0\u4E2A\u91CD\u8981\u5B50\u6A21\u5757\u3002 <ol><li>Remoting Module\uFF1A\u6574\u4E2ABroker\u7684\u5B9E\u4F53\uFF0C\u8D1F\u8D23\u5904\u7406\u6765\u81EAClient\u7AEF\u7684\u8BF7\u6C42\u3002</li><li>Client Manager\uFF1A\u8D1F\u8D23\u7BA1\u7406\u5BA2\u6237\u7AEF(Producer/Consumer)\u548C\u7EF4\u62A4Consumer\u7684Topic\u8BA2\u9605\u4FE1\u606F\u3002</li><li>Store Service\uFF1A\u63D0\u4F9B\u65B9\u4FBF\u7B80\u5355\u7684API\u63A5\u53E3\u5904\u7406\u6D88\u606F\u5B58\u50A8\u5230\u7269\u7406\u786C\u76D8\u548C\u67E5\u8BE2\u529F\u80FD\u3002</li><li>HA Service\uFF1A\u9AD8\u53EF\u7528\u670D\u52A1\uFF0C\u63D0\u4F9BMaster Broker \u548C Slave Broker\u4E4B\u95F4\u7684\u6570\u636E\u540C\u6B65\u529F\u80FD\u3002</li><li>Index Service\uFF1A\u6839\u636E\u7279\u5B9A\u7684Message key\u5BF9\u6295\u9012\u5230Broker\u7684\u6D88\u606F\u8FDB\u884C\u7D22\u5F15\u670D\u52A1\uFF0C\u4EE5\u63D0\u4F9B\u6D88\u606F\u7684\u5FEB\u901F\u67E5\u8BE2\u3002</li></ol></li></ul><p><strong>\u7F51\u7EDC\u90E8\u7F72\u7279\u70B9</strong></p><ul><li><p><strong>NameServer</strong>\u662F\u4E00\u4E2A\u51E0\u4E4E\u65E0\u72B6\u6001\u8282\u70B9\uFF0C\u53EF\u96C6\u7FA4\u90E8\u7F72\uFF0C\u8282\u70B9\u4E4B\u95F4\u65E0\u4EFB\u4F55\u4FE1\u606F\u540C\u6B65\u3002</p></li><li><p><strong>Broker</strong>\u90E8\u7F72\u76F8\u5BF9\u590D\u6742\uFF0CBroker\u5206\u4E3AMaster\u4E0ESlave\uFF0C\u4E00\u4E2AMaster\u53EF\u4EE5\u5BF9\u5E94\u591A\u4E2ASlave\uFF0C\u4F46\u662F\u4E00\u4E2ASlave\u53EA\u80FD\u5BF9\u5E94\u4E00\u4E2AMaster\uFF0CMaster\u4E0ESlave \u7684\u5BF9\u5E94\u5173\u7CFB\u901A\u8FC7\u6307\u5B9A\u76F8\u540C\u7684BrokerName\uFF0C\u4E0D\u540C\u7684BrokerId \u6765\u5B9A\u4E49\uFF0CBrokerId\u4E3A0\u8868\u793AMaster\uFF0C\u975E0\u8868\u793ASlave\u3002Master\u4E5F\u53EF\u4EE5\u90E8\u7F72\u591A\u4E2A\u3002\u6BCF\u4E2ABroker\u4E0ENameServer\u96C6\u7FA4\u4E2D\u7684\u6240\u6709\u8282\u70B9\u5EFA\u7ACB\u957F\u8FDE\u63A5\uFF0C\u5B9A\u65F6\u6CE8\u518CTopic\u4FE1\u606F\u5230\u6240\u6709NameServer\u3002</p><p><strong>\u6CE8\u610F</strong>\uFF1A\u5F53\u524DRocketMQ\u7248\u672C\u5728\u90E8\u7F72\u67B6\u6784\u4E0A\u652F\u6301\u4E00Master\u591ASlave\uFF0C\u4F46\u53EA\u6709BrokerId=1\u7684\u4ECE\u670D\u52A1\u5668\u624D\u4F1A\u53C2\u4E0E\u6D88\u606F\u7684\u8BFB\u8D1F\u8F7D\u3002</p></li><li><p><strong>Producer\u4E0ENameServer</strong>\u96C6\u7FA4\u4E2D\u7684\u5176\u4E2D\u4E00\u4E2A\u8282\u70B9\uFF08\u968F\u673A\u9009\u62E9\uFF09\u5EFA\u7ACB\u957F\u8FDE\u63A5\uFF0C\u5B9A\u671F\u4ECENameServer\u83B7\u53D6Topic\u8DEF\u7531\u4FE1\u606F\uFF0C\u5E76\u5411\u63D0\u4F9BTopic \u670D\u52A1\u7684Master\u5EFA\u7ACB\u957F\u8FDE\u63A5\uFF0C\u4E14\u5B9A\u65F6\u5411Master\u53D1\u9001\u5FC3\u8DF3\u3002Producer\u5B8C\u5168\u65E0\u72B6\u6001\uFF0C\u53EF\u96C6\u7FA4\u90E8\u7F72\u3002</p></li><li><p><strong>Consumer\u4E0ENameServer</strong>\u96C6\u7FA4\u4E2D\u7684\u5176\u4E2D\u4E00\u4E2A\u8282\u70B9\uFF08\u968F\u673A\u9009\u62E9\uFF09\u5EFA\u7ACB\u957F\u8FDE\u63A5\uFF0C\u5B9A\u671F\u4ECENameServer\u83B7\u53D6Topic\u8DEF\u7531\u4FE1\u606F\uFF0C\u5E76\u5411\u63D0\u4F9BTopic\u670D\u52A1\u7684Master\u3001Slave\u5EFA\u7ACB\u957F\u8FDE\u63A5\uFF0C\u4E14\u5B9A\u65F6\u5411Master\u3001Slave\u53D1\u9001\u5FC3\u8DF3\u3002Consumer\u65E2\u53EF\u4EE5\u4ECEMaster\u8BA2\u9605\u6D88\u606F\uFF0C\u4E5F\u53EF\u4EE5\u4ECESlave\u8BA2\u9605\u6D88\u606F\uFF0C\u6D88\u8D39\u8005\u5728\u5411Master\u62C9\u53D6\u6D88\u606F\u65F6\uFF0CMaster\u670D\u52A1\u5668\u4F1A\u6839\u636E\u62C9\u53D6\u504F\u79FB\u91CF\u4E0E\u6700\u5927\u504F\u79FB\u91CF\u7684\u8DDD\u79BB\uFF08\u5224\u65AD\u662F\u5426\u8BFB\u8001\u6D88\u606F\uFF0C\u4EA7\u751F\u8BFBI/O\uFF09\uFF0C\u4EE5\u53CA\u4ECE\u670D\u52A1\u5668\u662F\u5426\u53EF\u8BFB\u7B49\u56E0\u7D20\u5EFA\u8BAE\u4E0B\u4E00\u6B21\u662F\u4ECEMaster\u8FD8\u662FSlave\u62C9\u53D6\u3002</p></li></ul><p>\u7ED3\u5408\u90E8\u7F72\u67B6\u6784\u56FE\uFF0C\u63CF\u8FF0\u96C6\u7FA4\u5DE5\u4F5C\u6D41\u7A0B\uFF1A</p><ul><li>\u542F\u52A8NameServer\uFF0CNameServer\u8D77\u6765\u540E\u76D1\u542C\u7AEF\u53E3\uFF0C\u7B49\u5F85Broker\u3001Producer\u3001Consumer\u8FDE\u4E0A\u6765\uFF0C\u76F8\u5F53\u4E8E\u4E00\u4E2A\u8DEF\u7531\u63A7\u5236\u4E2D\u5FC3\u3002</li><li>Broker\u542F\u52A8\uFF0C\u8DDF\u6240\u6709\u7684NameServer\u4FDD\u6301\u957F\u8FDE\u63A5\uFF0C\u5B9A\u65F6\u53D1\u9001\u5FC3\u8DF3\u5305\u3002\u5FC3\u8DF3\u5305\u4E2D\u5305\u542B\u5F53\u524DBroker\u4FE1\u606F(IP+\u7AEF\u53E3\u7B49)\u4EE5\u53CA\u5B58\u50A8\u6240\u6709Topic\u4FE1\u606F\u3002\u6CE8\u518C\u6210\u529F\u540E\uFF0CNameServer\u96C6\u7FA4\u4E2D\u5C31\u6709Topic\u8DDFBroker\u7684\u6620\u5C04\u5173\u7CFB\u3002</li><li>\u6536\u53D1\u6D88\u606F\u524D\uFF0C\u5148\u521B\u5EFATopic\uFF0C\u521B\u5EFATopic\u65F6\u9700\u8981\u6307\u5B9A\u8BE5Topic\u8981\u5B58\u50A8\u5728\u54EA\u4E9BBroker\u4E0A\uFF0C\u4E5F\u53EF\u4EE5\u5728\u53D1\u9001\u6D88\u606F\u65F6\u81EA\u52A8\u521B\u5EFATopic\u3002</li><li>Producer\u53D1\u9001\u6D88\u606F\uFF0C\u542F\u52A8\u65F6\u5148\u8DDFNameServer\u96C6\u7FA4\u4E2D\u7684\u5176\u4E2D\u4E00\u53F0\u5EFA\u7ACB\u957F\u8FDE\u63A5\uFF0C\u5E76\u4ECENameServer\u4E2D\u83B7\u53D6\u5F53\u524D\u53D1\u9001\u7684Topic\u5B58\u5728\u54EA\u4E9BBroker\u4E0A\uFF0C\u8F6E\u8BE2\u4ECE\u961F\u5217\u5217\u8868\u4E2D\u9009\u62E9\u4E00\u4E2A\u961F\u5217\uFF0C\u7136\u540E\u4E0E\u961F\u5217\u6240\u5728\u7684Broker\u5EFA\u7ACB\u957F\u8FDE\u63A5\u4ECE\u800C\u5411Broker\u53D1\u6D88\u606F\u3002</li><li>Consumer\u8DDFProducer\u7C7B\u4F3C\uFF0C\u8DDF\u5176\u4E2D\u4E00\u53F0NameServer\u5EFA\u7ACB\u957F\u8FDE\u63A5\uFF0C\u83B7\u53D6\u5F53\u524D\u8BA2\u9605Topic\u5B58\u5728\u54EA\u4E9BBroker\u4E0A\uFF0C\u7136\u540E\u76F4\u63A5\u8DDFBroker\u5EFA\u7ACB\u8FDE\u63A5\u901A\u9053\uFF0C\u5F00\u59CB\u6D88\u8D39\u6D88\u606F\u3002</li></ul><h2 id="_5\u3001\u5173\u952E\u673A\u5236\u7684\u8BBE\u8BA1\u539F\u7406-\u4E3B\u8981\u5305\u62EC\u6D88\u606F\u5B58\u50A8\u3001\u901A\u4FE1\u673A\u5236\u3001\u6D88\u606F\u8FC7\u6EE4\u3001\u8D1F\u8F7D\u5747\u8861\u3001\u4E8B\u52A1\u6D88\u606F\u7B49" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u5173\u952E\u673A\u5236\u7684\u8BBE\u8BA1\u539F\u7406-\u4E3B\u8981\u5305\u62EC\u6D88\u606F\u5B58\u50A8\u3001\u901A\u4FE1\u673A\u5236\u3001\u6D88\u606F\u8FC7\u6EE4\u3001\u8D1F\u8F7D\u5747\u8861\u3001\u4E8B\u52A1\u6D88\u606F\u7B49" aria-hidden="true">#</a> 5\u3001\u5173\u952E\u673A\u5236\u7684\u8BBE\u8BA1\u539F\u7406\uFF0C\u4E3B\u8981\u5305\u62EC\u6D88\u606F\u5B58\u50A8\u3001\u901A\u4FE1\u673A\u5236\u3001\u6D88\u606F\u8FC7\u6EE4\u3001\u8D1F\u8F7D\u5747\u8861\u3001\u4E8B\u52A1\u6D88\u606F\u7B49</h2><p>https://github.com/apache/rocketmq/blob/master/docs/cn/design.md</p><h3 id="\u57FA\u672C\u8DEF\u7531\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u8DEF\u7531\u89C4\u5219" aria-hidden="true">#</a> \u57FA\u672C\u8DEF\u7531\u89C4\u5219</h3><p><img src="'+b+'" alt="image-20220716134814483"></p><p>Broker \u5728\u542F\u52A8\u65F6\u5411 Nameserver \u6CE8\u518C\u5B58\u50A8\u5728\u8BE5\u670D\u52A1\u5668\u4E0A\u7684\u8DEF\u7531\u4FE1\u606F\uFF0C\u5E76\u6BCF\u9694 30s \u5411Nameserver \u53D1\u9001\u5FC3\u8DF3\u5305\uFF0C\u5E76\u66F4\u65B0\u8DEF\u7531\u4FE1\u606F\u3002Nameserver \u6BCF\u9694 10s \u626B\u63CF\u8DEF\u7531\u8868\uFF0C\u5982\u679C\u68C0\u6D4B\u5230 Broker \u670D\u52A1\u5B95\u673A\uFF0C\u5219\u79FB\u9664\u5BF9\u5E94\u7684\u8DEF\u7531\u4FE1\u606F\u3002</p><p>\u6D88\u606F\u751F\u4EA7\u8005\u6BCF\u9694 30s \u4F1A\u4ECE Nameserver \u91CD\u65B0\u62C9\u53D6 Topic \u7684\u8DEF\u7531\u4FE1\u606F\u5E76\u66F4\u65B0\u672C\u5730\u8DEF\u7531\u8868\uFF1B\u5728\u6D88\u606F\u53D1\u9001\u4E4B\u524D\uFF0C\u5982\u679C\u672C\u5730\u8DEF\u7531\u8868\u4E2D\u4E0D\u5B58\u5728\u5BF9\u5E94\u4E3B\u9898\u7684\u8DEF\u7531\u6D88\u606F\u65F6\uFF0C\u4F1A\u4E3B\u52A8\u5411Nameserver \u62C9\u53D6\u8BE5\u4E3B\u9898\u7684\u6D88\u606F\u3002</p><h3 id="\u81EA\u52A8\u521B\u5EFA\u4E3B\u9898\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#\u81EA\u52A8\u521B\u5EFA\u4E3B\u9898\u673A\u5236" aria-hidden="true">#</a> \u81EA\u52A8\u521B\u5EFA\u4E3B\u9898\u673A\u5236</h3><p><img src="'+y+`" alt="image-20220716135827145"></p><h2 id="_6\u3001\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u6837\u4F8B" aria-hidden="true">#</a> 6\u3001\u6837\u4F8B</h2><h3 id="_6-1\u3001\u57FA\u672C\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-1\u3001\u57FA\u672C\u6837\u4F8B" aria-hidden="true">#</a> 6.1\u3001\u57FA\u672C\u6837\u4F8B</h3><p>\u6837\u4F8B\uFF1A</p><p>https://gitee.com/MFork/rocketmq/blob/develop/docs/cn/RocketMQ_Example.md</p><p>https://github.com/apache/rocketmq/blob/master/docs/cn/RocketMQ_Example.md</p><p>\u5728\u57FA\u672C\u6837\u4F8B\u4E2D\u6211\u4EEC\u63D0\u4F9B\u5982\u4E0B\u7684\u529F\u80FD\u573A\u666F\uFF1A</p><ul><li>\u4F7F\u7528RocketMQ\u53D1\u9001\u4E09\u79CD\u7C7B\u578B\u7684\u6D88\u606F\uFF1A\u540C\u6B65\u6D88\u606F\u3001\u5F02\u6B65\u6D88\u606F\u548C\u5355\u5411\u6D88\u606F\u3002\u5176\u4E2D\u524D\u4E24\u79CD\u6D88\u606F\u662F\u53EF\u9760\u7684\uFF0C\u56E0\u4E3A\u4F1A\u6709\u53D1\u9001\u662F\u5426\u6210\u529F\u7684\u5E94\u7B54\u3002</li><li>\u4F7F\u7528RocketMQ\u6765\u6D88\u8D39\u63A5\u6536\u5230\u7684\u6D88\u606F\u3002</li></ul><h4 id="_6-1-1-\u52A0\u5165\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_6-1-1-\u52A0\u5165\u4F9D\u8D56" aria-hidden="true">#</a> 6.1.1 \u52A0\u5165\u4F9D\u8D56</h4><p><code>maven</code></p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>gradle</code></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">compile</span> <span class="token value attr-value">&#39;org.apache.rocketmq:rocketmq-client:4.9.4&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-1-2-\u6D88\u606F\u53D1\u9001" tabindex="-1"><a class="header-anchor" href="#_6-1-2-\u6D88\u606F\u53D1\u9001" aria-hidden="true">#</a> 6.1.2 \u6D88\u606F\u53D1\u9001</h4><h5 id="_6-1-2-1\u3001\u53D1\u9001\u540C\u6B65\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_6-1-2-1\u3001\u53D1\u9001\u540C\u6B65\u6D88\u606F" aria-hidden="true">#</a> 6.1.2.1\u3001\u53D1\u9001\u540C\u6B65\u6D88\u606F</h5><p>\u8FD9\u79CD\u53EF\u9760\u6027\u540C\u6B65\u5730\u53D1\u9001\u65B9\u5F0F\u4F7F\u7528\u7684\u6BD4\u8F83\u5E7F\u6CDB\uFF0C\u6BD4\u5982\uFF1A\u91CD\u8981\u7684\u6D88\u606F\u901A\u77E5\uFF0C\u77ED\u4FE1\u901A\u77E5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u521B\u5EFA\u6D88\u606F\uFF0C\u5E76\u6307\u5B9ATopic\uFF0CTag\u548C\u6D88\u606F\u4F53</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span>
                    <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;666 Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u53D1\u9001\u6D88\u606F\u5230\u4E00\u4E2ABroker</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u901A\u8FC7sendResult\u8FD4\u56DE\u6D88\u606F\u662F\u5426\u6210\u529F\u9001\u8FBE</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-1-2-2\u3001\u53D1\u9001\u5F02\u6B65\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_6-1-2-2\u3001\u53D1\u9001\u5F02\u6B65\u6D88\u606F" aria-hidden="true">#</a> 6.1.2.2\u3001\u53D1\u9001\u5F02\u6B65\u6D88\u606F</h5><p>\u5F02\u6B65\u6D88\u606F\u901A\u5E38\u7528\u5728\u5BF9\u54CD\u5E94\u65F6\u95F4\u654F\u611F\u7684\u4E1A\u52A1\u573A\u666F\uFF0C\u5373\u53D1\u9001\u7AEF\u4E0D\u80FD\u5BB9\u5FCD\u957F\u65F6\u95F4\u5730\u7B49\u5F85Broker\u7684\u54CD\u5E94\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u8BBE\u7F6E\u53D1\u9001\u5F02\u6B65\u5931\u8D25\u65F6\u7684\u91CD\u8BD5\u6B21\u6570</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>RETRY_TIMES_WHEN_SEND_ASYNC_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> messageCount <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6839\u636E\u6D88\u606F\u6570\u91CF\u5B9E\u4F8B\u5316\u5012\u8BA1\u65F6\u8BA1\u7B97\u5668</span>
        <span class="token keyword">final</span> <span class="token class-name">CountDownLatch2</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch2</span><span class="token punctuation">(</span>messageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> messageCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token comment">// \u521B\u5EFA\u6D88\u606F\uFF0C\u5E76\u6307\u5B9ATopic\uFF0CTag\u548C\u6D88\u606F\u4F53</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span>
                    <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;OrderID188&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;888 Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// SendCallback\u63A5\u6536\u5F02\u6B65\u8FD4\u56DE\u7ED3\u679C\u7684\u56DE\u8C03</span>
            producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d OK %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                            sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d Exception %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u7B49\u5F855s</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-1-2-3\u3001\u5355\u5411\u53D1\u9001\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_6-1-2-3\u3001\u5355\u5411\u53D1\u9001\u6D88\u606F" aria-hidden="true">#</a> 6.1.2.3\u3001\u5355\u5411\u53D1\u9001\u6D88\u606F</h5><p>\u8FD9\u79CD\u65B9\u5F0F\u4E3B\u8981\u7528\u5728\u4E0D\u7279\u522B\u5173\u5FC3\u53D1\u9001\u7ED3\u679C\u7684\u573A\u666F\uFF0C\u4F8B\u5982\u65E5\u5FD7\u53D1\u9001\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">onewayProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9E\u4F8B\u5316\u6D88\u606F\u751F\u4EA7\u8005Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6ENameServer\u7684\u5730\u5740</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u542F\u52A8Producer\u5B9E\u4F8B</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u521B\u5EFA\u6D88\u606F\uFF0C\u5E76\u6307\u5B9ATopic\uFF0CTag\u548C\u6D88\u606F\u4F53</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span>
                    <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string">&quot;111 Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u53D1\u9001\u5355\u5411\u6D88\u606F\uFF0C\u6CA1\u6709\u4EFB\u4F55\u8FD4\u56DE\u7ED3\u679C</span>
            producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token comment">// \u5982\u679C\u4E0D\u518D\u53D1\u9001\u6D88\u606F\uFF0C\u5173\u95EDProducer\u5B9E\u4F8B\u3002</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-1-3-\u6D88\u8D39\u6D88\u606F-pushconsumer" tabindex="-1"><a class="header-anchor" href="#_6-1-3-\u6D88\u8D39\u6D88\u606F-pushconsumer" aria-hidden="true">#</a> 6.1.3 \u6D88\u8D39\u6D88\u606F - PushConsumer</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9E\u4F8B\u5316\u6D88\u8D39\u8005</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>CONSUMER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6ENameServer\u7684\u5730\u5740</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BA2\u9605\u4E00\u4E2A\u6216\u8005\u591A\u4E2ATopic\uFF0C\u4EE5\u53CATag\u6765\u8FC7\u6EE4\u9700\u8981\u6D88\u8D39\u7684\u6D88\u606F</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6CE8\u518C\u56DE\u8C03\u5B9E\u73B0\u7C7B\u6765\u5904\u7406\u4ECEbroker\u62C9\u53D6\u56DE\u6765\u7684\u6D88\u606F</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u6807\u8BB0\u8BE5\u6D88\u606F\u5DF2\u7ECF\u88AB\u6210\u529F\u6D88\u8D39</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span>CONSUME_SUCCESS<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u542F\u52A8\u6D88\u8D39\u8005\u5B9E\u4F8B</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-\u987A\u5E8F\u6D88\u606F\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-2-\u987A\u5E8F\u6D88\u606F\u6837\u4F8B" aria-hidden="true">#</a> 6.2 \u987A\u5E8F\u6D88\u606F\u6837\u4F8B</h3><p>\u6D88\u606F\u6709\u5E8F\u6307\u7684\u662F\u53EF\u4EE5\u6309\u7167\u6D88\u606F\u7684\u53D1\u9001\u987A\u5E8F\u6765\u6D88\u8D39(FIFO)\u3002RocketMQ\u53EF\u4EE5\u4E25\u683C\u7684\u4FDD\u8BC1\u6D88\u606F\u6709\u5E8F\uFF0C\u53EF\u4EE5\u5206\u4E3A\u5206\u533A\u6709\u5E8F\u6216\u8005\u5168\u5C40\u6709\u5E8F\u3002</p><p>\u987A\u5E8F\u6D88\u8D39\u7684\u539F\u7406\u89E3\u6790\uFF0C\u5728\u9ED8\u8BA4\u7684\u60C5\u51B5\u4E0B\u6D88\u606F\u53D1\u9001\u4F1A\u91C7\u53D6Round Robin\u8F6E\u8BE2\u65B9\u5F0F\u628A\u6D88\u606F\u53D1\u9001\u5230\u4E0D\u540C\u7684queue(\u5206\u533A\u961F\u5217)\uFF1B\u800C\u6D88\u8D39\u6D88\u606F\u7684\u65F6\u5019\u4ECE\u591A\u4E2Aqueue\u4E0A\u62C9\u53D6\u6D88\u606F\uFF0C\u8FD9\u79CD\u60C5\u51B5\u53D1\u9001\u548C\u6D88\u8D39\u662F\u4E0D\u80FD\u4FDD\u8BC1\u987A\u5E8F\u3002\u4F46\u662F\u5982\u679C\u63A7\u5236\u53D1\u9001\u7684\u987A\u5E8F\u6D88\u606F\u53EA\u4F9D\u6B21\u53D1\u9001\u5230\u540C\u4E00\u4E2Aqueue\u4E2D\uFF0C\u6D88\u8D39\u7684\u65F6\u5019\u53EA\u4ECE\u8FD9\u4E2Aqueue\u4E0A\u4F9D\u6B21\u62C9\u53D6\uFF0C\u5219\u5C31\u4FDD\u8BC1\u4E86\u987A\u5E8F\u3002\u5F53\u53D1\u9001\u548C\u6D88\u8D39\u53C2\u4E0E\u7684queue\u53EA\u6709\u4E00\u4E2A\uFF0C\u5219\u662F\u5168\u5C40\u6709\u5E8F\uFF1B\u5982\u679C\u591A\u4E2Aqueue\u53C2\u4E0E\uFF0C\u5219\u4E3A\u5206\u533A\u6709\u5E8F\uFF0C\u5373\u76F8\u5BF9\u6BCF\u4E2Aqueue\uFF0C\u6D88\u606F\u90FD\u662F\u6709\u5E8F\u7684\u3002</p><p>\u4E0B\u9762\u7528\u8BA2\u5355\u8FDB\u884C\u5206\u533A\u6709\u5E8F\u7684\u793A\u4F8B\u3002\u4E00\u4E2A\u8BA2\u5355\u7684\u987A\u5E8F\u6D41\u7A0B\u662F\uFF1A\u521B\u5EFA\u3001\u4ED8\u6B3E\u3001\u63A8\u9001\u3001\u5B8C\u6210\u3002\u8BA2\u5355\u53F7\u76F8\u540C\u7684\u6D88\u606F\u4F1A\u88AB\u5148\u540E\u53D1\u9001\u5230\u540C\u4E00\u4E2A\u961F\u5217\u4E2D\uFF0C\u6D88\u8D39\u65F6\uFF0C\u540C\u4E00\u4E2AOrderId\u83B7\u53D6\u5230\u7684\u80AF\u5B9A\u662F\u540C\u4E00\u4E2A\u961F\u5217\u3002</p><h4 id="_6-2-1-\u987A\u5E8F\u6D88\u606F\u751F\u4EA7" tabindex="-1"><a class="header-anchor" href="#_6-2-1-\u987A\u5E8F\u6D88\u606F\u751F\u4EA7" aria-hidden="true">#</a> 6.2.1 \u987A\u5E8F\u6D88\u606F\u751F\u4EA7</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>order</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">DateUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">MessageQueueSelector</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageQueue</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 13:14
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagD&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BA2\u5355\u5217\u8868</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u4E2A\u65F6\u95F4\u524D\u7F00</span>
            <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; Hello RocketMQ &quot;</span> <span class="token operator">+</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueueSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> mqs<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Long</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>  <span class="token comment">//\u6839\u636E\u8BA2\u5355id\u9009\u62E9\u53D1\u9001queue</span>
                    <span class="token keyword">long</span> index <span class="token operator">=</span> id <span class="token operator">%</span> mqs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> mqs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8BA2\u5355id</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;SendResult status:%s, queueId:%d, body:%s&quot;</span><span class="token punctuation">,</span>
                    sendResult<span class="token punctuation">.</span><span class="token function">getSendStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    sendResult<span class="token punctuation">.</span><span class="token function">getMessageQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">class</span> <span class="token class-name">OrderStep</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> orderId<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * \u751F\u6210\u6A21\u62DF\u8BA2\u5355\u6570\u636E
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">OrderStep</span> orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u521B\u5EFA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u521B\u5EFA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u4ED8\u6B3E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u521B\u5EFA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u4ED8\u6B3E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u4ED8\u6B3E&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u5B8C\u6210&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u63A8\u9001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u5B8C\u6210&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u5B8C\u6210&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> orderList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2-2-\u987A\u5E8F\u6D88\u8D39\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_6-2-2-\u987A\u5E8F\u6D88\u8D39\u6D88\u606F" aria-hidden="true">#</a> 6.2.2 \u987A\u5E8F\u6D88\u8D39\u6D88\u606F</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>order</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQPushConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeOrderlyContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeOrderlyStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">MessageListenerOrderly</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">ConsumeFromWhere</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageExt</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u987A\u5E8F\u6D88\u606F\u6D88\u8D39\uFF0C\u5E26\u4E8B\u52A1\u65B9\u5F0F\uFF08\u5E94\u7528\u53EF\u63A7\u5236Offset\u4EC0\u4E48\u65F6\u5019\u63D0\u4EA4\uFF09
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 13:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerInOrder</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>CONSUMER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u8BBE\u7F6E Consumer \u7B2C\u4E00\u6B21\u542F\u52A8\u662F\u4ECE\u961F\u5217\u5934\u90E8\u5F00\u59CB\u6D88\u8D39\u8FD8\u662F\u961F\u5217\u5C3E\u90E8\u5F00\u59CB\u6D88\u8D39<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         * \u5982\u679C\u975E\u7B2C\u4E00\u6B21\u542F\u52A8\uFF0C\u90A3\u4E48\u6309\u7167\u4E0A\u6B21\u6D88\u8D39\u7684\u4F4D\u7F6E\u7EE7\u7EED\u6D88\u8D39
         */</span>
        consumer<span class="token punctuation">.</span><span class="token function">setConsumeFromWhere</span><span class="token punctuation">(</span><span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span>CONSUME_FROM_FIRST_OFFSET<span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span> <span class="token string">&quot;TagA || TagC || TagD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6CE8\u518C\u6D88\u606F\u76D1\u542C\u5668</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerOrderly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeOrderlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeOrderlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                context<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u53EF\u4EE5\u770B\u5230\u6BCF\u4E2Aqueue\u6709\u552F\u4E00\u7684consume\u7EBF\u7A0B\u6765\u6D88\u8D39, \u8BA2\u5355\u5BF9\u6BCF\u4E2Aqueue(\u5206\u533A)\u6709\u5E8F</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumeThread=&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, queueId=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, content:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u6A21\u62DF\u4E1A\u52A1\u903B\u8F91\u5904\u7406\u4E2D...</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-\u5EF6\u65F6\u6D88\u606F\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-3-\u5EF6\u65F6\u6D88\u606F\u6837\u4F8B" aria-hidden="true">#</a> 6.3 \u5EF6\u65F6\u6D88\u606F\u6837\u4F8B</h3><h4 id="_6-3-1-\u542F\u52A8\u6D88\u8D39\u8005\u7B49\u5F85\u4F20\u5165\u8BA2\u9605\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_6-3-1-\u542F\u52A8\u6D88\u8D39\u8005\u7B49\u5F85\u4F20\u5165\u8BA2\u9605\u6D88\u606F" aria-hidden="true">#</a> 6.3.1 \u542F\u52A8\u6D88\u8D39\u8005\u7B49\u5F85\u4F20\u5165\u8BA2\u9605\u6D88\u606F</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>delayedmessage</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQPushConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeConcurrentlyContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeConcurrentlyStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">MessageListenerConcurrently</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageExt</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u542F\u52A8\u6D88\u8D39\u8005\u7B49\u5F85\u4F20\u5165\u8BA2\u9605\u6D88\u606F
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 13:58
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageConsumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9E\u4F8B\u5316\u6D88\u8D39\u8005</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>EXAMPLE_CONSUMER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6ENameServer\u7684\u5730\u5740</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BA2\u9605Topics</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6CE8\u518C\u6D88\u606F\u76D1\u542C\u8005</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> message <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==&gt; \u63A5\u6536\u5230\u8D85\u65F6\u8BA2\u5355 [\u8BA2\u5355ID=&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, \u5185\u5BB9\u8BE6\u60C5:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> message<span class="token punctuation">.</span><span class="token function">getBornTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms later&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span>CONSUME_SUCCESS<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u542F\u52A8\u6D88\u8D39\u8005</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-2-\u53D1\u9001\u5EF6\u65F6\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_6-3-2-\u53D1\u9001\u5EF6\u65F6\u6D88\u606F" aria-hidden="true">#</a> 6.3.2 \u53D1\u9001\u5EF6\u65F6\u6D88\u606F</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>delayedmessage</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">DateUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u53D1\u9001\u5EF6\u65F6\u6D88\u606F
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * \u6BD4\u5982\u7535\u5546\u91CC\uFF0C\u63D0\u4EA4\u4E86\u4E00\u4E2A\u8BA2\u5355\u5C31\u53EF\u4EE5\u53D1\u9001\u4E00\u4E2A\u5EF6\u65F6\u6D88\u606F\uFF0C1h\u540E\u53BB\u68C0\u67E5\u8FD9\u4E2A\u8BA2\u5355\u7684\u72B6\u6001\uFF0C\u5982\u679C\u8FD8\u662F\u672A\u4ED8\u6B3E\u5C31\u53D6\u6D88\u8BA2\u5355\u91CA\u653E\u5E93\u5B58\u3002
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 14:02
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9E\u4F8B\u5316\u4E00\u4E2A\u751F\u4EA7\u8005\u6765\u4EA7\u751F\u5EF6\u65F6\u6D88\u606F</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>EXAMPLE_PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6ENameServer\u7684\u5730\u5740</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u542F\u52A8\u751F\u4EA7\u8005</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> totalMessagesToSend <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalMessagesToSend<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\uFF0C\u4F60\u597D\uFF0C\u9884\u5B9A\u6D88\u606F &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BBE\u7F6E\u5EF6\u65F6\u7B49\u7EA73,\u8FD9\u4E2A\u6D88\u606F\u5C06\u572810s\u4E4B\u540E\u53D1\u9001(\u73B0\u5728\u53EA\u652F\u6301\u56FA\u5B9A\u7684\u51E0\u4E2A\u65F6\u95F4,\u8BE6\u770BdelayTimeLevel)</span>
            <span class="token comment">// messageDelayLevel = &quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;;</span>
            <span class="token comment">// \u4ECE1s\u52302h\u5206\u522B\u5BF9\u5E94\u7740\u7B49\u7EA71\u523018</span>
            message<span class="token punctuation">.</span><span class="token function">setDelayTimeLevel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u53D1\u9001\u6D88\u606F</span>
            producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u5173\u95ED\u751F\u4EA7\u8005</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-3-\u5EF6\u65F6\u6D88\u606F\u7684\u4F7F\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_6-3-3-\u5EF6\u65F6\u6D88\u606F\u7684\u4F7F\u7528\u573A\u666F" aria-hidden="true">#</a> 6.3.3 \u5EF6\u65F6\u6D88\u606F\u7684\u4F7F\u7528\u573A\u666F</h4><p>\u6BD4\u5982\u7535\u5546\u91CC\uFF0C\u63D0\u4EA4\u4E86\u4E00\u4E2A\u8BA2\u5355\u5C31\u53EF\u4EE5\u53D1\u9001\u4E00\u4E2A\u5EF6\u65F6\u6D88\u606F\uFF0C1h\u540E\u53BB\u68C0\u67E5\u8FD9\u4E2A\u8BA2\u5355\u7684\u72B6\u6001\uFF0C\u5982\u679C\u8FD8\u662F\u672A\u4ED8\u6B3E\u5C31\u53D6\u6D88\u8BA2\u5355\u91CA\u653E\u5E93\u5B58\u3002</p><h4 id="_6-3-4-\u5EF6\u65F6\u6D88\u606F\u7684\u4F7F\u7528\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#_6-3-4-\u5EF6\u65F6\u6D88\u606F\u7684\u4F7F\u7528\u9650\u5236" aria-hidden="true">#</a> 6.3.4 \u5EF6\u65F6\u6D88\u606F\u7684\u4F7F\u7528\u9650\u5236</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// org/apache/rocketmq/store/config/MessageStoreConfig.java</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> messageDelayLevel <span class="token operator">=</span> <span class="token string">&quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u73B0\u5728RocketMq\u5E76\u4E0D\u652F\u6301\u4EFB\u610F\u65F6\u95F4\u7684\u5EF6\u65F6\uFF0C\u9700\u8981\u8BBE\u7F6E\u51E0\u4E2A\u56FA\u5B9A\u7684\u5EF6\u65F6\u7B49\u7EA7\uFF0C\u4ECE1s\u52302h\u5206\u522B\u5BF9\u5E94\u7740\u7B49\u7EA71\u523018 \u6D88\u606F\u6D88\u8D39\u5931\u8D25\u4F1A\u8FDB\u5165\u5EF6\u65F6\u6D88\u606F\u961F\u5217\uFF0C\u6D88\u606F\u53D1\u9001\u65F6\u95F4\u4E0E\u8BBE\u7F6E\u7684\u5EF6\u65F6\u7B49\u7EA7\u548C\u91CD\u8BD5\u6B21\u6570\u6709\u5173\uFF0C\u8BE6\u89C1\u4EE3\u7801<code>SendMessageProcessor.java</code></p><h3 id="_6-4-\u6279\u91CF\u6D88\u606F\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-4-\u6279\u91CF\u6D88\u606F\u6837\u4F8B" aria-hidden="true">#</a> 6.4 \u6279\u91CF\u6D88\u606F\u6837\u4F8B</h3><p>\u6279\u91CF\u53D1\u9001\u6D88\u606F\u80FD\u663E\u8457\u63D0\u9AD8\u4F20\u9012\u5C0F\u6D88\u606F\u7684\u6027\u80FD\u3002\u9650\u5236\u662F\u8FD9\u4E9B\u6279\u91CF\u6D88\u606F\u5E94\u8BE5\u6709\u76F8\u540C\u7684topic\uFF0C\u76F8\u540C\u7684waitStoreMsgOK\uFF0C\u800C\u4E14\u4E0D\u80FD\u662F\u5EF6\u65F6\u6D88\u606F\u3002\u6B64\u5916\uFF0C\u8FD9\u4E00\u6279\u6D88\u606F\u7684\u603B\u5927\u5C0F\u4E0D\u5E94\u8D85\u8FC74MB\u3002</p><h4 id="_6-4-1-\u53D1\u9001\u6279\u91CF\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_6-4-1-\u53D1\u9001\u6279\u91CF\u6D88\u606F" aria-hidden="true">#</a> 6.4.1 \u53D1\u9001\u6279\u91CF\u6D88\u606F</h4><p>\u5982\u679C\u60A8\u6BCF\u6B21\u53EA\u53D1\u9001\u4E0D\u8D85\u8FC74MB\u7684\u6D88\u606F\uFF0C\u5219\u5F88\u5BB9\u6613\u4F7F\u7528\u6279\u5904\u7406\uFF0C\u6837\u4F8B\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>bulkmessage</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u53D1\u9001\u6279\u91CF\u6D88\u606F
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 14:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BulkProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token function">main02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u53D1\u9001\u6279\u91CF\u6D88\u606F
     *
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>EXAMPLE_PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_BATCH_TEST<span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID00&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello world &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u628A\u5927\u7684\u6D88\u606F\u5206\u88C2\u6210\u82E5\u5E72\u4E2A\u5C0F\u7684\u6D88\u606F
     *
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>EXAMPLE_PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_BATCH_TEST<span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID00&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello world &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u628A\u5927\u7684\u6D88\u606F\u5206\u88C2\u6210\u82E5\u5E72\u4E2A\u5C0F\u7684\u6D88\u606F</span>
        <span class="token class-name">ListSplitter</span> splitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>splitter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> listItem <span class="token operator">=</span> splitter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>listItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-4-2-\u6D88\u606F\u5217\u8868\u5206\u5272" tabindex="-1"><a class="header-anchor" href="#_6-4-2-\u6D88\u606F\u5217\u8868\u5206\u5272" aria-hidden="true">#</a> 6.4.2 \u6D88\u606F\u5217\u8868\u5206\u5272</h4><p>\u590D\u6742\u5EA6\u53EA\u6709\u5F53\u4F60\u53D1\u9001\u5927\u6279\u91CF\u65F6\u624D\u4F1A\u589E\u957F\uFF0C\u4F60\u53EF\u80FD\u4E0D\u786E\u5B9A\u5B83\u662F\u5426\u8D85\u8FC7\u4E86\u5927\u5C0F\u9650\u5236\uFF084MB\uFF09\u3002\u8FD9\u65F6\u5019\u4F60\u6700\u597D\u628A\u4F60\u7684\u6D88\u606F\u5217\u8868\u5206\u5272\u4E00\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>bulkmessage</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u6D88\u606F\u5217\u8868\u5206\u5272
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 14:24
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListSplitter</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SIZE_LIMIT <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> currIndex<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>messages <span class="token operator">=</span> messages<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> currIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> startIndex <span class="token operator">=</span> <span class="token function">getStartIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> nextIndex <span class="token operator">=</span> startIndex<span class="token punctuation">;</span>
        <span class="token keyword">int</span> totalSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> nextIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> nextIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> tmpSize <span class="token operator">=</span> <span class="token function">calcMessageSize</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">+</span> totalSize <span class="token operator">&gt;</span> SIZE_LIMIT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                totalSize <span class="token operator">+=</span> tmpSize<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> subList <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>startIndex<span class="token punctuation">,</span> nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        currIndex <span class="token operator">=</span> nextIndex<span class="token punctuation">;</span>
        <span class="token keyword">return</span> subList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getStartIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Message</span> currMessage <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> tmpSize <span class="token operator">=</span> <span class="token function">calcMessageSize</span><span class="token punctuation">(</span>currMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">&gt;</span> SIZE_LIMIT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            currIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tmpSize <span class="token operator">=</span> <span class="token function">calcMessageSize</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> currIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">calcMessageSize</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> tmpSize <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> properties<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tmpSize <span class="token operator">+=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tmpSize <span class="token operator">=</span> tmpSize <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// \u589E\u52A0\u2F47\u65E5\u5FD7\u7684\u5F00\u950020\u5B57\u8282</span>
        <span class="token keyword">return</span> tmpSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-5-\u8FC7\u6EE4\u6D88\u606F\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-5-\u8FC7\u6EE4\u6D88\u606F\u6837\u4F8B" aria-hidden="true">#</a> 6.5 \u8FC7\u6EE4\u6D88\u606F\u6837\u4F8B</h3><p>\u5728\u5927\u591A\u6570\u60C5\u51B5\u4E0B\uFF0CTAG\u662F\u4E00\u4E2A\u7B80\u5355\u800C\u6709\u7528\u7684\u8BBE\u8BA1\uFF0C\u5176\u53EF\u4EE5\u6765\u9009\u62E9\u60A8\u60F3\u8981\u7684\u6D88\u606F\u3002\u4F8B\u5982\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;CID_EXAMPLE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TAGA || TAGB || TAGC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D88\u8D39\u8005\u5C06\u63A5\u6536\u5305\u542BTAGA\u6216TAGB\u6216TAGC\u7684\u6D88\u606F\u3002\u4F46\u662F\u9650\u5236\u662F\u4E00\u4E2A\u6D88\u606F\u53EA\u80FD\u6709\u4E00\u4E2A\u6807\u7B7E\uFF0C\u8FD9\u5BF9\u4E8E\u590D\u6742\u7684\u573A\u666F\u53EF\u80FD\u4E0D\u8D77\u4F5C\u7528\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u53EF\u4EE5\u4F7F\u7528SQL\u8868\u8FBE\u5F0F\u7B5B\u9009\u6D88\u606F\u3002SQL\u7279\u6027\u53EF\u4EE5\u901A\u8FC7\u53D1\u9001\u6D88\u606F\u65F6\u7684\u5C5E\u6027\u6765\u8FDB\u884C\u8BA1\u7B97\u3002\u5728RocketMQ\u5B9A\u4E49\u7684\u8BED\u6CD5\u4E0B\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u4E00\u4E9B\u7B80\u5355\u7684\u903B\u8F91\u3002\u4E0B\u9762\u662F\u4E00\u4E2A\u4F8B\u5B50\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>------------
| message  |
|----------|  a &gt; 5 AND b = &#39;abc&#39;
| a = 10   |  --------------------&gt; Gotten
| b = &#39;abc&#39;|
| c = true |
------------
------------
| message  |
|----------|   a &gt; 5 AND b = &#39;abc&#39;
| a = 1    |  --------------------&gt; Missed
| b = &#39;abc&#39;|
| c = true |
------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-5-1-\u57FA\u672C\u8BED\u6CD5" tabindex="-1"><a class="header-anchor" href="#_6-5-1-\u57FA\u672C\u8BED\u6CD5" aria-hidden="true">#</a> 6.5.1 \u57FA\u672C\u8BED\u6CD5</h4><p>RocketMQ\u53EA\u5B9A\u4E49\u4E86\u4E00\u4E9B\u57FA\u672C\u8BED\u6CD5\u6765\u652F\u6301\u8FD9\u4E2A\u7279\u6027\u3002\u4F60\u4E5F\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u6269\u5C55\u5B83\u3002</p><ul><li>\u6570\u503C\u6BD4\u8F83\uFF0C\u6BD4\u5982\uFF1A<strong>&gt;\uFF0C&gt;=\uFF0C&lt;\uFF0C&lt;=\uFF0CBETWEEN\uFF0C=\uFF1B</strong></li><li>\u5B57\u7B26\u6BD4\u8F83\uFF0C\u6BD4\u5982\uFF1A<strong>=\uFF0C&lt;&gt;\uFF0CIN\uFF1B</strong></li><li><strong>IS NULL</strong> \u6216\u8005 <strong>IS NOT NULL\uFF1B</strong></li><li>\u903B\u8F91\u7B26\u53F7 <strong>AND\uFF0COR\uFF0CNOT\uFF1B</strong></li></ul><p>\u5E38\u91CF\u652F\u6301\u7C7B\u578B\u4E3A\uFF1A</p><ul><li>\u6570\u503C\uFF0C\u6BD4\u5982\uFF1A<strong>123\uFF0C3.1415\uFF1B</strong></li><li>\u5B57\u7B26\uFF0C\u6BD4\u5982\uFF1A<strong>&#39;abc&#39;\uFF0C\u5FC5\u987B\u7528\u5355\u5F15\u53F7\u5305\u88F9\u8D77\u6765\uFF1B</strong></li><li><strong>NULL</strong>\uFF0C\u7279\u6B8A\u7684\u5E38\u91CF</li><li>\u5E03\u5C14\u503C\uFF0C<strong>TRUE</strong> \u6216 <strong>FALSE</strong></li></ul><p>\u53EA\u6709\u4F7F\u7528push\u6A21\u5F0F\u7684\u6D88\u8D39\u8005\u624D\u80FD\u7528\u4F7F\u7528SQL92\u6807\u51C6\u7684sql\u8BED\u53E5\uFF0C\u63A5\u53E3\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public void subscribe(finalString topic, final MessageSelector messageSelector)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_6-5-2-\u4F7F\u7528\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-5-2-\u4F7F\u7528\u6837\u4F8B" aria-hidden="true">#</a> 6.5.2 \u4F7F\u7528\u6837\u4F8B</h4><h5 id="_6-5-2-1\u3001\u751F\u4EA7\u8005\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-5-2-1\u3001\u751F\u4EA7\u8005\u6837\u4F8B" aria-hidden="true">#</a> 6.5.2.1\u3001\u751F\u4EA7\u8005\u6837\u4F8B</h5><p>\u53D1\u9001\u6D88\u606F\u65F6\uFF0C\u4F60\u80FD\u901A\u8FC7<code>putUserProperty</code>\u6765\u8BBE\u7F6E\u6D88\u606F\u7684\u5C5E\u6027</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>filtermessages</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">DateUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">RemotingHelper</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 *  
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 13:58
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FillterMessageProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TEST_PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> totalMessagesToSend <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalMessagesToSend<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_TEST<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\uFF0C\u4F60\u597D RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            message<span class="token punctuation">.</span><span class="token function">putUserProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u53D1\u9001\u6D88\u606F</span>
            producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-5-2-2\u3001\u6D88\u8D39\u8005\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-5-2-2\u3001\u6D88\u8D39\u8005\u6837\u4F8B" aria-hidden="true">#</a> 6.5.2.2\u3001\u6D88\u8D39\u8005\u6837\u4F8B</h5><p>\u7528MessageSelector.bySql\u6765\u4F7F\u7528sql\u7B5B\u9009\u6D88\u606F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>filtermessages</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQPushConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">MessageSelector</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeConcurrentlyContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeConcurrentlyStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">MessageListenerConcurrently</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageExt</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u542F\u52A8\u6D88\u8D39\u8005\u7B49\u5F85\u4F20\u5165\u8BA2\u9605\u6D88\u606F
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 13:58
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FillterMessageConsumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9E\u4F8B\u5316\u6D88\u8D39\u8005</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>EXAMPLE_CONSUMER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6ENameServer\u7684\u5730\u5740</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u53EA\u6709\u8BA2\u9605\u7684\u6D88\u606F\u6709\u8FD9\u4E2A\u5C5E\u6027a, a &gt;=0 and a &lt;= 3</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_TEST<span class="token punctuation">,</span> <span class="token class-name">MessageSelector</span><span class="token punctuation">.</span><span class="token function">bySql</span><span class="token punctuation">(</span><span class="token string">&quot;a between 0 and 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> message <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==&gt; \u63A5\u6536\u5230\u6D88\u606F [ID=&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, \u5185\u5BB9\u8BE6\u60C5:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> message<span class="token punctuation">.</span><span class="token function">getBornTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms later&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span>CONSUME_SUCCESS<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u542F\u52A8\u6D88\u8D39\u8005</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-6-\u6D88\u606F\u4E8B\u52A1\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-6-\u6D88\u606F\u4E8B\u52A1\u6837\u4F8B" aria-hidden="true">#</a> 6.6 \u6D88\u606F\u4E8B\u52A1\u6837\u4F8B</h3><p>\u4E8B\u52A1\u6D88\u606F\u5171\u6709\u4E09\u79CD\u72B6\u6001\uFF0C\u63D0\u4EA4\u72B6\u6001\u3001\u56DE\u6EDA\u72B6\u6001\u3001\u4E2D\u95F4\u72B6\u6001\uFF1A</p><ul><li>TransactionStatus.CommitTransaction: \u63D0\u4EA4\u4E8B\u52A1\uFF0C\u5B83\u5141\u8BB8\u6D88\u8D39\u8005\u6D88\u8D39\u6B64\u6D88\u606F\u3002</li><li>TransactionStatus.RollbackTransaction: \u56DE\u6EDA\u4E8B\u52A1\uFF0C\u5B83\u4EE3\u8868\u8BE5\u6D88\u606F\u5C06\u88AB\u5220\u9664\uFF0C\u4E0D\u5141\u8BB8\u88AB\u6D88\u8D39\u3002</li><li>TransactionStatus.Unknown: \u4E2D\u95F4\u72B6\u6001\uFF0C\u5B83\u4EE3\u8868\u9700\u8981\u68C0\u67E5\u6D88\u606F\u961F\u5217\u6765\u786E\u5B9A\u72B6\u6001\u3002</li></ul><h4 id="_6-6-1-\u53D1\u9001\u4E8B\u52A1\u6D88\u606F\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-6-1-\u53D1\u9001\u4E8B\u52A1\u6D88\u606F\u6837\u4F8B" aria-hidden="true">#</a> 6.6.1 \u53D1\u9001\u4E8B\u52A1\u6D88\u606F\u6837\u4F8B</h4><h6 id="_6-6-1-1\u3001\u521B\u5EFA\u4E8B\u52A1\u6027\u751F\u4EA7\u8005" tabindex="-1"><a class="header-anchor" href="#_6-6-1-1\u3001\u521B\u5EFA\u4E8B\u52A1\u6027\u751F\u4EA7\u8005" aria-hidden="true">#</a> 6.6.1.1\u3001\u521B\u5EFA\u4E8B\u52A1\u6027\u751F\u4EA7\u8005</h6><p>\u4F7F\u7528 <code>TransactionMQProducer</code>\u7C7B\u521B\u5EFA\u751F\u4EA7\u8005\uFF0C\u5E76\u6307\u5B9A\u552F\u4E00\u7684 <code>ProducerGroup</code>\uFF0C\u5C31\u53EF\u4EE5\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EBF\u7A0B\u6C60\u6765\u5904\u7406\u8FD9\u4E9B\u68C0\u67E5\u8BF7\u6C42\u3002\u6267\u884C\u672C\u5730\u4E8B\u52A1\u540E\u3001\u9700\u8981\u6839\u636E\u6267\u884C\u7ED3\u679C\u5BF9\u6D88\u606F\u961F\u5217\u8FDB\u884C\u56DE\u590D\u3002\u56DE\u4F20\u7684\u4E8B\u52A1\u72B6\u6001\u5728\u8BF7\u53C2\u8003\u524D\u4E00\u8282\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>transaction</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQClientException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">TransactionListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">TransactionMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">RemotingHelper</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">UnsupportedEncodingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u4E8B\u52A1\u6D88\u606F\u5171\u6709\u4E09\u79CD\u72B6\u6001\uFF0C\u63D0\u4EA4\u72B6\u6001\u3001\u56DE\u6EDA\u72B6\u6001\u3001\u4E2D\u95F4\u72B6\u6001\uFF1A
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * - TransactionStatus.CommitTransaction: \u63D0\u4EA4\u4E8B\u52A1\uFF0C\u5B83\u5141\u8BB8\u6D88\u8D39\u8005\u6D88\u8D39\u6B64\u6D88\u606F\u3002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * - TransactionStatus.RollbackTransaction: \u56DE\u6EDA\u4E8B\u52A1\uFF0C\u5B83\u4EE3\u8868\u8BE5\u6D88\u606F\u5C06\u88AB\u5220\u9664\uFF0C\u4E0D\u5141\u8BB8\u88AB\u6D88\u8D39\u3002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * - TransactionStatus.Unknown: \u4E2D\u95F4\u72B6\u6001\uFF0C\u5B83\u4EE3\u8868\u9700\u8981\u68C0\u67E5\u6D88\u606F\u961F\u5217\u6765\u786E\u5B9A\u72B6\u6001\u3002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 13:58
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionMessageProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">TransactionListener</span> transactionListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionListenerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TransactionMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TEST_PRODUCER_GROUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;client-transaction-msg-check-thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>NAME_SERVER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setExecutorService</span><span class="token punctuation">(</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setTransactionListener</span><span class="token punctuation">(</span>transactionListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_TEST_123<span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">sendMessageInTransaction</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_6-6-1-2\u3001\u5B9E\u73B0\u4E8B\u52A1\u7684\u76D1\u542C\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#_6-6-1-2\u3001\u5B9E\u73B0\u4E8B\u52A1\u7684\u76D1\u542C\u63A5\u53E3" aria-hidden="true">#</a> 6.6.1.2\u3001\u5B9E\u73B0\u4E8B\u52A1\u7684\u76D1\u542C\u63A5\u53E3</h6><p>\u5F53\u53D1\u9001\u534A\u6D88\u606F\u6210\u529F\u65F6\uFF0C\u6211\u4EEC\u4F7F\u7528 <code>executeLocalTransaction</code> \u65B9\u6CD5\u6765\u6267\u884C\u672C\u5730\u4E8B\u52A1\u3002\u5B83\u8FD4\u56DE\u524D\u4E00\u8282\u4E2D\u63D0\u5230\u7684\u4E09\u4E2A\u4E8B\u52A1\u72B6\u6001\u4E4B\u4E00\u3002<code>checkLocalTransaction</code> \u65B9\u6CD5\u7528\u4E8E\u68C0\u67E5\u672C\u5730\u4E8B\u52A1\u72B6\u6001\uFF0C\u5E76\u56DE\u5E94\u6D88\u606F\u961F\u5217\u7684\u68C0\u67E5\u8BF7\u6C42\u3002\u5B83\u4E5F\u662F\u8FD4\u56DE\u524D\u4E00\u8282\u4E2D\u63D0\u5230\u7684\u4E09\u4E2A\u4E8B\u52A1\u72B6\u6001\u4E4B\u4E00\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>transaction</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">LocalTransactionState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">TransactionListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageExt</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u5B9E\u73B0\u4E8B\u52A1\u7684\u76D1\u542C\u63A5\u53E3
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 15:04
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionListenerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransactionListener</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> transactionIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> localTrans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">executeLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> value <span class="token operator">=</span> transactionIndex<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> status <span class="token operator">=</span> value <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
        localTrans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span>UNKNOW<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">checkLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> status <span class="token operator">=</span> localTrans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
                    <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span>UNKNOW<span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                    <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span>COMMIT_MESSAGE<span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                    <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span>ROLLBACK_MESSAGE<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span>COMMIT_MESSAGE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2-2-\u4E8B\u52A1\u6D88\u606F\u4F7F\u7528\u4E0A\u7684\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#_6-2-2-\u4E8B\u52A1\u6D88\u606F\u4F7F\u7528\u4E0A\u7684\u9650\u5236" aria-hidden="true">#</a> 6.2.2 \u4E8B\u52A1\u6D88\u606F\u4F7F\u7528\u4E0A\u7684\u9650\u5236</h4><ol><li>\u4E8B\u52A1\u6D88\u606F\u4E0D\u652F\u6301\u5EF6\u65F6\u6D88\u606F\u548C\u6279\u91CF\u6D88\u606F\u3002</li><li>\u4E3A\u4E86\u907F\u514D\u5355\u4E2A\u6D88\u606F\u88AB\u68C0\u67E5\u592A\u591A\u6B21\u800C\u5BFC\u81F4\u534A\u961F\u5217\u6D88\u606F\u7D2F\u79EF\uFF0C\u6211\u4EEC\u9ED8\u8BA4\u5C06\u5355\u4E2A\u6D88\u606F\u7684\u68C0\u67E5\u6B21\u6570\u9650\u5236\u4E3A 15 \u6B21\uFF0C\u4F46\u662F\u7528\u6237\u53EF\u4EE5\u901A\u8FC7 Broker \u914D\u7F6E\u6587\u4EF6\u7684 <code>transactionCheckMax</code>\u53C2\u6570\u6765\u4FEE\u6539\u6B64\u9650\u5236\u3002\u5982\u679C\u5DF2\u7ECF\u68C0\u67E5\u67D0\u6761\u6D88\u606F\u8D85\u8FC7 N \u6B21\u7684\u8BDD\uFF08 N = <code>transactionCheckMax</code> \uFF09 \u5219 Broker \u5C06\u4E22\u5F03\u6B64\u6D88\u606F\uFF0C\u5E76\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u540C\u65F6\u6253\u5370\u9519\u8BEF\u65E5\u5FD7\u3002\u7528\u6237\u53EF\u4EE5\u901A\u8FC7\u91CD\u5199 <code>AbstractTransactionalMessageCheckListener</code> \u7C7B\u6765\u4FEE\u6539\u8FD9\u4E2A\u884C\u4E3A\u3002</li><li>\u4E8B\u52A1\u6D88\u606F\u5C06\u5728 Broker \u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u53C2\u6570 transactionTimeout \u8FD9\u6837\u7684\u7279\u5B9A\u65F6\u95F4\u957F\u5EA6\u4E4B\u540E\u88AB\u68C0\u67E5\u3002\u5F53\u53D1\u9001\u4E8B\u52A1\u6D88\u606F\u65F6\uFF0C\u7528\u6237\u8FD8\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6E\u7528\u6237\u5C5E\u6027 CHECK_IMMUNITY_TIME_IN_SECONDS \u6765\u6539\u53D8\u8FD9\u4E2A\u9650\u5236\uFF0C\u8BE5\u53C2\u6570\u4F18\u5148\u4E8E <code>transactionTimeout</code> \u53C2\u6570\u3002</li><li>\u4E8B\u52A1\u6027\u6D88\u606F\u53EF\u80FD\u4E0D\u6B62\u4E00\u6B21\u88AB\u68C0\u67E5\u6216\u6D88\u8D39\u3002</li><li>\u63D0\u4EA4\u7ED9\u7528\u6237\u7684\u76EE\u6807\u4E3B\u9898\u6D88\u606F\u53EF\u80FD\u4F1A\u5931\u8D25\uFF0C\u76EE\u524D\u8FD9\u4F9D\u65E5\u5FD7\u7684\u8BB0\u5F55\u800C\u5B9A\u3002\u5B83\u7684\u9AD8\u53EF\u7528\u6027\u901A\u8FC7 RocketMQ \u672C\u8EAB\u7684\u9AD8\u53EF\u7528\u6027\u673A\u5236\u6765\u4FDD\u8BC1\uFF0C\u5982\u679C\u5E0C\u671B\u786E\u4FDD\u4E8B\u52A1\u6D88\u606F\u4E0D\u4E22\u5931\u3001\u5E76\u4E14\u4E8B\u52A1\u5B8C\u6574\u6027\u5F97\u5230\u4FDD\u8BC1\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u540C\u6B65\u7684\u53CC\u91CD\u5199\u5165\u673A\u5236\u3002</li><li>\u4E8B\u52A1\u6D88\u606F\u7684\u751F\u4EA7\u8005 ID \u4E0D\u80FD\u4E0E\u5176\u4ED6\u7C7B\u578B\u6D88\u606F\u7684\u751F\u4EA7\u8005 ID \u5171\u4EAB\u3002\u4E0E\u5176\u4ED6\u7C7B\u578B\u7684\u6D88\u606F\u4E0D\u540C\uFF0C\u4E8B\u52A1\u6D88\u606F\u5141\u8BB8\u53CD\u5411\u67E5\u8BE2\u3001MQ\u670D\u52A1\u5668\u80FD\u901A\u8FC7\u5B83\u4EEC\u7684\u751F\u4EA7\u8005 ID \u67E5\u8BE2\u5230\u6D88\u8D39\u8005\u3002</li></ol><h3 id="_6-7-logappender-\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-7-logappender-\u6837\u4F8B" aria-hidden="true">#</a> 6.7 Logappender \u6837\u4F8B</h3><p>RocketMQ\u65E5\u5FD7\u63D0\u4F9Blog4j\u3001log4j2\u548Clogback\u65E5\u5FD7\u6846\u67B6\u4F5C\u4E3A\u4E1A\u52A1\u5E94\u7528\uFF0C\u4E0B\u9762\u662F\u914D\u7F6E\u6837\u4F8B</p><h4 id="_6-7-1-log4j\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-7-1-log4j\u6837\u4F8B" aria-hidden="true">#</a> 6.7.1 log4j\u6837\u4F8B</h4><p>\u6309\u4E0B\u9762\u6837\u4F8B\u4F7F\u7528log4j\u5C5E\u6027\u914D\u7F6E</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">log4j.appender.mq</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.rocketmq.logappender.log4j.RocketmqLog4jAppender</span>
<span class="token key attr-name">log4j.appender.mq.Tag</span><span class="token punctuation">=</span><span class="token value attr-value">yourTag</span>
<span class="token key attr-name">log4j.appender.mq.Topic</span><span class="token punctuation">=</span><span class="token value attr-value">yourLogTopic</span>
<span class="token key attr-name">log4j.appender.mq.ProducerGroup</span><span class="token punctuation">=</span><span class="token value attr-value">yourLogGroup</span>
<span class="token key attr-name">log4j.appender.mq.NameServerAddress</span><span class="token punctuation">=</span><span class="token value attr-value">yourRocketmqNameserverAddress</span>
<span class="token key attr-name">log4j.appender.mq.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.mq.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%d{yyyy-MM-dd HH:mm:ss} %-4r [%t] (%F:%L) %-5p - %m%n</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6309\u4E0B\u9762\u6837\u4F8B\u4F7F\u7528log4j xml\u914D\u7F6E\u6765\u4F7F\u7528\u5F02\u6B65\u6DFB\u52A0\u65E5\u5FD7</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mqAppender1<span class="token punctuation">&quot;</span></span><span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.rocketmq.logappender.log4j.RocketmqLog4jAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Tag<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourTag<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Topic<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourLogTopic<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ProducerGroup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourLogGroup<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NameServerAddress<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourRocketmqNameserverAddress<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.log4j.PatternLayout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ConversionPattern<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%d{yyyy-MM-dd HH:mm:ss}-%p %t %c - %m%n<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mqAsyncAppender1<span class="token punctuation">&quot;</span></span><span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.log4j.AsyncAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>BufferSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1024<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Blocking<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mqAppender1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-7-2-log4j2\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-7-2-log4j2\u6837\u4F8B" aria-hidden="true">#</a> 6.7.2 log4j2\u6837\u4F8B</h4><p>\u7528log4j2\u65F6\uFF0C\u914D\u7F6E\u5982\u4E0B\uFF0C\u5982\u679C\u60F3\u8981\u975E\u963B\u585E\uFF0C\u53EA\u9700\u8981\u4F7F\u7528\u5F02\u6B65\u6DFB\u52A0\u5F15\u7528\u5373\u53EF</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RocketMQ</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rocketmqAppender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">producerGroup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourLogGroup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">nameServerAddress</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourRocketmqNameserverAddress<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">topic</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourLogTopic<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yourTag<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%d [%p] hahahah %c %m%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RocketMQ</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-7-3-logback\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-7-3-logback\u6837\u4F8B" aria-hidden="true">#</a> 6.7.3 logback\u6837\u4F8B</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mqAppender1<span class="token punctuation">&quot;</span></span><span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.rocketmq.logappender.logback.RocketmqLogbackAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tag</span><span class="token punctuation">&gt;</span></span>yourTag<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tag</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>topic</span><span class="token punctuation">&gt;</span></span>yourLogTopic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>topic</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>producerGroup</span><span class="token punctuation">&gt;</span></span>yourLogGroup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>producerGroup</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nameServerAddress</span><span class="token punctuation">&gt;</span></span>yourRocketmqNameserverAddress<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nameServerAddress</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%date %p %t - %m%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mqAsyncAppender1<span class="token punctuation">&quot;</span></span><span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.classic.AsyncAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queueSize</span><span class="token punctuation">&gt;</span></span>1024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queueSize</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span>80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFlushTime</span><span class="token punctuation">&gt;</span></span>2000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFlushTime</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>neverBlock</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>neverBlock</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mqAppender1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-8-openmessaging-\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-8-openmessaging-\u6837\u4F8B" aria-hidden="true">#</a> 6.8 OpenMessaging \u6837\u4F8B</h3>`,215),f={href:"https://www.google.com/url?q=http://openmessaging.cloud/&sa=D&ust=1546524111089000",target:"_blank",rel:"noopener noreferrer"},q=a("OpenMessaging"),S=a("\u65E8\u5728\u5EFA\u7ACB\u6D88\u606F\u548C\u6D41\u5904\u7406\u89C4\u8303\uFF0C\u4EE5\u4E3A\u91D1\u878D\u3001\u7535\u5B50\u5546\u52A1\u3001\u7269\u8054\u7F51\u548C\u5927\u6570\u636E\u9886\u57DF\u63D0\u4F9B\u901A\u7528\u6846\u67B6\u53CA\u5DE5\u4E1A\u7EA7\u6307\u5BFC\u65B9\u6848\u3002\u5728\u5206\u5E03\u5F0F\u5F02\u6784\u73AF\u5883\u4E2D\uFF0C\u8BBE\u8BA1\u539F\u5219\u662F\u9762\u5411\u4E91\u3001\u7B80\u5355\u3001\u7075\u6D3B\u548C\u72EC\u7ACB\u4E8E\u8BED\u8A00\u3002\u7B26\u5408\u8FD9\u4E9B\u89C4\u8303\u5C06\u5E2E\u52A9\u4F01\u4E1A\u65B9\u4FBF\u7684\u5F00\u53D1\u8DE8\u5E73\u53F0\u548C\u64CD\u4F5C\u7CFB\u7EDF\u7684\u5F02\u6784\u6D88\u606F\u4F20\u9012\u5E94\u7528\u7A0B\u5E8F\u3002\u63D0\u4F9B\u4E86openmessaging-api 0.3.0-alpha\u7684\u90E8\u5206\u5B9E\u73B0\uFF0C\u4E0B\u9762\u7684\u793A\u4F8B\u6F14\u793A\u5982\u4F55\u57FA\u4E8EOpenMessaging\u8BBF\u95EERocketMQ\u3002"),M=s(`<h4 id="_6-8-1-omsproducer\u6837\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-8-1-omsproducer\u6837\u4F8B" aria-hidden="true">#</a> 6.8.1 OMSProducer\u6837\u4F8B</h4><p>\u4E0B\u9762\u7684\u793A\u4F8B\u6F14\u793A\u5982\u4F55\u5728\u540C\u6B65\u3001\u5F02\u6B65\u6216\u5355\u5411\u4F20\u8F93\u4E2D\u5411RocketMQ\u4EE3\u7406\u53D1\u9001\u6D88\u606F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">Future</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">FutureListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">MessagingAccessPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">OMS</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">MessagingAccessPoint</span> messagingAccessPoint <span class="token operator">=</span>
                OMS<span class="token punctuation">.</span><span class="token function">getMessagingAccessPoint</span><span class="token punctuation">(</span><span class="token string">&quot;oms:rocketmq://localhost:9876/default:default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Producer</span> producer <span class="token operator">=</span> messagingAccessPoint<span class="token punctuation">.</span><span class="token function">createProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        messagingAccessPoint<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;MessagingAccessPoint startup OK%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Producer startup OK%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">createBytesMessage</span><span class="token punctuation">(</span><span class="token string">&quot;OMS_HELLO_TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OMS_HELLO_BODY&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//final Void aVoid = result.get(3000L);</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Send async message OK, msgId: %s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SendResult</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">sendAsync</span><span class="token punctuation">(</span>producer<span class="token punctuation">.</span><span class="token function">createBytesMessage</span><span class="token punctuation">(</span><span class="token string">&quot;OMS_HELLO_TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OMS_HELLO_BODY&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SendResult</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SendResult</span><span class="token punctuation">&gt;</span></span> future<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">getThrowable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Send async message Failed, error: %s%n&quot;</span><span class="token punctuation">,</span> future<span class="token punctuation">.</span><span class="token function">getThrowable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Send async message OK, msgId: %s%n&quot;</span><span class="token punctuation">,</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">{</span>
            producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>producer<span class="token punctuation">.</span><span class="token function">createBytesMessage</span><span class="token punctuation">(</span><span class="token string">&quot;OMS_HELLO_TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OMS_HELLO_BODY&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Send oneway message OK%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u7B49\u4E00\u4E9B\u65F6\u95F4\u6765\u53D1\u9001\u6D88\u606F</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-8-2-omspullconsumer" tabindex="-1"><a class="header-anchor" href="#_6-8-2-omspullconsumer" aria-hidden="true">#</a> 6.8.2 OMSPullConsumer</h4><p>\u7528OMS PullConsumer \u6765\u4ECE\u6307\u5B9A\u7684\u961F\u5217\u4E2D\u62C9\u53D6\u6D88\u606F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">MessagingAccessPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">OMS</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">OMSBuiltinKeys</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">PullConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimplePullConsumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">final</span> <span class="token class-name">MessagingAccessPoint</span> messagingAccessPoint <span class="token operator">=</span>
           OMS<span class="token punctuation">.</span><span class="token function">getMessagingAccessPoint</span><span class="token punctuation">(</span><span class="token string">&quot;oms:rocketmq://localhost:9876/default:default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       messagingAccessPoint<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">final</span> <span class="token class-name">Producer</span> producer <span class="token operator">=</span> messagingAccessPoint<span class="token punctuation">.</span><span class="token function">createProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">final</span> <span class="token class-name">PullConsumer</span> consumer <span class="token operator">=</span> messagingAccessPoint<span class="token punctuation">.</span><span class="token function">createPullConsumer</span><span class="token punctuation">(</span>
           OMS<span class="token punctuation">.</span><span class="token function">newKeyValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">OMSBuiltinKeys</span><span class="token punctuation">.</span>CONSUMER_ID<span class="token punctuation">,</span> <span class="token string">&quot;OMS_CONSUMER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       messagingAccessPoint<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;MessagingAccessPoint startup OK%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">final</span> <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">;</span>
       producer<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Message</span> msg <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">createBytesMessage</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token string">&quot;Hello Open Messaging&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Send Message OK. MsgId: %s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">attachQueue</span><span class="token punctuation">(</span>queueName<span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer startup OK%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// \u8FD0\u884C\u76F4\u5230\u53D1\u73B0\u4E00\u4E2A\u6D88\u606F\u88AB\u53D1\u9001\u4E86</span>
       <span class="token keyword">boolean</span> stop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
       <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">Message</span> message <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">String</span> msgId <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">sysHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">Message<span class="token punctuation">.</span>BuiltinKeys</span><span class="token punctuation">.</span>MESSAGE_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Received one message: %s%n&quot;</span><span class="token punctuation">,</span> msgId<span class="token punctuation">)</span><span class="token punctuation">;</span>
               consumer<span class="token punctuation">.</span><span class="token function">ack</span><span class="token punctuation">(</span>msgId<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   stop <span class="token operator">=</span> msgId<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>sendResult<span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Return without any message%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       consumer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       messagingAccessPoint<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-8-3-omspushconsumer" tabindex="-1"><a class="header-anchor" href="#_6-8-3-omspushconsumer" aria-hidden="true">#</a> 6.8.3 OMSPushConsumer</h4><p>\u4EE5\u4E0B\u793A\u8303\u5982\u4F55\u5C06 OMS PushConsumer \u6DFB\u52A0\u5230\u6307\u5B9A\u7684\u961F\u5217\uFF0C\u5E76\u901A\u8FC7 MessageListener \u6D88\u8D39\u8FD9\u4E9B\u6D88\u606F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">MessagingAccessPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">OMS</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span></span><span class="token class-name">OMSBuiltinKeys</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">MessageListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>openmessaging<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">PushConsumer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimplePushConsumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">final</span> <span class="token class-name">MessagingAccessPoint</span> messagingAccessPoint <span class="token operator">=</span> OMS
           <span class="token punctuation">.</span><span class="token function">getMessagingAccessPoint</span><span class="token punctuation">(</span><span class="token string">&quot;oms:rocketmq://localhost:9876/default:default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">final</span> <span class="token class-name">PushConsumer</span> consumer <span class="token operator">=</span> messagingAccessPoint<span class="token punctuation">.</span>
           <span class="token function">createPushConsumer</span><span class="token punctuation">(</span>OMS<span class="token punctuation">.</span><span class="token function">newKeyValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">OMSBuiltinKeys</span><span class="token punctuation">.</span>CONSUMER_ID<span class="token punctuation">,</span> <span class="token string">&quot;OMS_CONSUMER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       messagingAccessPoint<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;MessagingAccessPoint startup OK%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addShutdownHook</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               consumer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               messagingAccessPoint<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">attachQueue</span><span class="token punctuation">(</span><span class="token string">&quot;OMS_HELLO_TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceived</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Received one message: %s%n&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">sysHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">Message<span class="token punctuation">.</span>BuiltinKeys</span><span class="token punctuation">.</span>MESSAGE_ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               context<span class="token punctuation">.</span><span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer startup OK%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7\u3001\u6574\u5408-springboot" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u6574\u5408-springboot" aria-hidden="true">#</a> 7\u3001\u6574\u5408 springboot</h2><p>https://github.com/apache/rocketmq-spring</p><p>https://gitee.com/MFork/rocketmq-spring</p><h3 id="_7-1-\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_7-1-\u4F9D\u8D56" aria-hidden="true">#</a> 7.1 \u4F9D\u8D56</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>	<span class="token comment">&lt;!-- RocketMQ --&gt;</span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.rocketmq/rocketmq-spring-boot-starter --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-acl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-acl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>rocketmq-spring-boot-starter:2.2.2 \u5305\u542B\u7684 rocketmq-client &amp; rocketmq-client \u7248\u672C\u4E3A 4.9.3</p><h3 id="_7-2-\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_7-2-\u914D\u7F6E" aria-hidden="true">#</a> 7.2 \u914D\u7F6E</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * RocketMQ \u914D\u7F6E\u7C7B
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/05 15:47
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRocketMQConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;rocketMQTemplate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RocketMQTemplate</span> <span class="token function">rocketMQTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RocketMQTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;defaultMQProducer&quot;</span><span class="token punctuation">,</span> initMethod <span class="token operator">=</span> <span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> destroyMethod <span class="token operator">=</span> <span class="token string">&quot;shutdown&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultMQProducer</span> <span class="token function">defaultMQProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RocketMQTemplate</span> rocketMQTemplate <span class="token operator">=</span> <span class="token function">rocketMQTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DefaultMQProducer</span> defaultMQProducer <span class="token operator">=</span> rocketMQTemplate<span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span>
                <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>PRODUCER_GROUP_TEST<span class="token punctuation">)</span>
                <span class="token operator">:</span> rocketMQTemplate<span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rocketMQTemplate<span class="token punctuation">.</span><span class="token function">setProducer</span><span class="token punctuation">(</span>defaultMQProducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> defaultMQProducer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-\u6D88\u606F\u751F\u4EA7\u8005\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_7-3-\u6D88\u606F\u751F\u4EA7\u8005\u5DE5\u5177" aria-hidden="true">#</a> 7.3 \u6D88\u606F\u751F\u4EA7\u8005\u5DE5\u5177</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">GlobalException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQBrokerException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQClientException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendCallback</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">RemotingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">MessageBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u53D1\u9001 [\u5355\u5411\u3001\u540C\u6B65\u3001\u5F02\u6B65] \u6D88\u606F
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/14 11:29
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendProducer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMQTemplate</span> rocketMQTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_EXAMPLE<span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> tags<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u5355\u5411\u53D1\u9001\u6D88\u606F\uFF0C\u6CA1\u6709\u4EFB\u4F55\u8FD4\u56DE\u7ED3\u679C
     *
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>       \u4E3B\u9898
     * <span class="token keyword">@param</span> <span class="token parameter">tags</span>        \u6807\u7B7E
     * <span class="token keyword">@param</span> <span class="token parameter">keys</span>        \u6D88\u606Fkey\u503C\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u5168\u5C40\u552F\u4E00\uFF0C\u6BD4\u5982\u8BA2\u5355\u53F7\uFF0C\u7528\u6237id\u8FD9\u79CD\uFF0C\u53EF\u4E0D\u4F20\uFF0C\u4E0D\u5F71\u54CD\u6D88\u606F\u6295\u9012
     * <span class="token keyword">@param</span> <span class="token parameter">messageBody</span> json\u6D88\u606F
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> keys<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rocketMQTemplate<span class="token punctuation">.</span><span class="token function">sendOneWay</span><span class="token punctuation">(</span>topic <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> tags<span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_DELAY<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> messageBody<span class="token punctuation">,</span> <span class="token keyword">int</span> delayTimeLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_DELAY<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">,</span> delayTimeLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">,</span> <span class="token keyword">int</span> delayTimeLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">,</span> delayTimeLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> tags<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">,</span> <span class="token keyword">int</span> delayTimeLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> tags<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">,</span> delayTimeLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u5F02\u6B65\u53D1\u9001\u5EF6\u8FDF\u6D88\u606F\uFF0C\u6D4B\u8BD5\u9ED8\u8BA4\u4EE5 3\uFF0810s\uFF09 \u4E3A\u4F8B\u3002
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
     * messageDelayLevel = &quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
     *
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>          \u4E3B\u9898
     * <span class="token keyword">@param</span> <span class="token parameter">tags</span>           \u6807\u7B7E
     * <span class="token keyword">@param</span> <span class="token parameter">keys</span>           \u6D88\u606Fkey\u503C\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u5168\u5C40\u552F\u4E00\uFF0C\u6BD4\u5982\u8BA2\u5355\u53F7\uFF0C\u7528\u6237id\u8FD9\u79CD\uFF0C\u53EF\u4E0D\u4F20\uFF0C\u4E0D\u5F71\u54CD\u6D88\u606F\u6295\u9012
     * <span class="token keyword">@param</span> <span class="token parameter">messageBody</span>    json\u6D88\u606F
     * <span class="token keyword">@param</span> <span class="token parameter">delayTimeLevel</span> \u8BBE\u7F6E\u5EF6\u65F6\u7B49\u7EA73,\u4ECE1s\u52302h\u5206\u522B\u5BF9\u5E94\u7740\u7B49\u7EA71\u523018
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> keys<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">,</span> <span class="token keyword">int</span> delayTimeLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rocketMQTemplate<span class="token punctuation">.</span><span class="token function">asyncSend</span><span class="token punctuation">(</span>topic <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> tags<span class="token punctuation">,</span>
                <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>messageBody<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-- \u53D1\u9001[\u5EF6\u8FDF]\u6D88\u606F\u6210\u529F\uFF1A{}&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;-- \u53D1\u9001[\u5EF6\u8FDF]\u6D88\u606F\u5931\u8D25\uFF1A{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GlobalException</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001[\u5EF6\u8FDF]\u6D88\u606F\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> delayTimeLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_EXAMPLE<span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> tags<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u53D1\u9001\u5F02\u6B65\u6D88\u606F
     *
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>       \u4E3B\u9898
     * <span class="token keyword">@param</span> <span class="token parameter">tags</span>        \u6807\u7B7E
     * <span class="token keyword">@param</span> <span class="token parameter">keys</span>        \u6D88\u606Fkey\u503C\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u5168\u5C40\u552F\u4E00\uFF0C\u6BD4\u5982\u8BA2\u5355\u53F7\uFF0C\u7528\u6237id\u8FD9\u79CD\uFF0C\u53EF\u4E0D\u4F20\uFF0C\u4E0D\u5F71\u54CD\u6D88\u606F\u6295\u9012
     * <span class="token keyword">@param</span> <span class="token parameter">messageBody</span> \u6D88\u606F
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> keys<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u8BBE\u7F6E\u53D1\u9001\u5F02\u6B65\u5931\u8D25\u65F6\u7684\u91CD\u8BD5\u6B21\u6570</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>RETRY_TIMES_WHEN_SEND_ASYNC_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u521B\u5EFA\u6D88\u606F\uFF0C\u5E76\u6307\u5B9ATopic\uFF0CTag\u548C\u6D88\u606F\u4F53</span>
        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> tags<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> messageBody<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// SendCallback \u63A5\u6536\u5F02\u6B65\u8FD4\u56DE\u7ED3\u679C\u7684\u56DE\u8C03</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-- \u53D1\u9001[\u5F02\u6B65]\u6D88\u606F\u6210\u529F\uFF1A{}&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;-- \u53D1\u9001[\u5F02\u6B65]\u6D88\u606F\u5931\u8D25\uFF1A{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GlobalException</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001[\u5F02\u6B65]\u6D88\u606F\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">RemotingException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;-- \u53D1\u9001[\u5F02\u6B65]\u6D88\u606F\u5931\u8D25:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GlobalException</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001[\u5F02\u6B65]\u6D88\u606F\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_EXAMPLE<span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> tags<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> messageBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u53D1\u9001\u540C\u6B65\u6D88\u606F
     *
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>       \u4E3B\u9898
     * <span class="token keyword">@param</span> <span class="token parameter">tags</span>        \u6807\u7B7E
     * <span class="token keyword">@param</span> <span class="token parameter">keys</span>        \u6D88\u606Fkey\u503C\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u5168\u5C40\u552F\u4E00\uFF0C\u6BD4\u5982\u8BA2\u5355\u53F7\uFF0C\u7528\u6237id\u8FD9\u79CD\uFF0C\u53EF\u4E0D\u4F20\uFF0C\u4E0D\u5F71\u54CD\u6D88\u606F\u6295\u9012
     * <span class="token keyword">@param</span> <span class="token parameter">messageBody</span> \u6D88\u606F
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">String</span> tags<span class="token punctuation">,</span> <span class="token class-name">String</span> keys<span class="token punctuation">,</span> <span class="token class-name">String</span> messageBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u521B\u5EFA\u6D88\u606F\uFF0C\u5E76\u6307\u5B9ATopic\uFF0CTag\u548C\u6D88\u606F\u4F53 (RemotingHelper.DEFAULT_CHARSET)</span>
        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> tags<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> messageBody<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u53D1\u9001\u6D88\u606F\u5230Broker</span>
        <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sendResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">RemotingException</span> <span class="token operator">|</span> <span class="token class-name">MQBrokerException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;-- \u53D1\u9001[\u540C\u6B65]\u6D88\u606F\u5931\u8D25:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">GlobalException</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001[\u540C\u6B65]\u6D88\u606F\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;-- \u53D1\u9001[\u540C\u6B65]\u6D88\u606F\u6210\u529F: {}&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sendResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultMQProducer</span> <span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> rocketMQTemplate<span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>producer <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---- new DefaultMQProducer()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rocketMQTemplate<span class="token punctuation">.</span><span class="token function">setProducer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>PRODUCER_GROUP_TEST<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> rocketMQTemplate<span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> producer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u4E00\u822C\u5728\u5E94\u7528\u4E0A\u4E0B\u6587\uFF0C\u4F7F\u7528\u4E0A\u4E0B\u6587\u76D1\u542C\u5668\uFF0C\u8FDB\u884C\u5173\u95ED
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rocketMQTemplate<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-\u76D1\u542C\u666E\u901A\u4E3B\u9898\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_7-4-\u76D1\u542C\u666E\u901A\u4E3B\u9898\u6D88\u606F" aria-hidden="true">#</a> 7.4 \u76D1\u542C\u666E\u901A\u4E3B\u9898\u6D88\u606F</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>order<span class="token punctuation">.</span></span><span class="token class-name">OrderStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeOrderlyContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeOrderlyStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageExt</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConsumeMode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MessageModel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RocketMQMessageListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u76D1\u542C\u666E\u901A\u4E3B\u9898\u6D88\u606F
 * MessageListenerOrderly \u6D88\u606F\u76D1\u542C\u5668\u6709\u5E8F
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/12 18:19
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RocketMQMessageListener</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_EXAMPLE<span class="token punctuation">,</span>
        consumerGroup <span class="token operator">=</span> <span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>CONSUMER_GROUP_EXAMPLE<span class="token punctuation">,</span>
        consumeMode <span class="token operator">=</span> <span class="token class-name">ConsumeMode</span><span class="token punctuation">.</span>ORDERLY<span class="token punctuation">,</span>
        messageModel <span class="token operator">=</span> <span class="token class-name">MessageModel</span><span class="token punctuation">.</span>CLUSTERING
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqMessageListener</span> <span class="token keyword">implements</span> <span class="token class-name">RocketMQListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">ConsumeOrderlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeOrderlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;===&gt; \u63A5\u6536\u5230\u666E\u901A\u4E3B\u9898\u6D88\u606F consumeThread= {}, queueId= {}, content: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;===&gt; \u63A5\u6536\u5230\u666E\u901A\u4E3B\u9898\u6D88\u606F message: {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-\u76D1\u542C\u5EF6\u65F6\u3001\u5B9A\u65F6\u4E3B\u9898\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#_7-5-\u76D1\u542C\u5EF6\u65F6\u3001\u5B9A\u65F6\u4E3B\u9898\u6D88\u606F" aria-hidden="true">#</a> 7.5 \u76D1\u542C\u5EF6\u65F6\u3001\u5B9A\u65F6\u4E3B\u9898\u6D88\u606F</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">RocketMQConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeConcurrentlyContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ConsumeConcurrentlyStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">MessageExt</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConsumeMode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MessageModel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RocketMQMessageListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u76D1\u542C\u5EF6\u65F6\u3001\u5B9A\u65F6\u4E3B\u9898\u6D88\u606F
 * MessageListenerConcurrently \u5E76\u53D1\u6D88\u606F\u76D1\u542C\u5668
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/05 19:32
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RocketMQMessageListener</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>TOPIC_DELAY<span class="token punctuation">,</span>
        consumerGroup <span class="token operator">=</span> <span class="token class-name">RocketMQConstants</span><span class="token punctuation">.</span>CONSUMER_GROUP_EXAMPLE_DELAY<span class="token punctuation">,</span>
        consumeMode <span class="token operator">=</span> <span class="token class-name">ConsumeMode</span><span class="token punctuation">.</span>CONCURRENTLY<span class="token punctuation">,</span>
        messageModel <span class="token operator">=</span> <span class="token class-name">MessageModel</span><span class="token punctuation">.</span>CLUSTERING
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqTimeMessageListener</span> <span class="token keyword">implements</span> <span class="token class-name">RocketMQListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token comment">//public class MqTimeMessageListener implements MessageListenerConcurrently   {</span>

    <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;===&gt; \u63A5\u6536\u5230\u8D85\u65F6\u4E3B\u9898 queueId= {}, content: {}&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span>CONSUME_SUCCESS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;===&gt; \u63A5\u6536\u5230\u8D85\u65F6\u4E3B\u9898 message: {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-6-\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_7-6-\u6D4B\u8BD5" aria-hidden="true">#</a> 7.6 \u6D4B\u8BD5</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">DateUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>web<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span><span class="token class-name">BaseController</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>order<span class="token punctuation">.</span></span><span class="token class-name">OrderStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>jf<span class="token punctuation">.</span>system<span class="token punctuation">.</span>example<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson2<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u4F7F\u7528\u5C01\u88C5\u7C7B\u793A\u4F8B
 *
 * <span class="token keyword">@author</span> jf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@date</span> 2022/07/05 15:20
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/mq2&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RocketMqDemo2</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">SendProducer</span> sendProducer<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u5355\u5411\u53D1\u9001\u6D88\u606F-\u6D4B\u8BD5
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendOnewayProducer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">350</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderStep</span> orderStep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u5355\u5411\u53D1\u9001\u6D88\u606F-\u6D4B\u8BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sendProducer<span class="token punctuation">.</span><span class="token function">sendOnewayProducer</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;\u5355\u5411\u53D1\u9001\u6D88\u606F-\u6D4B\u8BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u53D1\u9001\u5EF6\u8FDF\u6D88\u606F-\u6D4B\u8BD5
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendDelayedProducer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">600</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderStep</span> orderStep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001\u5EF6\u8FDF\u6D88\u606F-\u6D4B\u8BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sendProducer<span class="token punctuation">.</span><span class="token function">sendDelayedProducer</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u53D1\u9001\u5F02\u6B65\u6D88\u606F-\u6D4B\u8BD5
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendAsyncProducer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">700</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">800</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderStep</span> orderStep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001\u5F02\u6B65\u6D88\u606F-\u6D4B\u8BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sendProducer<span class="token punctuation">.</span><span class="token function">sendAsyncProducer</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001\u5F02\u6B65\u6D88\u606F-\u6D4B\u8BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u53D1\u9001\u540C\u6B65\u6D88\u606F-\u6D4B\u8BD5
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendSyncProducer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">sendSyncProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">900</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderStep</span> orderStep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001\u540C\u6B65\u6D88\u606F-\u6D4B\u8BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderStep<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> sendProducer<span class="token punctuation">.</span><span class="token function">sendSyncProducer</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>http://127.0.0.1:9210/jf-system-dev/mq2/sendOnewayProducer</p><p>http://127.0.0.1:9210/jf-system-dev/mq2/sendSyncProducer</p>`,28);function C(T,R){const t=l("ExternalLinkIcon");return e(),o("div",null,[w,n("p",null,[n("a",f,[q,c(t)]),S]),M])}var _=p(h,[["render",C],["__file","mq-rocket.html.vue"]]);export{_ as default};
